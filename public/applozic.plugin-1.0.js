var $applozic = jQuery.noConflict(true);
if (typeof $original !== 'undefined') {
    $ = $original;
    jQuery = $original;
    if (typeof $.fn.template === 'function') {
        $applozic.fn.template = $.fn.template;
        jQuery.fn.template = $.fn.template;
    } else if (typeof $applozic.fn.template === 'function') {
        $.fn.template = $applozic.fn.template;
        jQuery.fn.template = $applozic.fn.template;
    }
}
function MckCallingService(identity,token,callId,toUserDisplayName,isCallHost,callStartTime,mckMessageService,toUserImage,isAudioCall,ringTone){var _this=this;var $mckVidImageIcon=$applozic("#mck-vid-icon");var $mckSideBox=$applozic("#mck-sidebox");_this.callStartTime=callStartTime;_this.mckMessageService=mckMessageService;_this.identity=identity;_this.token=token;_this.callId=callId;_this.isCallHost=isCallHost;_this.toUserImage=toUserImage;_this.toUserDisplayName=toUserDisplayName;_this.isAudioCall=
isAudioCall;_this.disconectedByHost;_this.rejectedByReceiver;_this.twilioService;console.log("is AudioCall:"+isAudioCall);_this.ringTone=ringTone;var $mck_msg_to=$applozic("#mck-msg-to");var $mck_vid_box=$applozic(".applozic-vid-container");var $mck_side_box=$applozic("#mck-sidebox");var $mck_video_call_indicator=$applozic("#mck-video-call-indicator");var $mck_unmute_icon=$applozic("#mck-unmute-icon");var $mck_mute_icon=$applozic("#mck-mute-icon");var $mck_mute_btn=$applozic("#mck-microfone-mute-btn");
$applozic("#mck-microfone-mute-btn").off("click").on("click",function(){var toUser=$mck_msg_to.val();var room=_this.twilioService.activeRoom;if(room){var localMedia=room.localParticipant.media;if(localMedia.isMuted){$mck_unmute_icon.addClass("vis").removeClass("n-vis");$mck_mute_icon.addClass("n-vis").removeClass("vis");$mck_mute_btn.addClass("mck-unmuted").removeClass("mck-muted");localMedia.unmute()}else{$mck_mute_icon.addClass("vis").removeClass("n-vis");$mck_unmute_icon.addClass("n-vis").removeClass("vis");
$mck_mute_btn.addClass("mck-muted").removeClass("mck-unmuted");localMedia.mute()}}});$applozic("#mck-vid-disconnect").off("click").on("click",function(){var toUser=$mck_msg_to.val();if(isCallHost){_this.disconectedByHost=true;if(_this.twilioService.callReceivedAt){var callDurationInMilis=(new Date).getTime()-_this.twilioService.callReceivedAt.getTime();alMessageService.sendVideoCallEndMessage(callId,"CALL_END",103,false,callDurationInMilis,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)})}else{_this.ringTone.stop();
alMessageService.sendVideoCallMessage(callId,"CALL_MISSED",103,false,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)})}}_this.twilioService.leaveRoomIfJoined();_this.removeTracks(["#mck-vid-media \x3e video","#mck-vid-media \x3e audio","#local-media \x3e video","#local-media \x3e audio"]);$mck_vid_box.addClass("n-vis").removeClass("vis");$mck_video_call_indicator.addClass("n-vis").removeClass("vis")});_this.startVideoCall=function(){if(!navigator.webkitGetUserMedia&&!navigator.mozGetUserMedia)alert("WebRTC is not available in your browser. can not start video call");
if(!_this.token){alert("missing token.. can not make video call");$mck_vid_box.removeClass("vis").addClass("n-vis")}_this.twilioService=new TwilioService(_this.identity,_this.token,_this.callId,_this.ringTone,_this.isAudioCall,_this.mckMessageService,_this.isCallHost);var videoClient=_this.twilioService.InitializeVideoClient();if(isCallHost){$mckVidImageIcon.html(toUserImage+"\x3cspan\x3e Calling "+toUserDisplayName+"\x3c/span\x3e");$mckVidImageIcon.removeClass("n-vis").addClass("vis");setTimeout(function(){if(!_this.twilioService.isCallReceived&&
!_this.disconectedByHost&&!_this.rejectedByReceiver){console.log("call is not answered....");_this.ringTone.stop();alMessageService.sendVideoCallMessage(callId,"CALL_MISSED",103,isAudioCall,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)});alert(toUserDisplayName+" not Available....");_this.twilioService.leaveRoomIfJoined();_this.removeTracks(["#mck-vid-media \x3e video","#mck-vid-media \x3e audio","#local-media \x3e video","#local-media \x3e audio"]);$mck_vid_box.addClass("n-vis").removeClass("vis")}},
7E4)}window.addEventListener("beforeunload",_this.twilioService.leaveRoomIfJoined);_this.twilioService.attachUserMedia(isCallHost,isAudioCall);_this.twilioService.joinCall(isAudioCall);$mck_vid_box.removeClass("n-vis").addClass("vis");$mck_unmute_icon.addClass("vis").removeClass("n-vis");$mck_mute_icon.addClass("n-vis").removeClass("vis");$mck_mute_btn.addClass("mck-unmuted").removeClass("mck-muted")};_this.removeTracks=function(selectors){$applozic.each(selectors,function(index,value){$applozic(value).remove()})}}
function TwilioService(identity,token,callId,ringTone,isAudioCall,mckMessageService,isCallHost){var _this=this;_this.identity=identity;_this.token=token;_this.callId=callId;_this.videoClient;_this.activeRoom;_this.previewMedia;_this.ringTone=ringTone;_this.isCallReceived;_this.callReceivedAt;_this.isAudioCall=isAudioCall;_this.mckMessageService=mckMessageService;_this.isCallHost=isCallHost;var $mck_msg_to=$applozic("#mck-msg-to");var $mckVidImageIcon=$applozic("#mck-vid-icon");var localMedia="#local-media";
var mckVidMedia="#mck-vid-media";var $mcklocalVideo=$applozic("#local-media \x3e video");var $mckRemoteVideo=$applozic("#mck-vid-media \x3e video");var $localMedia=$applozic("#local-media");var $mck_vid_box=$applozic(".applozic-vid-container");var $mck_side_box=$applozic("#mck-sidebox");var $mck_video_call_indicator=$applozic("#mck-video-call-indicator");_this.InitializeVideoClient=function(){_this.videoClient=new Twilio.Video.Client(_this.token)};_this.joinCall=function(isAudioCall){if(_this.videoClient)_this.videoClient.connect({to:_this.callId}).then(_this.roomJoined,
function(error){console.log("Could not connect to Twilio: "+error.message)})};_this.attachUserMedia=function(isCallHost,isAudioCall){if(!_this.previewMedia){_this.previewMedia=new Twilio.Video.LocalMedia;Twilio.Video.getUserMedia().then(function(mediaStream){_this.previewMedia.addStream(mediaStream);if(isCallHost){_this.previewMedia.attach(mckVidMedia);_this.ringTone.play()}else{_this.previewMedia.attach(localMedia);$localMedia.removeClass("n-vis").addClass("vis")}},function(error){console.error("Unable to access local media",
error);console.log("Unable to access Camera and Microphone")})}};_this.roomJoined=function(room){console.log("room detail : "+room);_this.activeRoom=room;if(!_this.previewMedia)room.localParticipant.media.attach(mckVidMedia);room.participants.forEach(function(participant){console.log("Already in Room: '"+participant.identity+"'");participant.media.attach("#mck-vid-media")});room.on("participantConnected",function(participant){console.log("participent- "+participant.identity+"connected to the room- "+
room);_this.isCallReceived=true;_this.callReceivedAt=new Date;console.log("callReceivedAt : "+_this.callReceivedAt);_this.ringTone.stop();$mckVidImageIcon.addClass("n-vis");$applozic("#mck-vid-media \x3e video").remove();$applozic("#mck-vid-media \x3e audio").remove();room.localParticipant.media.attach(localMedia);$localMedia.removeClass("n-vis").addClass("vis");participant.media.attach(mckVidMedia)});room.on("participantDisconnected",function(participant){console.log("Participant '"+participant.identity+
"' left the room");if(_this.isCallHost){var toUser=$mck_msg_to.val();var callDurationInMilis=(new Date).getTime();_this.callReceivedAt.getTime();alMessageService.sendVideoCallEndMessage(callId,"CALL_END",103,isAudioCall,callDurationInMilis,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)})}participant.media.detach();_this.leaveRoomIfJoined();$mck_vid_box.addClass("n-vis").removeClass("vis");$mck_video_call_indicator.addClass("n-vis").removeClass("vis")});room.on("disconnected",
function(){console.log("Left");room.localParticipant.media.detach();room.participants.forEach(function(participant){participant.media.detach()});_this.activeRoom=null})};_this.leaveRoomIfJoined=function leaveRoomIfJoined(){if(_this.activeRoom)_this.activeRoom.disconnect();if(_this.previewMedia)_this.previewMedia.stop()}}
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.SockJS=t()}}(function(){var t;return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code=
"MODULE_NOT_FOUND",c;}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){(function(n){var r=t("./transport-list");e.exports=t("./main")(r),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,
"./transport-list":16}],2:[function(t,e){function n(){i.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var r=t("inherits"),i=t("./event");r(n,i),e.exports=n},{"./event":4,inherits:54}],3:[function(t,e){function n(){i.call(this)}var r=t("inherits"),i=t("./eventtarget");r(n,i),n.prototype.removeAllListeners=function(t){t?delete this._listeners[t]:this._listeners={}},n.prototype.once=function(t,e){function n(){r.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}
var r=this,i=!1;this.on(t,n)},n.prototype.emit=function(t){var e=this._listeners[t];if(e)for(var n=Array.prototype.slice.call(arguments,1),r=0;r<e.length;r++)e[r].apply(this,n)},n.prototype.on=n.prototype.addListener=i.prototype.addEventListener,n.prototype.removeListener=i.prototype.removeEventListener,e.exports.EventEmitter=n},{"./eventtarget":5,inherits:54}],4:[function(t,e){function n(t){this.type=t}n.prototype.initEvent=function(t,e,n){return this.type=t,this.bubbles=e,this.cancelable=n,this.timeStamp=
+new Date,this},n.prototype.stopPropagation=function(){},n.prototype.preventDefault=function(){},n.CAPTURING_PHASE=1,n.AT_TARGET=2,n.BUBBLING_PHASE=3,e.exports=n},{}],5:[function(t,e){function n(){this._listeners={}}n.prototype.addEventListener=function(t,e){t in this._listeners||(this._listeners[t]=[]);var n=this._listeners[t];-1===n.indexOf(e)&&(n=n.concat([e])),this._listeners[t]=n},n.prototype.removeEventListener=function(t,e){var n=this._listeners[t];if(n){var r=n.indexOf(e);return-1!==r?void(n.length>
1?this._listeners[t]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[t]):void 0}},n.prototype.dispatchEvent=function(t){var e=t.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,n),e in this._listeners)for(var r=this._listeners[e],i=0;i<r.length;i++)r[i].apply(this,n)},e.exports=n},{}],6:[function(t,e){function n(t){i.call(this),this.initEvent("message",!1,!1),this.data=t}var r=t("inherits"),i=t("./event");r(n,i),e.exports=n},{"./event":4,inherits:54}],
7:[function(t,e){function n(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}var r=t("json3"),i=t("./utils/iframe");n.prototype._transportClose=function(t,e){i.postMessage("c",r.stringify([t,e]))},n.prototype._transportMessage=function(t){i.postMessage("t",t)},n.prototype._send=function(t){this._transport.send(t)},n.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},e.exports=n},{"./utils/iframe":47,
json3:55}],8:[function(t,e){var n=t("./utils/url"),r=t("./utils/event"),i=t("json3"),o=t("./facade"),s=t("./info-iframe-receiver"),a=t("./utils/iframe"),u=t("./location");e.exports=function(t,e){var c={};e.forEach(function(t){t.facadeTransport&&(c[t.facadeTransport.transportName]=t.facadeTransport)}),c[s.transportName]=s;var l;t.bootstrap_iframe=function(){var e;a.currentWindowId=u.hash.slice(1);var s=function(r){if(r.source===parent&&("undefined"==typeof l&&(l=r.origin),r.origin===l)){var s;try{s=
i.parse(r.data)}catch(f){return}if(s.windowId===a.currentWindowId)switch(s.type){case "s":var h;try{h=i.parse(s.data)}catch(f){break}var d=h[0],p=h[1],v=h[2],m=h[3];if(d!==t.version)throw new Error('Incompatibile SockJS! Main site uses: "'+d+'", the iframe: "'+t.version+'".');if(!n.isOriginEqual(v,u.href)||!n.isOriginEqual(m,u.href))throw new Error("Can't connect to different domain from within an iframe. ("+u.href+", "+v+", "+m+")");e=new o(new c[p](v,m));break;case "m":e._send(s.data);break;case "c":e&&
e._close(),e=null}}};r.attachEvent("message",s),a.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(t,e){function n(t,e){r.call(this);var n=this,i=+new Date;this.xo=new e("GET",t),this.xo.once("finish",function(t,e){var r,a;if(200===t){if(a=+new Date-i,e)try{r=o.parse(e)}catch(u){}s.isObject(r)||(r={})}n.emit("finish",r,a),n.removeAllListeners()})}var r=t("events").EventEmitter,
i=t("inherits"),o=t("json3"),s=t("./utils/object");i(n,r),n.prototype.close=function(){this.removeAllListeners(),this.xo.close()},e.exports=n},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(t,e){function n(t){var e=this;i.call(this),this.ir=new a(t,s),this.ir.once("finish",function(t,n){e.ir=null,e.emit("message",o.stringify([t,n]))})}var r=t("inherits"),i=t("events").EventEmitter,o=t("json3"),s=t("./transport/sender/xhr-local"),a=t("./info-ajax");r(n,i),n.transportName=
"iframe-info-receiver",n.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},e.exports=n},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(t,e){(function(n){function r(t,e){var r=this;i.call(this);var o=function(){var n=r.ifr=new u(c.transportName,e,t);n.once("message",function(t){if(t){var e;try{e=s.parse(t)}catch(n){return r.emit("finish"),void r.close()}var i=e[0],o=e[1];r.emit("finish",i,o)}r.close()}),n.once("close",
function(){r.emit("finish"),r.close()})};n.document.body?o():a.attachEvent("load",o)}var i=t("events").EventEmitter,o=t("inherits"),s=t("json3"),a=t("./utils/event"),u=t("./transport/iframe"),c=t("./info-iframe-receiver");o(r,i),r.enabled=function(){return u.enabled()},r.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,
"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(t,e){function n(t,e){var n=this;r.call(this),setTimeout(function(){n.doXhr(t,e)},0)}var r=t("events").EventEmitter,i=t("inherits"),o=t("./utils/url"),s=t("./transport/sender/xdr"),a=t("./transport/sender/xhr-cors"),u=t("./transport/sender/xhr-local"),c=t("./transport/sender/xhr-fake"),l=t("./info-iframe"),f=t("./info-ajax");i(n,r),n._getReceiver=function(t,e,n){return n.sameOrigin?new f(e,u):a.enabled?
new f(e,a):s.enabled&&n.sameScheme?new f(e,s):l.enabled()?new l(t,e):new f(e,c)},n.prototype.doXhr=function(t,e){var r=this,i=o.addPath(t,"/info");this.xo=n._getReceiver(t,i,e),this.timeoutRef=setTimeout(function(){r._cleanup(!1),r.emit("finish")},n.timeout),this.xo.once("finish",function(t,e){r._cleanup(!0),r.emit("finish",t,e)})},n.prototype._cleanup=function(t){clearTimeout(this.timeoutRef),this.timeoutRef=null,!t&&this.xo&&this.xo.close(),this.xo=null},n.prototype.close=function(){this.removeAllListeners(),
this._cleanup(!1)},n.timeout=8E3,e.exports=n},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(t,e){(function(t){e.exports=t.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=
typeof window?window:{})},{}],14:[function(t,e){(function(n){function r(t,e,n){if(!(this instanceof r))return new r(t,e,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");y.call(this),this.readyState=r.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&m.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports;var i=n.sessionId||8;if("function"==typeof i)this._generateSessionId=
i;else{if("number"!=typeof i)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return c.string(i)}}this._server=n.server||c.numberString(1E3);var o=new s(t);if(!o.host||!o.protocol)throw new SyntaxError("The URL '"+t+"' is invalid");if(o.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==o.protocol&&"https:"!==o.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+
o.protocol+"' is not allowed.");var a="https:"===o.protocol;if("https"===g.protocol&&!a)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");e?Array.isArray(e)||(e=[e]):e=[];var u=e.sort();u.forEach(function(t,e){if(!t)throw new SyntaxError("The protocols entry '"+t+"' is invalid.");if(e<u.length-1&&t===u[e+1])throw new SyntaxError("The protocols entry '"+t+"' is duplicated.");});var l=f.getOrigin(g.href);this._origin=l?l.toLowerCase():
null,o.set("pathname",o.pathname.replace(/\/+$/,"")),this.url=o.href,this._urlInfo={nullOrigin:!v.hasDomain(),sameOrigin:f.isOriginEqual(this.url,g.href),sameScheme:f.isSchemeEqual(this.url,g.href)},this._ir=new _(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function i(t){return 1E3===t||t>=3E3&&4999>=t}t("./shims");var o,s=t("url-parse"),a=t("inherits"),u=t("json3"),c=t("./utils/random"),l=t("./utils/escape"),f=t("./utils/url"),h=t("./utils/event"),d=t("./utils/transport"),
p=t("./utils/object"),v=t("./utils/browser"),m=t("./utils/log"),b=t("./event/event"),y=t("./event/eventtarget"),g=t("./location"),w=t("./event/close"),x=t("./event/trans-message"),_=t("./info-receiver");a(r,y),r.prototype.close=function(t,e){if(t&&!i(t))throw new Error("InvalidAccessError: Invalid code");if(e&&e.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==r.CLOSING&&this.readyState!==r.CLOSED){var n=!0;this._close(t||1E3,e||"Normal closure",n)}},
r.prototype.send=function(t){if("string"!=typeof t&&(t=""+t),this.readyState===r.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===r.OPEN&&this._transport.send(l.quote(t))},r.version=t("./version"),r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.prototype._receiveInfo=function(t,e){if(this._ir=null,!t)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(e),this._transUrl=t.base_url?t.base_url:this.url,t=p.extend(t,
this._urlInfo);var n=o.filterToEnabled(this._transportsWhitelist,t);this._transports=n.main,this._connect()},r.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(t.needBody&&(!n.document.body||"undefined"!=typeof n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return this._transports.unshift(t),void h.attachEvent("load",this._connect.bind(this));var e=this._rto*t.roundTrips||5E3;this._transportTimeoutId=
setTimeout(this._transportTimeout.bind(this),e);var r=f.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),i=new t(r,this._transUrl);return i.on("message",this._transportMessage.bind(this)),i.once("close",this._transportClose.bind(this)),i.transportName=t.transportName,void(this._transport=i)}this._close(2E3,"All transports failed",!1)},r.prototype._transportTimeout=function(){this.readyState===r.CONNECTING&&this._transportClose(2007,"Transport timed out")},r.prototype._transportMessage=
function(t){var e,n=this,r=t.slice(0,1),i=t.slice(1);switch(r){case "o":return void this._open();case "h":return void this.dispatchEvent(new b("heartbeat"))}if(i)try{e=u.parse(i)}catch(o){}if("undefined"!=typeof e)switch(r){case "a":Array.isArray(e)&&e.forEach(function(t){n.dispatchEvent(new x(t))});break;case "m":this.dispatchEvent(new x(e));break;case "c":Array.isArray(e)&&2===e.length&&this._close(e[0],e[1],!0)}},r.prototype._transportClose=function(t,e){return this._transport&&(this._transport.removeAllListeners(),
this._transport=null,this.transport=null),i(t)||2E3===t||this.readyState!==r.CONNECTING?void this._close(t,e):void this._connect()},r.prototype._open=function(){this.readyState===r.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=r.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new b("open"))):this._close(1006,"Server lost session")},r.prototype._close=function(t,e,n){var i=!1;if(this._ir&&(i=!0,this._ir.close(),
this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===r.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=r.CLOSING,setTimeout(function(){this.readyState=r.CLOSED,i&&this.dispatchEvent(new b("error"));var o=new w("close");o.wasClean=n||!1,o.code=t||1E3,o.reason=e,this.dispatchEvent(o),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},r.prototype.countRTO=function(t){return t>100?4*
t:300+t},e.exports=function(e){return o=d(e),t("./iframe-bootstrap")(r,e),r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,
"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":56}],15:[function(){function t(t){var e=+t;return e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function e(t){return t>>>0}function n(){}var r,i=Array.prototype,o=Object.prototype,s=Function.prototype,a=String.prototype,u=i.slice,c=o.toString,l=function(t){return"[object Function]"===o.toString.call(t)},f=function(t){return"[object Array]"===c.call(t)},h=function(t){return"[object String]"===c.call(t)},d=
Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}();r=d?function(t,e,n,r){!r&&e in t||Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(t,e,n,r){!r&&e in t||(t[e]=n)};var p=function(t,e,n){for(var i in e)o.hasOwnProperty.call(e,i)&&r(t,i,e[i],n)},v=function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return Object(t)};p(s,{bind:function(t){var e=this;if(!l(e))throw new TypeError("Function.prototype.bind called on incompatible "+
e);for(var r=u.call(arguments,1),i=function(){if(this instanceof c){var n=e.apply(this,r.concat(u.call(arguments)));return Object(n)===n?n:this}return e.apply(t,r.concat(u.call(arguments)))},o=Math.max(0,e.length-r.length),s=[],a=0;o>a;a++)s.push("$"+a);var c=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(i);return e.prototype&&(n.prototype=e.prototype,c.prototype=new n,n.prototype=null),c}}),p(Array,{isArray:f});var m=Object("a"),b="a"!==m[0]||!(0 in
m),y=function(t){var e=!0,n=!0;return t&&(t.call("foo",function(t,n,r){"object"!=typeof r&&(e=!1)}),t.call([1],function(){n="string"==typeof this},"x")),!!t&&e&&n};p(i,{forEach:function(t){var e=v(this),n=b&&h(this)?this.split(""):e,r=arguments[1],i=-1,o=n.length>>>0;if(!l(t))throw new TypeError;for(;++i<o;)i in n&&t.call(r,n[i],i,e)}},!y(i.forEach));var g=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);p(i,{indexOf:function(e){var n=b&&h(this)?this.split(""):v(this),r=n.length>>>0;if(!r)return-1;
var i=0;for(arguments.length>1&&(i=t(arguments[1])),i=i>=0?i:Math.max(0,r+i);r>i;i++)if(i in n&&n[i]===e)return i;return-1}},g);var w=a.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var t=void 0===/()??/.exec("")[1];a.split=function(n,r){var o=this;if(void 0===n&&0===r)return[];if("[object RegExp]"!==c.call(n))return w.call(this,n,r);var s,a,
u,l,f=[],h=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.extended?"x":"")+(n.sticky?"y":""),d=0;for(n=new RegExp(n.source,h+"g"),o+="",t||(s=new RegExp("^"+n.source+"$(?!\\s)",h)),r=void 0===r?-1>>>0:e(r);(a=n.exec(o))&&(u=a.index+a[0].length,!(u>d&&(f.push(o.slice(d,a.index)),!t&&a.length>1&&a[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(a[t]=void 0)}),a.length>1&&a.index<o.length&&i.push.apply(f,a.slice(1)),l=a[0].length,d=u,f.length>=r)));)n.lastIndex===
a.index&&n.lastIndex++;return d===o.length?(l||!n.test(""))&&f.push(""):f.push(o.slice(d)),f.length>r?f.slice(0,r):f}}():"0".split(void 0,0).length&&(a.split=function(t,e){return void 0===t&&0===e?[]:w.call(this,t,e)});var x="\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",_="\u200b",E="["+x+"]",S=new RegExp("^"+E+E+"*"),O=new RegExp(E+E+"*$"),T=a.trim&&(x.trim()||!_.trim());p(a,{trim:function(){if(void 0===this||
null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(S,"").replace(O,"")}},T);var j=a.substr,C="".substr&&"b"!=="0b".substr(-1);p(a,{substr:function(t,e){return j.call(this,0>t&&(t=this.length+t)<0?0:t,e)}},C)},{}],16:[function(t,e){e.exports=[t("./transport/websocket"),t("./transport/xhr-streaming"),t("./transport/xdr-streaming"),t("./transport/eventsource"),t("./transport/lib/iframe-wrap")(t("./transport/eventsource")),t("./transport/htmlfile"),t("./transport/lib/iframe-wrap")(t("./transport/htmlfile")),
t("./transport/xhr-polling"),t("./transport/xdr-polling"),t("./transport/lib/iframe-wrap")(t("./transport/xhr-polling")),t("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(t,e){(function(n){function r(t,e,n,r){var o=this;i.call(this),setTimeout(function(){o._start(t,
e,n,r)},0)}var i=t("events").EventEmitter,o=t("inherits"),s=t("../../utils/event"),a=t("../../utils/url"),u=n.XMLHttpRequest;o(r,i),r.prototype._start=function(t,e,n,i){var o=this;try{this.xhr=new u}catch(c){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();e=a.addQuery(e,"t\x3d"+ +new Date),this.unloadRef=s.unloadAdd(function(){o._cleanup(!0)});try{this.xhr.open(t,e,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){o.emit("finish",
0,""),o._cleanup(!1)})}catch(l){return this.emit("finish",0,""),void this._cleanup(!1)}if(i&&i.noCredentials||!r.supportsCORS||(this.xhr.withCredentials="true"),i&&i.headers)for(var f in i.headers)this.xhr.setRequestHeader(f,i.headers[f]);this.xhr.onreadystatechange=function(){if(o.xhr){var t,e,n=o.xhr;switch(n.readyState){case 3:try{e=n.status,t=n.responseText}catch(r){}1223===e&&(e=204),200===e&&t&&t.length>0&&o.emit("chunk",e,t);break;case 4:e=n.status,1223===e&&(e=204),(12005===e||12029===e)&&
(e=0),o.emit("finish",e,n.responseText),o._cleanup(!1)}}};try{o.xhr.send(n)}catch(l){o.emit("finish",0,""),o._cleanup(!1)}},r.prototype._cleanup=function(t){if(this.xhr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),t)try{this.xhr.abort()}catch(e){}this.unloadRef=this.xhr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!!u;var c=["Active"].concat("Object").join("X");!r.enabled&&c in n&&
(u=function(){try{return new n[c]("Microsoft.XMLHTTP")}catch(t){return null}},r.enabled=!!new u);var l=!1;try{l="withCredentials"in new u}catch(f){}r.supportsCORS=l,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(t,e){(function(t){e.exports=t.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:
"undefined"!=typeof window?window:{})},{}],19:[function(t,e){(function(t){e.exports=t.WebSocket||t.MozWebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(t,e){function n(t){if(!n.enabled())throw new Error("Transport created when disabled");i.call(this,t,"/eventsource",o,s)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./receiver/eventsource"),s=t("./sender/xhr-cors"),a=t("eventsource");r(n,i),n.enabled=function(){return!!a},
n.transportName="eventsource",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(t,e){function n(t){if(!i.enabled)throw new Error("Transport created when disabled");s.call(this,t,"/htmlfile",i,o)}var r=t("inherits"),i=t("./receiver/htmlfile"),o=t("./sender/xhr-local"),s=t("./lib/ajax-based");r(n,s),n.enabled=function(t){return i.enabled&&t.sameOrigin},n.transportName="htmlfile",n.roundTrips=2,e.exports=n},
{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(t,e){function n(t,e,r){if(!n.enabled())throw new Error("Transport created when disabled");o.call(this);var i=this;this.origin=a.getOrigin(r),this.baseUrl=r,this.transUrl=e,this.transport=t,this.windowId=l.string(8);var s=a.addPath(r,"/iframe.html")+"#"+this.windowId;this.iframeObj=u.createIframe(s,function(t){i.emit("close",1006,"Unable to load an iframe ("+t+")"),i.close()}),this.onmessageCallback=
this._message.bind(this),c.attachEvent("message",this.onmessageCallback)}var r=t("inherits"),i=t("json3"),o=t("events").EventEmitter,s=t("../version"),a=t("../utils/url"),u=t("../utils/iframe"),c=t("../utils/event"),l=t("../utils/random");r(n,o),n.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){c.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(t){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},n.prototype._message=
function(t){if(a.isOriginEqual(t.origin,this.origin)){var e;try{e=i.parse(t.data)}catch(n){return}if(e.windowId===this.windowId)switch(e.type){case "s":this.iframeObj.loaded(),this.postMessage("s",i.stringify([s,this.transport,this.transUrl,this.baseUrl]));break;case "t":this.emit("message",e.data);break;case "c":var r;try{r=i.parse(e.data)}catch(n){return}this.emit("close",r[0],r[1]),this.close()}}},n.prototype.postMessage=function(t,e){this.iframeObj.post(i.stringify({windowId:this.windowId,type:t,
data:e||""}),this.origin)},n.prototype.send=function(t){this.postMessage("m",t)},n.enabled=function(){return u.iframeEnabled},n.transportName="iframe",n.roundTrips=2,e.exports=n},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(t,e){(function(n){function r(t){if(!r.enabled())throw new Error("Transport created when disabled");o.call(this,t,"/jsonp",a,s)}var i=t("inherits"),o=t("./lib/sender-receiver"),
s=t("./receiver/jsonp"),a=t("./sender/jsonp");i(r,o),r.enabled=function(){return!!n.document},r.transportName="jsonp-polling",r.roundTrips=1,r.needBody=!0,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(t,e){function n(t){return function(e,n,r){var i={};"string"==typeof n&&(i.headers={"Content-type":"text/plain"});var s=o.addPath(e,
"/xhr_send"),a=new t("POST",s,n,i);return a.once("finish",function(t){return a=null,200!==t&&204!==t?r(new Error("http status "+t)):void r()}),function(){a.close(),a=null;var t=new Error("Aborted");t.code=1E3,r(t)}}}function r(t,e,r,i){s.call(this,t,e,n(i),r,i)}var i=t("inherits"),o=t("../../utils/url"),s=t("./sender-receiver");i(r,s),e.exports=r},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(t,e){function n(t,e){i.call(this),this.sendBuffer=[],this.sender=e,
this.url=t}var r=t("inherits"),i=t("events").EventEmitter;r(n,i),n.prototype.send=function(t){this.sendBuffer.push(t),this.sendStop||this.sendSchedule()},n.prototype.sendScheduleWait=function(){var t,e=this;this.sendStop=function(){e.sendStop=null,clearTimeout(t)},t=setTimeout(function(){e.sendStop=null,e.sendSchedule()},25)},n.prototype.sendSchedule=function(){var t=this;if(this.sendBuffer.length>0){var e="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,e,function(e){t.sendStop=
null,e?(t.emit("close",e.code||1006,"Sending error: "+e),t._cleanup()):t.sendScheduleWait()}),this.sendBuffer=[]}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.stop=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},e.exports=n},{debug:void 0,events:3,inherits:54}],26:[function(t,e){(function(n){var r=t("inherits"),i=t("../iframe"),o=t("../../utils/object");e.exports=function(t){function e(e,n){i.call(this,t.transportName,e,n)}return r(e,i),e.enabled=
function(e,r){if(!n.document)return!1;var s=o.extend({},r);return s.sameOrigin=!0,t.enabled(s)&&i.enabled()},e.transportName="iframe-"+t.transportName,e.needBody=!0,e.roundTrips=i.roundTrips+t.roundTrips-1,e.facadeTransport=t,e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(t,e){function n(t,e,n){i.call(this),this.Receiver=t,this.receiveUrl=e,this.AjaxObject=n,this._scheduleReceiver()}
var r=t("inherits"),i=t("events").EventEmitter;r(n,i),n.prototype._scheduleReceiver=function(){var t=this,e=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);e.on("message",function(e){t.emit("message",e)}),e.once("close",function(n,r){t.poll=e=null,t.pollIsClosing||("network"===r?t._scheduleReceiver():(t.emit("close",n||1006,r),t.removeAllListeners()))})},n.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},e.exports=n},{debug:void 0,
events:3,inherits:54}],28:[function(t,e){function n(t,e,n,r,a){var u=i.addPath(t,e),c=this;o.call(this,t,n),this.poll=new s(r,u,a),this.poll.on("message",function(t){c.emit("message",t)}),this.poll.once("close",function(t,e){c.poll=null,c.emit("close",t,e),c.close()})}var r=t("inherits"),i=t("../../utils/url"),o=t("./buffered-sender"),s=t("./polling");r(n,o),n.prototype.close=function(){this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null),this.stop()},e.exports=n},{"../../utils/url":52,
"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(t,e){function n(t){i.call(this);var e=this,n=this.es=new o(t);n.onmessage=function(t){e.emit("message",decodeURI(t.data))},n.onerror=function(t){var r=2!==n.readyState?"network":"permanent";e._cleanup(),e._close(r)}}var r=t("inherits"),i=t("events").EventEmitter,o=t("eventsource");r(n,i),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){var t=this.es;t&&(t.onmessage=t.onerror=
null,t.close(),this.es=null)},n.prototype._close=function(t){var e=this;setTimeout(function(){e.emit("close",null,t),e.removeAllListeners()},200)},e.exports=n},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(t,e){(function(n){function r(t){a.call(this);var e=this;o.polluteGlobalNamespace(),this.id="a"+u.string(6),t=s.addQuery(t,"c\x3d"+decodeURIComponent(o.WPrefix+"."+this.id));var i=r.htmlfileEnabled?o.createHtmlfile:o.createIframe;n[o.WPrefix][this.id]={start:function(){e.iframeObj.loaded()},
message:function(t){e.emit("message",t)},stop:function(){e._cleanup(),e._close("network")}},this.iframeObj=i(t,function(){e._cleanup(),e._close("permanent")})}var i=t("inherits"),o=t("../../utils/iframe"),s=t("../../utils/url"),a=t("events").EventEmitter,u=t("../../utils/random");i(r,a),r.prototype.abort=function(){this._cleanup(),this._close("user")},r.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[o.WPrefix][this.id]},r.prototype._close=function(t){this.emit("close",
null,t),this.removeAllListeners()},r.htmlfileEnabled=!1;var c=["Active"].concat("Object").join("X");if(c in n)try{r.htmlfileEnabled=!!new n[c]("htmlfile")}catch(l){}r.enabled=r.htmlfileEnabled||o.iframeEnabled,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(t,e){(function(n){function r(t){var e=this;c.call(this),
i.polluteGlobalNamespace(),this.id="a"+o.string(6);var s=a.addQuery(t,"c\x3d"+encodeURIComponent(i.WPrefix+"."+this.id));n[i.WPrefix][this.id]=this._callback.bind(this),this._createScript(s),this.timeoutId=setTimeout(function(){e._abort(new Error("JSONP script loaded abnormally (timeout)"))},r.timeout)}var i=t("../../utils/iframe"),o=t("../../utils/random"),s=t("../../utils/browser"),a=t("../../utils/url"),u=t("inherits"),c=t("events").EventEmitter;u(r,c),r.prototype.abort=function(){if(n[i.WPrefix][this.id]){var t=
new Error("JSONP user aborted read");t.code=1E3,this._abort(t)}},r.timeout=35E3,r.scriptErrorTimeout=1E3,r.prototype._callback=function(t){this._cleanup(),this.aborting||(t&&this.emit("message",t),this.emit("close",null,"network"),this.removeAllListeners())},r.prototype._abort=function(t){this._cleanup(),this.aborting=!0,this.emit("close",t.code,t.message),this.removeAllListeners()},r.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),
this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete n[i.WPrefix][this.id]},r.prototype._scriptError=function(){var t=this;this.errorTimer||(this.errorTimer=setTimeout(function(){t.loadedOkay||t._abort(new Error("JSONP script loaded abnormally (onerror)"))},r.scriptErrorTimeout))},r.prototype._createScript=function(t){var e,r=this,i=this.script=n.document.createElement("script");if(i.id="a"+o.string(8),
i.src=t,i.type="text/javascript",i.charset="UTF-8",i.onerror=this._scriptError.bind(this),i.onload=function(){r._abort(new Error("JSONP script loaded abnormally (onload)"))},i.onreadystatechange=function(){if(/loaded|closed/.test(i.readyState)){if(i&&i.htmlFor&&i.onclick){r.loadedOkay=!0;try{i.onclick()}catch(t){}}i&&r._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof i.async&&n.document.attachEvent)if(s.isOpera())e=this.script2=n.document.createElement("script"),
e.text="try{var a \x3d document.getElementById('"+i.id+"'); if(a)a.onerror();}catch(x){};",i.async=e.async=!1;else{try{i.htmlFor=i.id,i.event="onclick"}catch(a){}i.async=!0}"undefined"!=typeof i.async&&(i.async=!0);var u=n.document.getElementsByTagName("head")[0];u.insertBefore(i,u.firstChild),e&&u.insertBefore(e,u.firstChild)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,
"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(t,e){function n(t,e){i.call(this);var n=this;this.bufferPosition=0,this.xo=new e("POST",t,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(t,e){n._chunkHandler(t,e),n.xo=null;var r=200===t?"network":"permanent";n.emit("close",null,r),n._cleanup()})}var r=t("inherits"),i=t("events").EventEmitter;r(n,i),n.prototype._chunkHandler=function(t,e){if(200===t&&e)for(var n=-1;;this.bufferPosition+=
n+1){var r=e.slice(this.bufferPosition);if(n=r.indexOf("\n"),-1===n)break;var i=r.slice(0,n);i&&this.emit("message",i)}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},e.exports=n},{debug:void 0,events:3,inherits:54}],33:[function(t,e){(function(n){function r(t){try{return n.document.createElement('\x3ciframe name\x3d"'+t+'"\x3e')}catch(e){var r=n.document.createElement("iframe");
return r.name=t,r}}function i(){o=n.document.createElement("form"),o.style.display="none",o.style.position="absolute",o.method="POST",o.enctype="application/x-www-form-urlencoded",o.acceptCharset="UTF-8",s=n.document.createElement("textarea"),s.name="d",o.appendChild(s),n.document.body.appendChild(o)}var o,s,a=t("../../utils/random"),u=t("../../utils/url");e.exports=function(t,e,n){o||i();var c="a"+a.string(8);o.target=c,o.action=u.addQuery(u.addPath(t,"/jsonp_send"),"i\x3d"+c);var l=r(c);l.id=c,
l.style.display="none",o.appendChild(l);try{s.value=e}catch(f){}o.submit();var h=function(t){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,setTimeout(function(){l.parentNode.removeChild(l),l=null},500),s.value="",n(t))};return l.onerror=function(){h()},l.onload=function(){h()},l.onreadystatechange=function(t){"complete"===l.readyState&&h()},function(){h(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:
{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(t,e){(function(n){function r(t,e,n){var r=this;i.call(this),setTimeout(function(){r._start(t,e,n)},0)}var i=t("events").EventEmitter,o=t("inherits"),s=t("../../utils/event"),a=t("../../utils/browser"),u=t("../../utils/url");o(r,i),r.prototype._start=function(t,e,r){var i=this,o=new n.XDomainRequest;e=u.addQuery(e,"t\x3d"+ +new Date),o.onerror=function(){i._error()},o.ontimeout=function(){i._error()},o.onprogress=function(){i.emit("chunk",
200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},this.xdr=o,this.unloadRef=s.unloadAdd(function(){i._cleanup(!0)});try{this.xdr.open(t,e),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(r)}catch(a){this._error()}},r.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},r.prototype._cleanup=function(t){if(this.xdr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=
this.xdr.onload=null,t)try{this.xdr.abort()}catch(e){}this.unloadRef=this.xdr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!(!n.XDomainRequest||!a.hasDomain()),e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(t,e){function n(t,e,n,r){i.call(this,t,e,n,r)}var r=t("inherits"),i=t("../driver/xhr");
r(n,i),n.enabled=i.enabled&&i.supportsCORS,e.exports=n},{"../driver/xhr":17,inherits:54}],36:[function(t,e){function n(){var t=this;r.call(this),this.to=setTimeout(function(){t.emit("finish",200,"{}")},n.timeout)}var r=t("events").EventEmitter,i=t("inherits");i(n,r),n.prototype.close=function(){clearTimeout(this.to)},n.timeout=2E3,e.exports=n},{events:3,inherits:54}],37:[function(t,e){function n(t,e,n){i.call(this,t,e,n,{noCredentials:!0})}var r=t("inherits"),i=t("../driver/xhr");r(n,i),n.enabled=
i.enabled,e.exports=n},{"../driver/xhr":17,inherits:54}],38:[function(t,e){function n(t){if(!n.enabled())throw new Error("Transport created when disabled");s.call(this);var e=this,o=i.addPath(t,"/websocket");o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),this.url=o,this.ws=new a(this.url),this.ws.onmessage=function(t){e.emit("message",t.data)},this.unloadRef=r.unloadAdd(function(){e.ws.close()}),this.ws.onclose=function(t){e.emit("close",t.code,t.reason),e._cleanup()},this.ws.onerror=function(t){e.emit("close",
1006,"WebSocket connection broken"),e._cleanup()}}var r=t("../utils/event"),i=t("../utils/url"),o=t("inherits"),s=t("events").EventEmitter,a=t("./driver/websocket");o(n,s),n.prototype.send=function(t){var e="["+t+"]";this.ws.send(e)},n.prototype.close=function(){this.ws&&this.ws.close(),this._cleanup()},n.prototype._cleanup=function(){var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),r.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},n.enabled=function(){return!!a},
n.transportName="websocket",n.roundTrips=2,e.exports=n},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(t,e){function n(t){if(!a.enabled)throw new Error("Transport created when disabled");i.call(this,t,"/xhr",s,a)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./xdr-streaming"),s=t("./receiver/xhr"),a=t("./sender/xdr");r(n,i),n.enabled=o.enabled,n.transportName="xdr-polling",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,
"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(t,e){function n(t){if(!s.enabled)throw new Error("Transport created when disabled");i.call(this,t,"/xhr_streaming",o,s)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./receiver/xhr"),s=t("./sender/xdr");r(n,i),n.enabled=function(t){return t.cookie_needed||t.nullOrigin?!1:s.enabled&&t.sameScheme},n.transportName="xdr-streaming",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],
41:[function(t,e){function n(t){if(!a.enabled&&!s.enabled)throw new Error("Transport created when disabled");i.call(this,t,"/xhr",o,s)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./receiver/xhr"),s=t("./sender/xhr-cors"),a=t("./sender/xhr-local");r(n,i),n.enabled=function(t){return t.nullOrigin?!1:a.enabled&&t.sameOrigin?!0:s.enabled},n.transportName="xhr-polling",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],
42:[function(t,e){(function(n){function r(t){if(!u.enabled&&!a.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr_streaming",s,a)}var i=t("inherits"),o=t("./lib/ajax-based"),s=t("./receiver/xhr"),a=t("./sender/xhr-cors"),u=t("./sender/xhr-local"),c=t("../utils/browser");i(r,o),r.enabled=function(t){return t.nullOrigin?!1:c.isOpera()?!1:a.enabled},r.transportName="xhr-streaming",r.roundTrips=2,r.needBody=!!n.document,e.exports=r}).call(this,"undefined"!=typeof global?global:
"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(t,e){(function(t){e.exports.randomBytes=t.crypto&&t.crypto.getRandomValues?function(e){var n=new Uint8Array(e);return t.crypto.getRandomValues(n),n}:function(t){for(var e=new Array(t),n=0;t>n;n++)e[n]=Math.floor(256*Math.random());return e}}).call(this,"undefined"!=typeof global?global:"undefined"!=
typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(t,e){(function(t){e.exports={isOpera:function(){return t.navigator&&/opera/i.test(t.navigator.userAgent)},isKonqueror:function(){return t.navigator&&/konqueror/i.test(t.navigator.userAgent)},hasDomain:function(){if(!t.document)return!0;try{return!!t.document.domain}catch(e){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(t,e){var n,
r=t("json3"),i=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
o=function(t){var e,n={},r=[];for(e=0;65536>e;e++)r.push(String.fromCharCode(e));return t.lastIndex=0,r.join("").replace(t,function(t){return n[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,n};e.exports={quote:function(t){var e=r.stringify(t);return i.lastIndex=0,i.test(e)?(n||(n=o(i)),e.replace(i,function(t){return n[t]})):e}}},{json3:55}],46:[function(t,e){(function(n){var r=t("./random"),i={},o=!1,s=n.chrome&&n.chrome.app&&n.chrome.app.runtime;e.exports={attachEvent:function(t,
e){"undefined"!=typeof n.addEventListener?n.addEventListener(t,e,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+t,e),n.attachEvent("on"+t,e))},detachEvent:function(t,e){"undefined"!=typeof n.addEventListener?n.removeEventListener(t,e,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+t,e),n.detachEvent("on"+t,e))},unloadAdd:function(t){if(s)return null;var e=r.string(8);return i[e]=t,o&&setTimeout(this.triggerUnloadCallbacks,0),e},unloadDel:function(t){t in i&&delete i[t]},triggerUnloadCallbacks:function(){for(var t in i)i[t](),
delete i[t]}};var a=function(){o||(o=!0,e.exports.triggerUnloadCallbacks())};s||e.exports.attachEvent("unload",a)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(t,e){(function(n){var r=t("./event"),i=t("json3"),o=t("./browser");e.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){e.exports.WPrefix in n||(n[e.exports.WPrefix]={})},postMessage:function(t,r){n.parent!==n&&n.parent.postMessage(i.stringify({windowId:e.exports.currentWindowId,
type:t,data:r||""}),"*")},createIframe:function(t,e){var i,o,s=n.document.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(t){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unloadDel(o))},c=function(t){s&&(u(),e(t))},l=function(t,e){try{setTimeout(function(){s&&s.contentWindow&&s.contentWindow.postMessage(t,e)},0)}catch(n){}};return s.src=t,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},
s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2E3)},n.document.body.appendChild(s),i=setTimeout(function(){c("timeout")},15E3),o=r.unloadAdd(u),{post:l,cleanup:u,loaded:a}},createHtmlfile:function(t,i){var o,s,a,u=["Active"].concat("Object").join("X"),c=new n[u]("htmlfile"),l=function(){clearTimeout(o),a.onerror=null},f=function(){c&&(l(),r.unloadDel(s),a.parentNode.removeChild(a),a=c=null,CollectGarbage())},h=function(t){c&&(f(),i(t))},d=function(t,e){try{setTimeout(function(){a&&
a.contentWindow&&a.contentWindow.postMessage(t,e)},0)}catch(n){}};c.open(),c.write('\x3chtml\x3e\x3cscript\x3edocument.domain\x3d"'+n.document.domain+'";\x3c/script\x3e\x3c/html\x3e'),c.close(),c.parentWindow[e.exports.WPrefix]=n[e.exports.WPrefix];var p=c.createElement("div");return c.body.appendChild(p),a=c.createElement("iframe"),p.appendChild(a),a.src=t,a.onerror=function(){h("onerror")},o=setTimeout(function(){h("timeout")},15E3),s=r.unloadAdd(f),{post:d,cleanup:f,loaded:l}}},e.exports.iframeEnabled=
!1,n.document&&(e.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!o.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(t,e){(function(t){var n={};["log","debug","warn"].forEach(function(e){var r=t.console&&t.console[e]&&t.console[e].apply;n[e]=r?function(){return t.console[e].apply(t.console,arguments)}:"log"===
e?function(){}:n.log}),e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(t,e){e.exports={isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},extend:function(t){if(!this.isObject(t))return t;for(var e,n,r=1,i=arguments.length;i>r;r++){e=arguments[r];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}}},{}],50:[function(t,e){var n=t("crypto"),r="abcdefghijklmnopqrstuvwxyz012345";
e.exports={string:function(t){for(var e=r.length,i=n.randomBytes(t),o=[],s=0;t>s;s++)o.push(r.substr(i[s]%e,1));return o.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var e=(""+(t-1)).length,n=(new Array(e+1)).join("0");return(n+this.number(t)).slice(-e)}}},{crypto:43}],51:[function(t,e){e.exports=function(t){return{filterToEnabled:function(e,n){var r={main:[],facade:[]};return e?"string"==typeof e&&(e=[e]):e=[],t.forEach(function(t){t&&("websocket"!==t.transportName||
n.websocket!==!1)&&(e.length&&-1===e.indexOf(t.transportName)||t.enabled(n)&&(r.main.push(t),t.facadeTransport&&r.facade.push(t.facadeTransport)))}),r}}}},{debug:void 0}],52:[function(t,e){var n=t("url-parse");e.exports={getOrigin:function(t){if(!t)return null;var e=new n(t);if("file:"===e.protocol)return null;var r=e.port;return r||(r="https:"===e.protocol?"443":"80"),e.protocol+"//"+e.hostname+":"+r},isOriginEqual:function(t,e){var n=this.getOrigin(t)===this.getOrigin(e);return n},isSchemeEqual:function(t,
e){return t.split(":")[0]===e.split(":")[0]},addPath:function(t,e){var n=t.split("?");return n[0]+e+(n[1]?"?"+n[1]:"")},addQuery:function(t,e){return t+(-1===t.indexOf("?")?"?"+e:"\x26"+e)}}},{debug:void 0,"url-parse":56}],53:[function(t,e){e.exports="1.0.3"},{}],54:[function(t,e){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=
e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],55:[function(e,n,r){(function(e){(function(){function i(t,e){function n(t){if(n[t]!==m)return n[t];var i;if("bug-string-char-index"==t)i="a"!="a"[0];else if("json"==t)i=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var u=e.stringify,l="function"==typeof u&&g;if(l){(s=function(){return 1}).toJSON=s;try{l="0"===u(0)&&"0"===u(new r)&&'""'==u(new o)&&u(y)===m&&
u(m)===m&&u()===m&&"1"===u(s)&&"[1]"==u([s])&&"[null]"==u([m])&&"null"==u(null)&&"[null,null,null]"==u([m,y,null])&&u({a:[s,!0,!1,null,"\x00\b\n\f\r\t"]})==a&&"1"===u(null,s)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new c(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==u(new c(864E13))&&'"-000001-01-01T00:00:00.000Z"'==u(new c(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==u(new c(-1))}catch(f){l=!1}}i=l}if("json-parse"==t){var h=e.parse;if("function"==typeof h)try{if(0===
h("0")&&!h(!1)){s=h(a);var d=5==s.a.length&&1===s.a[0];if(d){try{d=!h('"\t"')}catch(f){}if(d)try{d=1!==h("01")}catch(f){}if(d)try{d=1!==h("1.")}catch(f){}}}}catch(f){d=!1}i=d}}return n[t]=!!i}t||(t=u.Object()),e||(e=u.Object());var r=t.Number||u.Number,o=t.String||u.String,a=t.Object||u.Object,c=t.Date||u.Date,l=t.SyntaxError||u.SyntaxError,f=t.TypeError||u.TypeError,h=t.Math||u.Math,d=t.JSON||u.JSON;"object"==typeof d&&d&&(e.stringify=d.stringify,e.parse=d.parse);var p,v,m,b=a.prototype,y=b.toString,
g=new c(-0xc782b5b800cec);try{g=-109252==g.getUTCFullYear()&&0===g.getUTCMonth()&&1===g.getUTCDate()&&10==g.getUTCHours()&&37==g.getUTCMinutes()&&6==g.getUTCSeconds()&&708==g.getUTCMilliseconds()}catch(w){}if(!n("json")){var x="[object Function]",_="[object Date]",E="[object Number]",S="[object String]",O="[object Array]",T="[object Boolean]",j=n("bug-string-char-index");if(!g)var C=h.floor,N=[0,31,59,90,120,151,181,212,243,273,304,334],A=function(t,e){return N[e]+365*(t-1970)+C((t-1969+(e=+(e>1)))/
4)-C((t-1901+e)/100)+C((t-1601+e)/400)};if((p=b.hasOwnProperty)||(p=function(t){var e,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?p=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(e=n.constructor,p=function(t){var n=(this.constructor||e).prototype;return t in this&&!(t in n&&this[t]===n[t])}),n=null,p.call(this,t)}),v=function(t,e){var n,r,i,o=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(i in r)p.call(r,i)&&
o++;return n=r=null,o?v=2==o?function(t,e){var n,r={},i=y.call(t)==x;for(n in t)i&&"prototype"==n||p.call(r,n)||!(r[n]=1)||!p.call(t,n)||e(n)}:function(t,e){var n,r,i=y.call(t)==x;for(n in t)i&&"prototype"==n||!p.call(t,n)||(r="constructor"===n)||e(n);(r||p.call(t,n="constructor"))&&e(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],v=function(t,e){var n,i,o=y.call(t)==x,a=!o&&"function"!=typeof t.constructor&&s[typeof t.hasOwnProperty]&&
t.hasOwnProperty||p;for(n in t)o&&"prototype"==n||!a.call(t,n)||e(n);for(i=r.length;n=r[--i];a.call(t,n)&&e(n));}),v(t,e)},!n("json-stringify")){var k={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},I="000000",L=function(t,e){return(I+(e||0)).slice(-t)},R="\\u00",U=function(t){for(var e='"',n=0,r=t.length,i=!j||r>10,o=i&&(j?t.split(""):t);r>n;n++){var s=t.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=k[s];break;default:if(32>s){e+=R+L(2,s.toString(16));
break}e+=i?o[n]:t.charAt(n)}}return e+'"'},P=function(t,e,n,r,i,o,s){var a,u,c,l,h,d,b,g,w,x,j,N,k,I,R,M;try{a=e[t]}catch(W){}if("object"==typeof a&&a)if(u=y.call(a),u!=_||p.call(a,"toJSON"))"function"==typeof a.toJSON&&(u!=E&&u!=S&&u!=O||p.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&1/0>a){if(A){for(h=C(a/864E5),c=C(h/365.2425)+1970-1;A(c+1,0)<=h;c++);for(l=C((h-A(c,0))/30.42);A(c,l+1)<=h;l++);h=1+h-A(c,l),d=(a%864E5+864E5)%864E5,b=C(d/36E5)%24,g=C(d/6E4)%60,w=C(d/1E3)%60,x=d%1E3}else c=a.getUTCFullYear(),
l=a.getUTCMonth(),h=a.getUTCDate(),b=a.getUTCHours(),g=a.getUTCMinutes(),w=a.getUTCSeconds(),x=a.getUTCMilliseconds();a=(0>=c||c>=1E4?(0>c?"-":"+")+L(6,0>c?-c:c):L(4,c))+"-"+L(2,l+1)+"-"+L(2,h)+"T"+L(2,b)+":"+L(2,g)+":"+L(2,w)+"."+L(3,x)+"Z"}else a=null;if(n&&(a=n.call(e,t,a)),null===a)return"null";if(u=y.call(a),u==T)return""+a;if(u==E)return a>-1/0&&1/0>a?""+a:"null";if(u==S)return U(""+a);if("object"==typeof a){for(I=s.length;I--;)if(s[I]===a)throw f();if(s.push(a),j=[],R=o,o+=i,u==O){for(k=0,
I=a.length;I>k;k++)N=P(k,a,n,r,i,o,s),j.push(N===m?"null":N);M=j.length?i?"[\n"+o+j.join(",\n"+o)+"\n"+R+"]":"["+j.join(",")+"]":"[]"}else v(r||a,function(t){var e=P(t,a,n,r,i,o,s);e!==m&&j.push(U(t)+":"+(i?" ":"")+e)}),M=j.length?i?"{\n"+o+j.join(",\n"+o)+"\n"+R+"}":"{"+j.join(",")+"}":"{}";return s.pop(),M}};e.stringify=function(t,e,n){var r,i,o,a;if(s[typeof e]&&e)if((a=y.call(e))==x)i=e;else if(a==O){o={};for(var u,c=0,l=e.length;l>c;u=e[c++],a=y.call(u),(a==S||a==E)&&(o[u]=1));}if(n)if((a=y.call(n))==
E){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else a==S&&(r=n.length<=10?n:n.slice(0,10));return P("",(u={},u[""]=t,u),i,o,r,"",[])}}if(!n("json-parse")){var M,W,q=o.fromCharCode,D={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},F=function(){throw M=W=null,l();},B=function(){for(var t,e,n,r,i,o=W,s=o.length;s>M;)switch(i=o.charCodeAt(M)){case 9:case 10:case 13:case 32:M++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=j?o.charAt(M):o[M],M++,t;case 34:for(t=
"@",M++;s>M;)if(i=o.charCodeAt(M),32>i)F();else if(92==i)switch(i=o.charCodeAt(++M)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=D[i],M++;break;case 117:for(e=++M,n=M+4;n>M;M++)i=o.charCodeAt(M),i>=48&&57>=i||i>=97&&102>=i||i>=65&&70>=i||F();t+=q("0x"+o.slice(e,M));break;default:F()}else{if(34==i)break;for(i=o.charCodeAt(M),e=M;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++M);t+=o.slice(e,M)}if(34==o.charCodeAt(M))return M++,t;F();default:if(e=M,45==i&&(r=!0,i=o.charCodeAt(++M)),
i>=48&&57>=i){for(48==i&&(i=o.charCodeAt(M+1),i>=48&&57>=i)&&F(),r=!1;s>M&&(i=o.charCodeAt(M),i>=48&&57>=i);M++);if(46==o.charCodeAt(M)){for(n=++M;s>n&&(i=o.charCodeAt(n),i>=48&&57>=i);n++);n==M&&F(),M=n}if(i=o.charCodeAt(M),101==i||69==i){for(i=o.charCodeAt(++M),(43==i||45==i)&&M++,n=M;s>n&&(i=o.charCodeAt(n),i>=48&&57>=i);n++);n==M&&F(),M=n}return+o.slice(e,M)}if(r&&F(),"true"==o.slice(M,M+4))return M+=4,!0;if("false"==o.slice(M,M+5))return M+=5,!1;if("null"==o.slice(M,M+4))return M+=4,null;F()}return"$"},
G=function(t){var e,n;if("$"==t&&F(),"string"==typeof t){if("@"==(j?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=B(),"]"!=t;n||(n=!0))n&&(","==t?(t=B(),"]"==t&&F()):F()),","==t&&F(),e.push(G(t));return e}if("{"==t){for(e={};t=B(),"}"!=t;n||(n=!0))n&&(","==t?(t=B(),"}"==t&&F()):F()),(","==t||"string"!=typeof t||"@"!=(j?t.charAt(0):t[0])||":"!=B())&&F(),e[t.slice(1)]=G(B());return e}F()}return t},J=function(t,e,n){var r=H(t,e,n);r===m?delete t[e]:t[e]=r},H=function(t,e,n){var r,i=t[e];
if("object"==typeof i&&i)if(y.call(i)==O)for(r=i.length;r--;)J(i,r,n);else v(i,function(t){J(i,t,n)});return n.call(t,e,i)};e.parse=function(t,e){var n,r;return M=0,W=""+t,n=G(B()),"$"!=B()&&F(),M=W=null,e&&y.call(e)==x?H((r={},r[""]=n,r),"",e):n}}}return e.runInContext=i,e}var o="function"==typeof t&&t.amd,s={"function":!0,object:!0},a=s[typeof r]&&r&&!r.nodeType&&r,u=s[typeof window]&&window||this,c=a&&s[typeof n]&&n&&!n.nodeType&&"object"==typeof e&&e;if(!c||c.global!==c&&c.window!==c&&c.self!==
c||(u=c),a&&!o)i(u,a);else{var l=u.JSON,f=u.JSON3,h=!1,d=i(u,u.JSON3={noConflict:function(){return h||(h=!0,u.JSON=l,u.JSON3=f,l=f=null),d}});u.JSON={parse:d.parse,stringify:d.stringify}}o&&t(function(){return d})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(t,e){function n(t,e,u){if(!(this instanceof n))return new n(t,e,u);var c,l,f,h,d=s.test(t),p=typeof e,v=this,m=0;for("object"!==p&&"string"!==
p&&(u=e,e=null),u&&"function"!=typeof u&&(u=o.parse),e=i(e);m<a.length;m++)l=a[m],c=l[0],h=l[1],c!==c?v[h]=t:"string"==typeof c?~(f=t.indexOf(c))&&("number"==typeof l[2]?(v[h]=t.slice(0,f),t=t.slice(f+l[2])):(v[h]=t.slice(f),t=t.slice(0,f))):(f=c.exec(t))&&(v[h]=f[1],t=t.slice(0,t.length-f[0].length)),v[h]=v[h]||(l[3]||"port"===h&&d?e[h]||"":""),l[4]&&(v[h]=v[h].toLowerCase());u&&(v.query=u(v.query)),r(v.port,v.protocol)||(v.host=v.hostname,v.port=""),v.username=v.password="",v.auth&&(l=v.auth.split(":"),
v.username=l[0]||"",v.password=l[1]||""),v.href=v.toString()}var r=t("requires-port"),i=t("./lolcation"),o=t("querystringify"),s=/^\/(?!\/)/,a=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];n.prototype.set=function(t,e,n){var i=this;return"query"===t?("string"==typeof e&&(e=(n||o.parse)(e)),i[t]=e):"port"===t?(i[t]=e,r(e,i.protocol)?e&&(i.host=i.hostname+":"+e):(i.host=i.hostname,i[t]="")):
"hostname"===t?(i[t]=e,i.port&&(e+=":"+i.port),i.host=e):"host"===t?(i[t]=e,/\:\d+/.test(e)&&(e=e.split(":"),i.hostname=e[0],i.port=e[1])):i[t]=e,i.href=i.toString(),i},n.prototype.toString=function(t){t&&"function"==typeof t||(t=o.stringify);var e,n=this,r=n.protocol+"//";return n.username&&(r+=n.username,n.password&&(r+=":"+n.password),r+="@"),r+=n.hostname,n.port&&(r+=":"+n.port),r+=n.pathname,n.query&&(e="object"==typeof n.query?t(n.query):n.query,r+=("?"===e.charAt(0)?"":"?")+e),n.hash&&(r+=
n.hash),r},n.qs=o,n.location=i,e.exports=n},{"./lolcation":57,querystringify:58,"requires-port":59}],57:[function(t,e){(function(n){var r,i={hash:1,query:1};e.exports=function(e){e=e||n.location||{},r=r||t("./");var o,s={},a=typeof e;if("blob:"===e.protocol)s=new r(unescape(e.pathname),{});else if("string"===a){s=new r(e,{});for(o in i)delete s[o]}else if("object"===a)for(o in e)o in i||(s[o]=e[o]);return s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=
typeof window?window:{})},{"./":56}],58:[function(t,e,n){function r(t){for(var e,n=/([^=?&]+)=([^&]*)/g,r={};e=n.exec(t);r[decodeURIComponent(e[1])]=decodeURIComponent(e[2]));return r}function i(t,e){e=e||"";var n=[];"string"!=typeof e&&(e="?");for(var r in t)o.call(t,r)&&n.push(encodeURIComponent(r)+"\x3d"+encodeURIComponent(t[r]));return n.length?e+n.join("\x26"):""}var o=Object.prototype.hasOwnProperty;n.stringify=i,n.parse=r},{}],59:[function(t,e){e.exports=function(t,e){if(e=e.split(":")[0],
t=+t,!t)return!1;switch(e){case "http":case "ws":return 80!==t;case "https":case "wss":return 443!==t;case "ftp":return 22!==t;case "gopher":return 70!==t;case "file":return!1}return 0!==t}},{}]},{},[1])(1)}),function(){var t,e,n,r,i={}.hasOwnProperty,o=[].slice;t={LF:"\n",NULL:"\x00"},n=function(){function e(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}var n;return e.prototype.toString=function(){var n,r,o,s,a;n=[this.command],o=this.headers["content-length"]===!1?!0:!1,
o&&delete this.headers["content-length"],a=this.headers;for(r in a)i.call(a,r)&&(s=a[r],n.push(""+r+":"+s));return this.body&&!o&&n.push("content-length:"+e.sizeOfUTF8(this.body)),n.push(t.LF+this.body),n.join(t.LF)},e.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},n=function(n){var r,i,o,s,a,u,c,l,f,h,d,p,v,m,b,y,g;for(s=n.search(RegExp(""+t.LF+t.LF)),a=n.substring(0,s).split(t.LF),o=a.shift(),u={},p=function(t){return t.replace(/^\s+|\s+$/g,"")},y=a.reverse(),v=0,b=y.length;b>
v;v++)h=y[v],l=h.indexOf(":"),u[p(h.substring(0,l))]=p(h.substring(l+1));if(r="",d=s+2,u["content-length"])f=parseInt(u["content-length"]),r=(""+n).substring(d,d+f);else for(i=null,c=m=d,g=n.length;(g>=d?g>m:m>g)&&(i=n.charAt(c),i!==t.NULL);c=g>=d?++m:--m)r+=i;return new e(o,u,r)},e.unmarshall=function(e){var r;return function(){var i,o,s,a;for(s=e.split(RegExp(""+t.NULL+t.LF+"*")),a=[],i=0,o=s.length;o>i;i++)r=s[i],(null!=r?r.length:void 0)>0&&a.push(n(r));return a}()},e.marshall=function(n,r,i){var o;
return o=new e(n,r,i),o.toString()+t.NULL},e}(),e=function(){function e(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1E4,incoming:1E4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var i;return e.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window?(null!=(e=window.console),void 0):void 0},i=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(t,e,r){var i;for(i=n.marshall(t,
e,r),"function"==typeof this.debug&&this.debug("\x3e\x3e\x3e "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining \x3d "+i.length)}},e.prototype._setupHeartbeat=function(e){var n,o,s,a,u,c;if((u=e.version)===r.VERSIONS.V1_1||u===r.VERSIONS.V1_2)return c=function(){var t,n,r,i;for(r=e["heart-beat"].split(","),i=[],t=0,n=r.length;n>
t;t++)a=r[t],i.push(parseInt(a));return i}(),o=c[0],n=c[1],0!==this.heartbeat.outgoing&&0!==n&&(s=Math.max(this.heartbeat.outgoing,n),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=r.setInterval(s,function(e){return function(){return e.ws.send(t.LF),"function"==typeof e.debug?e.debug("\x3e\x3e\x3e PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==o?(s=Math.max(this.heartbeat.incoming,o),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),
this.ponger=r.setInterval(s,function(t){return function(){var e;return e=i()-t.serverActivity,e>2*s?("function"==typeof t.debug&&t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close()):void 0}}(this))):void 0},e.prototype._parseConnect=function(){var t,e,n,r;switch(t=1<=arguments.length?o.call(arguments,0):[],r={},t.length){case 2:r=t[0],e=t[1];break;case 3:t[1]instanceof Function?(r=t[0],e=t[1],n=t[2]):(r.login=t[0],r.passcode=t[1],e=t[2]);break;case 4:r.login=t[0],r.passcode=
t[1],e=t[2],n=t[3];break;default:r.login=t[0],r.passcode=t[1],e=t[2],n=t[3],r.host=t[4]}return[r,e,n]},e.prototype.connect=function(){var e,s,a,u;return e=1<=arguments.length?o.call(arguments,0):[],u=this._parseConnect.apply(this,e),a=u[0],this.connectCallback=u[1],s=u[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){return function(r){var o,a,u,c,l,f,h,d,p,v,m,b;if(c="undefined"!=typeof ArrayBuffer&&r.data instanceof ArrayBuffer?(o=new Uint8Array(r.data),
"function"==typeof e.debug?e.debug("--- got data length: "+o.length):void 0,function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)a=o[t],n.push(String.fromCharCode(a));return n}().join("")):r.data,e.serverActivity=i(),c===t.LF)return void("function"==typeof e.debug&&e.debug("\x3c\x3c\x3c PONG"));for("function"==typeof e.debug&&e.debug("\x3c\x3c\x3c "+c),m=n.unmarshall(c),b=[],p=0,v=m.length;v>p;p++)switch(l=m[p],l.command){case "CONNECTED":"function"==typeof e.debug&&e.debug("connected to server "+
l.headers.server),e.connected=!0,e._setupHeartbeat(l.headers),b.push("function"==typeof e.connectCallback?e.connectCallback(l):void 0);break;case "MESSAGE":d=l.headers.subscription,h=e.subscriptions[d]||e.onreceive,h?(u=e,f=l.headers["message-id"],l.ack=function(t){return null==t&&(t={}),u.ack(f,d,t)},l.nack=function(t){return null==t&&(t={}),u.nack(f,d,t)},b.push(h(l))):b.push("function"==typeof e.debug?e.debug("Unhandled received MESSAGE: "+l):void 0);break;case "RECEIPT":b.push("function"==typeof e.onreceipt?
e.onreceipt(l):void 0);break;case "ERROR":b.push("function"==typeof s?s(l):void 0);break;default:b.push("function"==typeof e.debug?e.debug("Unhandled frame: "+l):void 0)}return b}}(this),this.ws.onclose=function(t){return function(){var e;return e="Whoops! Lost connection to "+t.ws.url,"function"==typeof t.debug&&t.debug(e),t._cleanUp(),"function"==typeof s?s(e):void 0}}(this),this.ws.onopen=function(t){return function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),a["accept-version"]=
r.VERSIONS.supportedVersions(),a["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",a)}}(this)},e.prototype.disconnect=function(t,e){return null==e&&(e={}),this._transmit("DISCONNECT",e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},e.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&r.clearInterval(this.pinger),this.ponger?r.clearInterval(this.ponger):void 0},e.prototype.send=function(t,e,n){return null==
e&&(e={}),null==n&&(n=""),e.destination=t,this._transmit("SEND",e,n)},e.prototype.subscribe=function(t,e,n){var r;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),r=this,{id:n.id,unsubscribe:function(){return r.unsubscribe(n.id)}}},e.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},e.prototype.begin=function(t){var e,n;return n=t||"tx-"+this.counter++,this._transmit("BEGIN",
{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},e.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},e.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},e.prototype.ack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},e.prototype.nack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},e}(),
r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,n){var i,o;return null==n&&(n=["v10.stomp","v11.stomp"]),i=r.WebSocketClass||WebSocket,o=new i(t,n),new e(o)},over:function(t){return new e(t)},Frame:n},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=r),"undefined"!=typeof window&&null!==window?(r.setInterval=function(t,e){return window.setInterval(e,t)},r.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=
r):exports||(self.Stomp=r)}.call(this);var w=window,d=document;var MCK_LABELS;var MCK_BASE_URL;var MCK_CURR_LATITIUDE=40.7324319;var MCK_CURR_LONGITUDE=-73.82480777777776;var mckUtils=new MckUtils;var mckDateUtils=new MckDateUtils;var mckContactUtils=new MckContactUtils;var mckMapUtils=new MckMapUtils;
function MckUtils(){var _this=this;var TEXT_NODE=3,ELEMENT_NODE=1,TAGS_BLOCK=["p","div","pre","form"];_this.init=function(){var initurl=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/v2/tab/initialize.page":"https://apps.applozic.com/v2/tab/initialize.page";var messurl=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/rest/ws/message/list":"https://apps.applozic.com/rest/ws/message/list";$applozic.ajax({url:initurl,contentType:"application/json",type:"OPTIONS"}).done(function(data){});$applozic.ajax({url:messurl,contentType:"application/json",
type:"OPTIONS"}).done(function(data){})};_this.showElement=function(element){if(element){element.classList.remove("n-vis");element.classList.add("vis")}};_this.hideElement=function(element){if(element){element.classList.remove("vis");element.classList.add("n-vis")}};_this.badgeCountOnLaucher=function(enablebadgecount,totalunreadCount){var element=document.getElementById("applozic-badge-count");if(enablebadgecount===true&&totalunreadCount>0){element.innerHTML=totalunreadCount;element.classList.add("mck-badge-count")}if(enablebadgecount===
true&&totalunreadCount===0){element.innerHTML="";element.classList.remove("mck-badge-count")}};_this.randomId=function(){return w.Math.random().toString(36).substring(7)};_this.textVal=function($element){var lines=[];var line=[];var flush=function(){lines.push(line.join(""));line=[]};var sanitizeNode=function(node){if(node.nodeType===TEXT_NODE)line.push(node.nodeValue);else if(node.nodeType===ELEMENT_NODE){var tagName=node.tagName.toLowerCase();var isBlock=TAGS_BLOCK.indexOf(tagName)!==-1;if(isBlock&&
line.length)flush();if(tagName==="img"){var alt=node.getAttribute("alt")||"";if(alt)line.push(alt);return}else if(tagName==="style")return;else if(tagName==="br")flush();var children=node.childNodes;for(var i=0;i<children.length;i++)sanitizeNode(children[i]);if(isBlock&&line.length)flush()}};var children=$element.childNodes;for(var i=0;i<children.length;i++)sanitizeNode(children[i]);if(line.length)flush();return lines.join("\n")};_this.mouseX=function(evt){if(evt.pageX)return evt.pageX;else if(evt.clientX)return evt.clientX+
(d.documentElement.scrollLeft?d.documentElement.scrollLeft:d.body.scrollLeft);else return null};_this.mouseY=function(evt){if(evt.pageY)return evt.pageY;else if(evt.clientY)return evt.clientY+(d.documentElement.scrollTop?d.documentElement.scrollTop:d.body.scrollTop);else return null};_this.startsWith=function(matcher,str){if(str===null||typeof matcher==="undefined")return false;var i=str.length;if(matcher.length<i)return false;for(--i;i>=0&&matcher[i]===str[i];--i)continue;return i<0};_this.setEndOfContenteditable=
function(contentEditableElement){var range,selection;if(document.createRange){range=document.createRange();range.selectNodeContents(contentEditableElement);range.collapse(false);selection=window.getSelection();selection.removeAllRanges();selection.addRange(range)}else if(document.selection){range=document.body.createTextRange();range.moveToElementText(contentEditableElement);range.collapse(false);range.select()}};this.encryptionKey=null;this.getEncryptionKey=function(){return this.encryptionKey};
this.setEncryptionKey=function(key){this.encryptionKey=key};_this.b64EncodeUnicode=function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))};_this.b64DecodeUnicode=function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))};_this.ajax=function(options){var reqOptions=$applozic.extend({},{},options);if(this.getEncryptionKey()){var key=
aesjs.util.convertStringToBytes(this.getEncryptionKey());var iv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(reqOptions.type.toLowerCase()==="post"){while(options.data.length%16!=0)options.data+=" ";var aesCtr=new aesjs.ModeOfOperation.ecb(key);var bytes=aesjs.util.convertStringToBytes(options.data);var encryptedBytes=aesCtr.encrypt(bytes);var encryptedStr=String.fromCharCode.apply(null,encryptedBytes);reqOptions.data=btoa(encryptedStr)}reqOptions.success=function(data){var decodedData=atob(data);var arr=
[];for(var i=0;i<decodedData.length;i++)arr.push(decodedData.charCodeAt(i));var aesCtr=new aesjs.ModeOfOperation.ecb(key);var decryptedBytes=aesCtr.decrypt(arr);var res=aesjs.util.convertBytesToString(decryptedBytes);res=res.replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"");if(_this.isJsonString(res))options.success(JSON.parse(res));else options.success(res)}}$applozic.ajax(reqOptions)};_this.isJsonString=function(str){try{JSON.parse(str)}catch(e){return false}return true}}
function MckContactUtils(){var _this=this;_this.getContactId=function(contact){var contactId=contact.contactId;return _this.formatContactId(contactId)};_this.formatContactId=function(contactId){if(contactId.indexOf("+")===0)contactId=contactId.substring(1);contactId=decodeURIComponent(contactId);return $applozic.trim(contactId.replace(/\@/g,"AT").replace(/\./g,"DOT").replace(/\*/g,"STAR").replace(/\#/g,"HASH").replace(/\|/g,"VBAR").replace(/\+/g,"PLUS").replace(/\;/g,"SCOLON").replace(/\?/g,"QMARK").replace(/\,/g,
"COMMA").replace(/\:/g,"COLON"))}}function MckMapUtils(){var _this=this;_this.getCurrentLocation=function(succFunc,errFunc){w.navigator.geolocation.getCurrentPosition(succFunc,errFunc)};_this.getSelectedLocation=function(){return{lat:MCK_CURR_LATITIUDE,lon:MCK_CURR_LONGITUDE}}}
function MckDateUtils(){var _this=this;var fullDateFormat="mmm d, h:MM TT";var onlyDateFormat="mmm d";var onlyTimeFormat="h:MM TT";var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];_this.getDate=function(createdAtTime){var date=new Date(parseInt(createdAtTime,10));var currentDate=new Date;return currentDate.getDate()===date.getDate()&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear()?dateFormat(date,onlyTimeFormat,false):dateFormat(date,
fullDateFormat,false)};_this.getLastSeenAtStatus=function(lastSeenAtTime){var date=new Date(parseInt(lastSeenAtTime,10));var currentDate=new Date;if(currentDate.getDate()===date.getDate()&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear()){var hoursDiff=currentDate.getHours()-date.getHours();var timeDiff=w.Math.floor((currentDate.getTime()-date.getTime())/6E4);if(timeDiff<60)return timeDiff<=1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS["min"]+" "+MCK_LABELS["ago"]:MCK_LABELS["last.seen"]+
" "+timeDiff+MCK_LABELS["mins"]+" "+MCK_LABELS["ago"];return hoursDiff===1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS["hour"]+" "+MCK_LABELS["ago"]:MCK_LABELS["last.seen"]+" "+hoursDiff+MCK_LABELS["hours"]+" "+MCK_LABELS["ago"]}else if(currentDate.getDate()-date.getDate()===1&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear())return MCK_LABELS["last.seen.on"]+" "+MCK_LABELS["yesterday"];else return MCK_LABELS["last.seen.on"]+" "+dateFormat(date,onlyDateFormat,false)};
_this.getTimeOrDate=function(createdAtTime,timeFormat){var date=new Date(parseInt(createdAtTime,10));var currentDate=new Date;if(timeFormat)return currentDate.getDate()===date.getDate()&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear()?dateFormat(date,onlyTimeFormat,false):dateFormat(date,onlyDateFormat,false);else return dateFormat(date,fullDateFormat,false)};_this.getSystemDate=function(time){var date=new Date(parseInt(time,10));return dateFormat(date,fullDateFormat,
false)};_this.convertMilisIntoTime=function(millisec){var duration;var milliseconds=parseInt(millisec%1E3/100),seconds=parseInt(millisec/1E3%60),minutes=parseInt(millisec/(1E3*60)%60),hours=parseInt(millisec/(1E3*60*60)%24);if(hours>0)duration=hours+" Hr "+minutes+" Min "+seconds+" Sec";else if(minutes>0)duration=minutes+" Min "+seconds+" Sec";else duration=seconds+" Sec ";return duration};var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=
/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};return function(date,mask,utc){var dF=dateFormat;if(arguments.length===1&&Object.prototype.toString.call(date)==="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}date=date?new Date(date):new Date;if(isNaN(date))throw SyntaxError("invalid date");
mask=String(mask);if(mask.slice(0,4)==="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||
12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?w.Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(w.Math.floor(w.Math.abs(o)/60)*100+w.Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!==10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"mmm d, yyyy h:MM TT",
fullDateFormat:"mmm d, yyyy h:MM TT",onlyDateFormat:"mmm d",onlyTimeFormat:"h:MM TT",mailDateFormat:"mmm d, yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday",
"Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}(function(window){function define_Applozic(){var Applozic={};Applozic.init=function(){};return Applozic}if(typeof Applozic==="undefined")window.Applozic=define_Applozic();else console.log("Applozic already defined.")})(window);
var ALStorage=function(win){var MCK_LATEST_MESSAGE_ARRAY=[];var MCK_MESSAGE_ARRAY=[];var MCK_MESSAGE_MAP=[];var MCK_CONTACT_NAME_ARRAY=[];var FRIEND_LIST_GROUP_NAME;var FRIEND_LIST_GROUP_TYPE;return{clearApplozicSessionStorage:function(){ALStorage.clearMckMessageArray();ALStorage.clearAppHeaders();ALStorage.clearMckContactNameArray()},updateLatestMessage:function(message){var messageArray=[];messageArray.push(message);ALStorage.updateLatestMessageArray(messageArray);ALStorage.updateMckMessageArray(messageArray)},
getLatestMessageArray:function(){return typeof w.sessionStorage!=="undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray")):MCK_LATEST_MESSAGE_ARRAY},getFriendListGroupName:function(){return typeof w.sessionStorage!=="undefined"?w.sessionStorage.getItem("friendListGroupName"):FRIEND_LIST_GROUP_NAME},setFriendListGroupName:function(friendListGroupName){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("friendListGroupName",friendListGroupName);else FRIEND_LIST_GROUP_NAME=
friendListGroupName},setFriendListGroupType:function(friendListGroupType){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("friendListGroupType",friendListGroupType);else FRIEND_LIST_GROUP_TYPE=friendListGroupType},getFriendListGroupType:function(){return typeof w.sessionStorage!=="undefined"?w.sessionStorage.getItem("friendListGroupType"):FRIEND_LIST_GROUP_TYPE},setLatestMessageArray:function(messages){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("mckLatestMessageArray",
w.JSON.stringify(messages));else MCK_LATEST_MESSAGE_ARRAY=messages},updateLatestMessageArray:function(mckMessageArray){if(typeof w.sessionStorage!=="undefined"){var mckLocalMessageArray=$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray"));if(mckLocalMessageArray!==null){mckLocalMessageArray=mckLocalMessageArray.concat(mckMessageArray);w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(mckLocalMessageArray))}else w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(mckMessageArray));
return mckMessageArray}else{MCK_LATEST_MESSAGE_ARRAY=MCK_LATEST_MESSAGE_ARRAY.concat(mckMessageArray);return MCK_LATEST_MESSAGE_ARRAY}},getMckMessageArray:function(){return typeof w.sessionStorage!=="undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray")):MCK_MESSAGE_ARRAY},clearMckMessageArray:function(){if(typeof w.sessionStorage!=="undefined"){w.sessionStorage.removeItem("mckMessageArray");w.sessionStorage.removeItem("mckLatestMessageArray")}else{MCK_MESSAGE_ARRAY.length=0;
MCK_LATEST_MESSAGE_ARRAY.length=0}},clearAppHeaders:function(){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.removeItem("mckAppHeaders")},setAppHeaders:function(data){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("mckAppHeaders",w.JSON.stringify(data))},getAppHeaders:function(data){return typeof w.sessionStorage!=="undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckAppHeaders")):{}},getMessageByKey:function(key){return MCK_MESSAGE_MAP[key]},updateMckMessageArray:function(mckMessageArray){for(var i=
0;i<mckMessageArray.length;i++){var message=mckMessageArray[i];MCK_MESSAGE_MAP[message.key]=message}if(typeof w.sessionStorage!=="undefined"){var mckLocalMessageArray=$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray"));if(mckLocalMessageArray!==null){mckLocalMessageArray=mckLocalMessageArray.concat(mckMessageArray);w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(mckLocalMessageArray))}else w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(mckMessageArray));return mckMessageArray}else{MCK_MESSAGE_ARRAY=
MCK_MESSAGE_ARRAY.concat(mckMessageArray);return MCK_MESSAGE_ARRAY}},getMckContactNameArray:function(){return typeof w.sessionStorage!=="undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray")):MCK_CONTACT_NAME_ARRAY},setMckContactNameArray:function(mckContactNameArray){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(mckContactNameArray));else MCK_CONTACT_NAME_ARRAY=mckContactNameArray},updateMckContactNameArray:function(mckContactNameArray){if(typeof w.sessionStorage!==
"undefined"){var mckLocalcontactNameArray=$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray"));if(mckLocalcontactNameArray!==null)mckContactNameArray=mckContactNameArray.concat(mckLocalcontactNameArray);w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(mckContactNameArray));return mckContactNameArray}else{MCK_CONTACT_NAME_ARRAY=MCK_CONTACT_NAME_ARRAY.concat(mckContactNameArray);return MCK_CONTACT_NAME_ARRAY}},clearMckContactNameArray:function(){if(typeof w.sessionStorage!==
"undefined")w.sessionStorage.removeItem("mckContactNameArray");else MCK_CONTACT_NAME_ARRAY.length=0}}}(window);
(function(window){function define_ALApiService(getBaseUrl){var ALApiService={};var MCK_APP_ID="";var mckUtils=new MckUtils;var MCK_BASE_URL="https://apps.applozic.com";var INITIALIZE_APP_URL="/v2/tab/initialize.page";var MESSAGE_LIST_URL="/rest/ws/message/list";var MESSAGE_SEND_URL="/rest/ws/message/send";var GROUP_CREATE_URL="/rest/ws/group/create";var GROUP_LIST_URL="/rest/ws/group/list";var GROUP_INFO_URL="/rest/ws/group/v2/info";var GROUP_ADD_MEMBER_URL="/rest/ws/group/add/member";var GROUP_REMOVE_MEMBER_URL=
"/rest/ws/group/remove/member";var GROUP_LEFT_URL="/rest/ws/group/left";var GROUP_UPDATE_URL="/rest/ws/group/update";var GROUP_IS_USER_PRESENT_URL="/rest/ws/group/check/user";var GROUP_USER_COUNT_URL="/rest/ws/group/user/count";var FRIEND_LIST_URL="/rest/ws/group/";var GET_USER_DETAIL_URL="/rest/ws/user/v2/detail";var UPDATE_USER_DETAIL_URL="/rest/ws/user/update";var USER_FILTER="/rest/ws/user/filter";var LOGOUT="/rest/ws/device/logout";var USER_FILTER_BY_ROLE="/rest/ws/user/v3/filter";var USER_BLOCK_URL=
"/rest/ws/user/block";var USER_UNBLOCK_URL="/rest/ws/user/unblock";var UPDATE_PASSWORD_URL="/rest/ws/user/update/password";var UPDATE_REPLY_MAP="/rest/ws/message/detail";var MESSAGE_DELETE_URL="/rest/ws/message/delete";var MESSAGE_READ_UPDATE_URL="/rest/ws/message/read";var MESSAGE_DELIVERY_UPDATE_URL="/rest/ws/message/delivered";var CONVERSATION_CLOSE_UPDATE_URL="/rest/ws/conversation/close";var FILE_PREVIEW_URL="/rest/ws/aws/file";var FILE_UPLOAD_URL="/rest/ws/aws/file/url";var FILE_AWS_UPLOAD_URL=
"/rest/ws/upload/file";var FILE_DELETE_URL="/rest/ws/aws/file/delete";var MESSAGE_ADD_INBOX_URL="/rest/ws/message/add/inbox";var CONVERSATION_READ_UPDATE_URL="/rest/ws/message/read/conversation";var CONVERSATION_DELETE_URL="/rest/ws/message/delete/conversation";var ONE_TO_ONE_MUTE_URL="/rest/ws/user/chat/mute";var GROUP_MUTE_URL="/rest/ws/group/user/update";var REGISTER_CLIENT_URL="/rest/ws/register/client";var SYNC_MUTE_USER_URL="/rest/ws/user/chat/mute/list";var TOPIC_ID_URL="/rest/ws/conversation/topicId";
var CONTACT_NAME_URL="/rest/ws/user/info";var USER_STATUS_URL="/rest/ws/user/chat/status";var CONVERSATION_FETCH_URL="/rest/ws/conversation/get";var CONVERSATION_ID_URL="/rest/ws/conversation/id";var FILE_AWS_UPLOAD_URL="/rest/ws/upload/file";var ATTACHMENT_UPLOAD_URL="/rest/ws/upload/image";var PUSH_NOTIFICATION_LOGOUT="/rest/ws/device/logout";var MCK_SW_REGISTER_URL="/rest/ws/plugin/update/sw/id";var ACCESS_TOKEN;var DEVICE_KEY;var APP_MODULE_NAME;var AUTH_CODE;function getAsUriParameters(data){var url=
"";for(var prop in data)url+=encodeURIComponent(prop)+"\x3d"+encodeURIComponent(data[prop])+"\x26";return url.substring(0,url.length-1)}ALApiService.initServerUrl=function(serverUrl){MCK_BASE_URL=serverUrl};ALApiService.login=function(options){MCK_APP_ID=options.data.alUser.applicationId;MCK_BASE_URL=options.data.baseUrl?options.data.baseUrl:"https://apps.applozic.com";ALApiService.ajax({url:MCK_BASE_URL+INITIALIZE_APP_URL,skipEncryption:true,type:"post",async:typeof options.async!=="undefined"?options.async:
true,data:JSON.stringify(options.data.alUser),contentType:"application/json",headers:{"Application-Key":MCK_APP_ID},success:function(response){mckUtils.setEncryptionKey(response.encryptionKey);AUTH_CODE=btoa(response.userId+":"+response.deviceKey);DEVICE_KEY=response.deviceKey;ACCESS_TOKEN=options.data.alUser.password;APP_MODULE_NAME=options.data.alUser.appModuleName;ALApiService.setAjaxHeaders(AUTH_CODE,MCK_APP_ID,response.deviceKey,options.data.alUser.password,options.data.alUser.appModuleName);
if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.getAttachmentHeaders=function(){var headers={"UserId-Enabled":true,"Authorization":"Basic "+AUTH_CODE,"Application-Key":MCK_APP_ID,"Device-Key":DEVICE_KEY};if(ACCESS_TOKEN)headers["Access-Token"]=ACCESS_TOKEN;return headers},ALApiService.setAjaxHeaders=function(authcode,appId,devKey,accToken,modName){MCK_APP_ID=appId;AUTH_CODE=authcode;DEVICE_KEY=devKey;ACCESS_TOKEN=accToken;
APP_MODULE_NAME=modName};ALApiService.ajax=function(options){function extend(){for(var i=1;i<arguments.length;i++)for(var key in arguments[i])if(arguments[i].hasOwnProperty(key))arguments[0][key]=arguments[i][key];return arguments[0]}var reqOptions=extend({},{},options);if(!(options.skipEncryption===true)&&mckUtils.getEncryptionKey()){var key=aesjs.util.convertStringToBytes(mckUtils.getEncryptionKey());var iv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(reqOptions.type.toLowerCase()==="post"){while(options.data.length%
16!=0)options.data+=" ";var aesCtr=new aesjs.ModeOfOperation.ecb(key);var bytes=aesjs.util.convertStringToBytes(options.data);var encryptedBytes=aesCtr.encrypt(bytes);var encryptedStr=String.fromCharCode.apply(null,encryptedBytes);reqOptions.data=btoa(encryptedStr)}reqOptions.success=function(data){var decodedData=atob(data);var arr=[];for(var i=0;i<decodedData.length;i++)arr.push(decodedData.charCodeAt(i));var aesCtr=new aesjs.ModeOfOperation.ecb(key);var decryptedBytes=aesCtr.decrypt(arr);var res=
aesjs.util.convertBytesToString(decryptedBytes);res=res.replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"");if(mckUtils.isJsonString(res))options.success(JSON.parse(res));else options.success(res)}}var request=new XMLHttpRequest;var responsedata;var asyn=true;var cttype;if(typeof reqOptions.async!=="undefined"||options.async)asyn=reqOptions.async;var typ=reqOptions.type.toUpperCase();if(typ==="GET"&&typeof reqOptions.data!=="undefined")reqOptions.url=reqOptions.url+"?"+reqOptions.data;request.open(typ,
reqOptions.url,asyn);if(typ==="POST"||typ==="GET"){if(typeof reqOptions.contentType==="undefined")cttype="application/x-www-form-urlencoded; charset\x3dUTF-8";else cttype=reqOptions.contentType;request.setRequestHeader("Content-Type",cttype)}MCK_BASE_URL=MCK_BASE_URL?MCK_BASE_URL:"https://apps.applozic.com";if(reqOptions.url.indexOf(MCK_BASE_URL)!==-1){request.setRequestHeader("UserId-Enabled",true);if(AUTH_CODE)request.setRequestHeader("Authorization","Basic "+AUTH_CODE);request.setRequestHeader("Application-Key",
MCK_APP_ID);if(DEVICE_KEY)request.setRequestHeader("Device-Key",DEVICE_KEY);if(ACCESS_TOKEN)request.setRequestHeader("Access-Token",ACCESS_TOKEN);if(APP_MODULE_NAME)request.setRequestHeader("App-Module-Name",APP_MODULE_NAME)}if(typeof reqOptions.data==="undefined")request.send();else request.send(reqOptions.data);request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE)if(request.status===200){var contType=request.getResponseHeader("Content-Type");if(typeof contType==="undefined"||
contType==="null"||contType===null)contType="";if(contType.toLowerCase().indexOf("text/html")!=-1)responsedata=request.responseXML;else if(contType.toLowerCase().indexOf("application/json")!=-1)responsedata=JSON.parse(request.responseText);else responsedata=request.responseText;reqOptions.success(responsedata)}else reqOptions.error(responsedata)}};ALApiService.getMessages=function(options){if(options.data.userId||options.data.groupId){if(options.data.pageSize==="undefined")options.data.pageSize=30}else if(typeof options.data.mainPageSize===
"undefined")options.data.mainPageSize=60;var data=getAsUriParameters(options.data);var response=new Object;ALApiService.ajax({url:MCK_BASE_URL+MESSAGE_LIST_URL+"?"+data,async:typeof options.async!=="undefined"?options.async:true,type:"get",success:function(data){response.status="success";response.data=data;if(options.success)options.success(response);return},error:function(xhr,desc,err){response.status="error";if(options.error)options.error(response)}})};ALApiService.sendMessage=function(options){ALApiService.ajax({type:"POST",
url:MCK_BASE_URL+MESSAGE_SEND_URL,global:false,data:JSON.stringify(options.data.message),async:typeof options.async!=="undefined"?options.async:true,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.sendDeliveryUpdate=function(options){ALApiService.ajax({url:MCK_BASE_URL+MESSAGE_DELIVERY_UPDATE_URL,data:"key\x3d"+options.data.key,global:false,type:"get",async:typeof options.async!==
"undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.sendReadUpdate=function(options){ALApiService.ajax({url:MCK_BASE_URL+MESSAGE_READ_UPDATE_URL,data:"key\x3d"+options.data.key,global:false,type:"get",async:typeof options.async!=="undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};
ALApiService.deleteMessage=function(options){ALApiService.ajax({url:MCK_BASE_URL+MESSAGE_DELETE_URL+"?key\x3d"+options.data.key,global:false,type:"get",async:typeof options.async!=="undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.updateReplyMessage=function(options){ALApiService.ajax({url:MCK_BASE_URL+UPDATE_REPLY_MAP+"?keys\x3d"+options.data.key,type:"get",async:typeof options.async!==
"undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.deleteConversation=function(options){ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_DELETE_URL,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,data:getAsUriParameters(options.data),success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};
ALApiService.createGroup=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_CREATE_URL,global:false,data:JSON.stringify(options.data.group),type:"post",async:typeof options.async!=="undefined"?options.async:true,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.loadGroups=function(options){if(options.baseUrl)MCK_BASE_URL=options.baseUrl;ALApiService.ajax({url:MCK_BASE_URL+
GROUP_LIST_URL,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.getGroupInfo=function(options){var groupId=options.data.group.groupId?"?groupId\x3d"+options.data.group.groupId:"?clientGroupId\x3d"+options.group.clientGroupId;ALApiService.ajax({url:MCK_BASE_URL+GROUP_INFO_URL+groupId,type:"get",async:typeof options.async!==
"undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.addGroupMember=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_ADD_MEMBER_URL,type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.removeGroupMember=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_REMOVE_MEMBER_URL,type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.groupLeave=
function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_LEFT_URL,type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.groupUpdate=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_UPDATE_URL,type:"POST",data:JSON.stringify(options.data.group),
async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response,options.data.group)},error:function(response){if(options.error)options.error(response)}})};ALApiService.isUserPresentInGroup=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_IS_USER_PRESENT_URL+"?userId\x3d"+options.data.userId+"\x26clientGroupId\x3d"+options.data.clientGroupId,type:"get",async:typeof options.async!==
"undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.groupUserCount=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_USER_COUNT_URL+"?clientGroupIds\x3d"+options.data.clientGroupId,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};
ALApiService.groupDelete=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_LEFT_URL+"?clientGroupId\x3d"+options.data.clientGroupId,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.createUserFriendList=function(options){ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.data.group.groupName+
"/add/",type:"POST",async:typeof options.async!=="undefined"?options.async:true,global:false,data:JSON.stringify(options.data.group.groupMemberList),contentType:"application/json",success:function(response){if(options.success){options.success(response);ALStorage.setFriendListGroupName(options.data.group.groupName)}},error:function(response){if(options.error)options.error(response)}})};ALApiService.createOpenFriendList=function(options){ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.data.group.groupName+
"/add/members",type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success){options.success(response);ALStorage.setFriendListGroupName(options.data.group.groupName);ALStorage.setFriendListGroupType(options.data.group.type)}},error:function(response){if(options.error)options.error(response)}})};ALApiService.getFriendList=function(options){var getFriendListUrl=
options.data.type!=="null"?"/get?groupType\x3d9":"/get";options.data.url=options.data.url?options.data.url:getFriendListUrl;ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.data.groupName+options.data.url,type:"GET",async:typeof options.data.async!=="undefined"?options.data.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.removeUserFromFriendList=
function(options){var getFriendListUrl=options.group.type?"/remove?userId\x3d"+options.group.userId+"\x26groupType\x3d9":"/remove?userId\x3d"+options.group.userId;ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.group.groupName+getFriendListUrl,type:"Post",contentType:"application/json",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};
ALApiService.deleteFriendList=function(options){var getFriendListUrl=options.group.type?"/delete?groupType\x3d9":"/delete";ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.group.groupName+getFriendListUrl,type:"GET",async:false,contentType:"application/json",async:typeof options.async!=="undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.getUserDetail=function(options){ALApiService.ajax({url:MCK_BASE_URL+
GET_USER_DETAIL_URL,data:JSON.stringify({userIdList:options.data.userIdList}),type:"POST",async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.updateUserDetail=function(options){ALApiService.ajax({url:MCK_BASE_URL+UPDATE_USER_DETAIL_URL,data:JSON.stringify(options.data),type:"POST",async:typeof options.async!==
"undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.updatePassword=function(options){ALApiService.ajax({url:MCK_BASE_URL+UPDATE_PASSWORD_URL+"?oldPassword\x3d"+options.data.oldPassword+"\x26newPassword\x3d"+options.data.newPassword,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.getContactList=function(options){var baseurl=options.baseUrl?options.baseUrl:MCK_BASE_URL;ALApiService.ajax({url:options.baseUrl+USER_FILTER+options.url,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.userChatMute=function(options){ALApiService.ajax({url:MCK_BASE_URL+
ONE_TO_ONE_MUTE_URL+"?userId\x3d"+options.data.userId+"\x26notificationAfterTime\x3d"+options.data.notificationAfterTime,type:"post",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.groupMute=function(options){var group={};group.clientGroupId=options.data.clientGroupId;group.notificationAfterTime=options.data.notificationAfterTime;ALApiService.ajax({url:MCK_BASE_URL+GROUP_MUTE_URL,type:"post",
data:JSON.stringify(group),contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.syncMuteUserList=function(options){ALApiService.ajax({url:MCK_BASE_URL+SYNC_MUTE_USER_URL,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.blockUser=function(options){ALApiService.ajax({url:MCK_BASE_URL+
USER_BLOCK_URL+"?userId\x3d"+options.data.userId+"\x26block\x3d"+options.data.isBlock,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.unBlockUser=function(options){ALApiService.ajax({url:MCK_BASE_URL+USER_UNBLOCK_URL+"?userId\x3d"+options.data.userId,type:"GET",async:typeof options.async!=="undefined"?options.async:
true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.sendConversationCloseUpdate=function(options){var data="id\x3d"+options.conversationId;ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_CLOSE_UPDATE_URL,data:data,global:false,type:"get",success:function(){},error:function(){}})};ALApiService.fileUpload=function(options){ALApiService.ajax({type:"GET",url:options.data.url,global:false,
data:"data\x3d"+(new Date).getTime(),crosDomain:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.sendAttachment=function(options){var data=new FormData;var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(e){var file=this.responseText;var message=options.data.messagePxy;if(file){message.fileMeta=JSON.parse(file);Applozic.ALApiService.sendMessage({data:{message},success:function(response){console.log(response)},
error:function(){}})}});data.append("file",options.data.file);xhr.open("post",MCK_BASE_URL+ATTACHMENT_UPLOAD_URL,true);xhr.setRequestHeader("UserId-Enabled",true);xhr.setRequestHeader("Authorization","Basic "+AUTH_CODE);xhr.setRequestHeader("Application-Key",MCK_APP_ID);xhr.setRequestHeader("Device-Key",DEVICE_KEY);if(ACCESS_TOKEN)xhr.setRequestHeader("Access-Token",ACCESS_TOKEN);xhr.send(data)};ALApiService.deleteFileMeta=function(options){ALApiService.ajax({url:options.data.url,type:"post",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.addMessageInbox=function(options){ALApiService.ajax({type:"GET",url:MCK_BASE_URL+MESSAGE_ADD_INBOX_URL,global:false,data:"sender\x3d"+encodeURIComponent(options.data.sender)+"\x26messageContent\x3d"+encodeURIComponent(options.data.messageContent),contentType:"text/plain",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.conversationReadUpdate=
function(options){ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_READ_UPDATE_URL,data:options.data,global:false,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.sendSubscriptionIdToServer=function(options){var subscriptionId=options.data.subscriptionId;ALApiService.ajax({url:MCK_BASE_URL+MCK_SW_REGISTER_URL,type:"post",data:"registrationId\x3d"+subscriptionId,success:function(data){},
error:function(xhr,desc,err){if(xhr.status===401){sessionStorage.clear();console.log("Please reload page.")}}})};ALApiService.getTopicId=function(options){var conversationId="id\x3d"+options.data.conversationId;ALApiService.ajax({url:MCK_BASE_URL+TOPIC_ID_URL+"?"+conversationId,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.getContactDisplayName=function(options){var userIdArray=
options.data.userIdArray;if(userIdArray.length>0&&userIdArray[0]){var data="";var uniqueUserIdArray=userIdArray.filter(function(item,pos){return userIdArray.indexOf(item)===pos});for(var i=0;i<uniqueUserIdArray.length;i++){var userId=uniqueUserIdArray[i];if(typeof MCK_CONTACT_NAME_MAP[userId]==="undefined")data+="userIds\x3d"+encodeURIComponent(userId)+"\x26"}if(data.lastIndexOf("\x26")===data.length-1)data=data.substring(0,data.length-1);if(data)ALApiService.ajax({url:MCK_BASE_URL+CONTACT_NAME_URL,
data:data,global:false,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})}};ALApiService.getUserStatus=function(options){ALApiService.ajax({url:MCK_BASE_URL+USER_STATUS_URL,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.fetchConversationByTopicId=function(options){var reqdata=
"topic\x3d"+options.data.topicId;if(options.data.tabId)reqdata+=""+options.data.isGroup==="true"?"\x26groupId\x3d"+options.data.tabId:"\x26userId\x3d"+encodeURIComponent(options.data.tabId);else if(options.data.clientGroupId)reqdata+="\x26clientGroupId\x3d"+options.data.clientGroupId;else return false;if(options.data.pageSize)reqdata+="\x26pageSize\x3d"+options.data.pageSize;ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_FETCH_URL,data:reqdata,type:"get",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.success(response)}})};ALApiService.getConversationId=function(options){ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_ID_URL,global:false,data:w.JSON.stringify(options.data),type:"post",contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.registerClientApi=function(options){ALApiService.ajax({url:MCK_BASE_URL+REGISTER_CLIENT_URL,
type:"post",data:JSON.stringify(options.data.userPxy),contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.logout=function(options){ALApiService.ajax({url:MCK_BASE_URL+LOGOUT,type:"post",async:typeof options.async!=="undefined"?options.async:true,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};
ALApiService.getUsersByRole=function(options){var data=getAsUriParameters(options.data);ALApiService.ajax({url:MCK_BASE_URL+USER_FILTER_BY_ROLE+"?"+data,global:false,type:"get",contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.pushNotificationLogout=function(options){ALApiService.ajax({url:MCK_BASE_URL+PUSH_NOTIFICATION_LOGOUT,type:"post",async:typeof options.async!==
"undefined"?options.async:true,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};return ALApiService}if(typeof ALApiService==="undefined")window.Applozic.ALApiService=define_ALApiService();else console.log("ALApiService already defined.")})(window);
(function(window){function define_ALSocket(){var ALSocket={};var MCK_APP_ID;var events={};var subscriber=null;ALSocket.stompClient=null;var TYPING_TAB_ID="";ALSocket.typingSubscriber=null;var openGroupSubscriber=[];var checkConnectedIntervalId;var sendConnectedStatusIntervalId;var OPEN_GROUP_SUBSCRIBER_MAP;ALSocket.mck_typing_status=0;var MCK_TYPING_STATUS;var SOCKET="";var MCK_WEBSOCKET_URL="https://apps.applozic.com";var MCK_TOKEN;var USER_DEVICE_KEY;var mckUtils=new MckUtils;ALSocket.init=function(appId,
data,_events){if(appId)MCK_APP_ID=appId;if(typeof data!=="undefined"){MCK_TOKEN=data.token;USER_DEVICE_KEY=data.deviceKey;MCK_WEBSOCKET_URL=data.websocketUrl}events=_events;if(typeof MCK_WEBSOCKET_URL!=="undefined"){var port=!mckUtils.startsWith(MCK_WEBSOCKET_URL,"https")?"15674":"15675";if(typeof SockJS==="function"){if(!SOCKET)SOCKET=new SockJS(MCK_WEBSOCKET_URL+":"+port+"/stomp");ALSocket.stompClient=Stomp.over(SOCKET);ALSocket.stompClient.heartbeat.outgoing=0;ALSocket.stompClient.heartbeat.incoming=
0;ALSocket.stompClient.onclose=function(){ALSocket.disconnect()};ALSocket.stompClient.connect("guest","guest",ALSocket.onConnect,ALSocket.onError,"/");window.addEventListener("beforeunload",function(e){var check_url=e.target.activeElement.href;if(!check_url||0===check_url.length)ALSocket.disconnect()})}}};ALSocket.checkConnected=function(isFetchMessages){if(ALSocket.stompClient.connected){if(checkConnectedIntervalId)clearInterval(checkConnectedIntervalId);if(sendConnectedStatusIntervalId)clearInterval(sendConnectedStatusIntervalId);
checkConnectedIntervalId=setInterval(function(){ALSocket.connectToSocket(isFetchMessages)},6E5);sendConnectedStatusIntervalId=setInterval(function(){ALSocket.sendStatus(1)},12E5)}else ALSocket.connectToSocket(isFetchMessages)};ALSocket.connectToSocket=function(isFetchMessages){if(typeof events.connectToSocket==="function")events.connectToSocket(isFetchMessages)};ALSocket.stopConnectedCheck=function(){if(checkConnectedIntervalId)clearInterval(checkConnectedIntervalId);if(sendConnectedStatusIntervalId)clearInterval(sendConnectedStatusIntervalId);
checkConnectedIntervalId="";sendConnectedStatusIntervalId="";ALSocket.disconnect()};ALSocket.disconnect=function(){if(ALSocket.stompClient&&ALSocket.stompClient.connected){ALSocket.sendStatus(0);ALSocket.stompClient.disconnect()}};ALSocket.unsubscibeToTypingChannel=function(){if(ALSocket.stompClient&&ALSocket.stompClient.connected)if(ALSocket.typingSubscriber){if(ALSocket.mck_typing_status===1)ALSocket.sendTypingStatus(0,TYPING_TAB_ID);ALSocket.typingSubscriber.unsubscribe()}ALSocket.typingSubscriber=
null};ALSocket.unsubscibeToNotification=function(){if(ALSocket.stompClient&&ALSocket.stompClient.connected)if(subscriber)subscriber.unsubscribe();subscriber=null};ALSocket.subscibeToTypingChannel=function(subscribeId){if(ALSocket.stompClient&&ALSocket.stompClient.connected)ALSocket.typingSubscriber=ALSocket.stompClient.subscribe("/topic/typing-"+MCK_APP_ID+"-"+subscribeId,ALSocket.onTypingStatus);else ALSocket.reconnect()};ALSocket.subscribeToOpenGroup=function(group){if(ALSocket.stompClient&&ALSocket.stompClient.connected){var subs=
ALSocket.stompClient.subscribe("/topic/group-"+MCK_APP_ID+"-"+group.contactId,ALSocket.onOpenGroupMessage);openGroupSubscriber.push(subs.id);OPEN_GROUP_SUBSCRIBER_MAP[group.contactId]=subs.id}else ALSocket.reconnect()};ALSocket.sendTypingStatus=function(status,mck_typing_status,MCK_USER_ID,tabId){ALSocket.mck_typing_status=mck_typing_status;if(ALSocket.stompClient&&ALSocket.stompClient.connected){if(status===1&&ALSocket.mck_typing_status===1)ALSocket.stompClient.send("/topic/typing-"+MCK_APP_ID+"-"+
TYPING_TAB_ID,{"content-type":"text/plain"},MCK_APP_ID+","+MCK_USER_ID+","+status);if(tabId){if(tabId===TYPING_TAB_ID&&status===ALSocket.mck_typing_status&&status===1)return;TYPING_TAB_ID=tabId;ALSocket.stompClient.send("/topic/typing-"+MCK_APP_ID+"-"+tabId,{"content-type":"text/plain"},MCK_APP_ID+","+MCK_USER_ID+","+status);setTimeout(function(){ALSocket.mck_typing_status=0},6E4)}else if(status===0)ALSocket.stompClient.send("/topic/typing-"+MCK_APP_ID+"-"+TYPING_TAB_ID,{"content-type":"text/plain"},
MCK_APP_ID+","+MCK_USER_ID+","+status);ALSocket.mck_typing_status=status}};ALSocket.onTypingStatus=function(resp){if(typeof events.onTypingStatus==="function")events.onTypingStatus(resp)};ALSocket.reconnect=function(){ALSocket.unsubscibeToTypingChannel();ALSocket.unsubscibeToNotification();ALSocket.disconnect();var data={};data.token=MCK_TOKEN;data.deviceKey=USER_DEVICE_KEY;data.websocketUrl=MCK_WEBSOCKET_URL;ALSocket.init(MCK_APP_ID,data,events)};ALSocket.onError=function(err){console.log("Error in channel notification. "+
err);if(typeof events.onConnectFailed==="function")events.onConnectFailed()};ALSocket.sendStatus=function(status){if(ALSocket.stompClient&&ALSocket.stompClient.connected)ALSocket.stompClient.send("/topic/status-v2",{"content-type":"text/plain"},MCK_TOKEN+","+USER_DEVICE_KEY+","+status)};ALSocket.onConnect=function(){if(ALSocket.stompClient.connected){if(subscriber)ALSocket.unsubscibeToNotification();subscriber=ALSocket.stompClient.subscribe("/topic/"+MCK_TOKEN,ALSocket.onMessage);ALSocket.sendStatus(1);
ALSocket.checkConnected(true)}else setTimeout(function(){subscriber=ALSocket.stompClient.subscribe("/topic/"+MCK_TOKEN,ALSocket.onMessage);ALSocket.sendStatus(1);ALSocket.checkConnected(true)},5E3);if(typeof events.onConnect==="function")events.onConnect()};ALSocket.onOpenGroupMessage=function(obj){if(typeof events.onOpenGroupMessage==="function")events.onOpenGroupMessage(obj)};ALSocket.onMessage=function(obj){if(subscriber!=null&&subscriber.id===obj.headers.subscription){var resp=JSON.parse(obj.body);
var messageType=resp.type;if(typeof events.onMessage==="function")events.onMessage(resp);if(messageType==="APPLOZIC_04"||messageType==="MESSAGE_DELIVERED")events.onMessageDelivered(resp);else if(messageType==="APPLOZIC_08"||messageType==="MT_MESSAGE_DELIVERED_READ")events.onMessageRead(resp);else if(messageType==="APPLOZIC_05")events.onMessageDeleted(resp);else if(messageType==="APPLOZIC_27")events.onConversationDeleted(resp);else if(messageType==="APPLOZIC_11")events.onUserConnect(resp.message);
else if(messageType==="APPLOZIC_12"){var lastSeenAtTime=resp.message.split(",")[1];events.onUserDisconnect({"userId":userId,"lastSeenAtTime":lastSeenAtTime})}else if(messageType==="APPLOZIC_29")events.onConversationReadFromOtherSource(resp);else if(messageType==="APPLOZIC_28")events.onConversationRead(resp);else if(messageType==="APPLOZIC_16"){var status=resp.message.split(":")[0];var userId=resp.message.split(":")[1];events.onUserBlocked({"status":status,"userId":userId})}else if(messageType==="APPLOZIC_17"){var status=
resp.message.split(":")[0];var userId=resp.message.split(":")[1];events.onUserUnblocked({"status":status,"userId":userId})}else if(messageType==="APPLOZIC_18")events.onUserActivated();else if(messageType==="APPLOZIC_19")events.onUserDeactivated();else{var message=resp.message;if(messageType==="APPLOZIC_03")events.onMessageSentUpdate({"messageKey":message.key});else if(messageType==="APPLOZIC_01"||messageType==="APPLOZIC_02"||messageType==="MESSAGE_RECEIVED")events.onMessageReceived({"message":messageFeed});
else if(messageType==="APPLOZIC_02"){var messageFeed=mckMessageLayout.getMessageFeed(message);events.onMessageSent({"message":messageFeed})}}}};return ALSocket}if(typeof ALSocket==="undefined")window.Applozic.ALSocket=define_ALSocket();else console.log("ALSocket already defined.")})(window);var mckNotificationUtils=new MckNotificationUtils;var alNotificationService=new AlNotificationService;
function AlNotificationService(){var _this=this;var IS_SW_NOTIFICATION_ENABLED;var MCK_GETUSERIMAGE;var MCK_NOTIFICATION_ICON_LINK;var IS_MCK_NOTIFICATION;var MCK_SW_SUBSCRIPTION;var MCK_SW_REGISTER_URL="/rest/ws/plugin/update/sw/id";var IS_MCK_TAB_FOCUSED=true;_this.init=function(optns){IS_SW_NOTIFICATION_ENABLED=typeof optns.swNotification==="boolean"?optns.swNotification:false;MCK_GETUSERIMAGE=optns.contactDisplayImage;MCK_NOTIFICATION_ICON_LINK=optns.notificationIconLink;IS_MCK_NOTIFICATION=typeof optns.desktopNotification===
"boolean"?optns.desktopNotification:false};_this.unsubscribeToServiceWorker=function(){if(MCK_SW_SUBSCRIPTION)navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){MCK_SW_SUBSCRIPTION.unsubscribe().then(function(successful){MCK_SW_SUBSCRIPTION=null;console.log("Unsubscribed to notification successfully")})})};_this.sendSubscriptionIdToServer=function(){if(MCK_SW_SUBSCRIPTION){var subscriptionId=MCK_SW_SUBSCRIPTION.endpoint.split("/").slice(-1)[0];if(subscriptionId)window.Applozic.ALApiService.sendSubscriptionIdToServer({data:{"subscriptionId":subscriptionId},
success:function(result){},error:function(){}})}};_this.subscribeToServiceWorker=function(){if(IS_SW_NOTIFICATION_ENABLED)if("serviceWorker"in navigator){navigator.serviceWorker.register("./service-worker.js",{scope:"./"});navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true}).then(function(pushSubscription){console.log("The reg ID is:: ",pushSubscription.endpoint.split("/").slice(-1));MCK_SW_SUBSCRIPTION=pushSubscription;
_this.sendSubscriptionIdToServer()})})}}}
function MckNotificationUtils(){var _this=this;var PERMISSION_DEFAULT="default",PERMISSION_GRANTED="granted",PERMISSION_DENIED="denied",PERMISSION=[PERMISSION_GRANTED,PERMISSION_DEFAULT,PERMISSION_DENIED],isSupported=function(){var isSupported=false;try{isSupported=!!(w.Notification||w.webkitNotifications||navigator.mozNotification||w.external&&w.external.msIsSiteMode()!==undefined)}catch(e){}return isSupported}(),isFunction=function(value){return value&&value.constructor===Function},isString=function(value){return value&&
value.constructor===String},isObject=function(value){return value&&value.constructor===Object},ieVerification=Math.floor(Math.random()*10+1),noop=function(){};_this.permissionLevel=function(){var permission;if(!isSupported)return;if(w.Notification&&w.Notification.permissionLevel)permission=w.Notification.permissionLevel();else if(w.webkitNotifications&&w.webkitNotifications.checkPermission)permission=PERMISSION[w.webkitNotifications.checkPermission()];else if(w.Notification&&w.Notification.permission)permission=
w.Notification.permission;else if(navigator.mozNotification)permission=PERMISSION_GRANTED;else if(w.external&&w.external.msIsSiteMode()!==undefined)permission=w.external.msIsSiteMode()?PERMISSION_GRANTED:PERMISSION_DEFAULT;return permission};_this.requestPermission=function(callback){var callbackFunction=isFunction(callback)?callback:noop;if(w.webkitNotifications&&w.webkitNotifications.checkPermission)w.webkitNotifications.requestPermission(callbackFunction);else if(w.Notification&&w.Notification.requestPermission)w.Notification.requestPermission(callbackFunction)};
_this.isChrome=function(){return/chrom(e|ium)/.test(w.navigator.userAgent.toLowerCase())};_this.getNotification=function(displayName,iconLink,msg,notificationsound){if(notificationsound){notificationsound.play();setTimeout(function(){notificationsound.stop()},1E3)}var notification;if(w.Notification){var options={icon:iconLink,body:msg};notification=new w.Notification(displayName,options);notification.onclick=function(){w.focus();this.close()}}else if(w.webkitNotifications){notification=w.webkitNotifications.createNotification(iconLink,
displayName,msg);if(notificationsound)notification.show();if(_this.isChrome())notification.onclick=function(){w.focus();this.cancel()};notification.show();setTimeout(function(){notification.cancel()},3E4)}else if(navigator.mozNotification){notification=navigator.mozNotification.createNotification(displayName,msg,iconLink);notification.show()}else if(w.external&&w.external.msIsSiteMode()){w.external.msSiteModeClearIconOverlay();w.external.msSiteModeSetIconOverlay(iconLink,displayName);w.external.msSiteModeActivate();
notification={"ieVerification":ieVerification+1}}return notification};_this.sendDesktopNotification=function(displayName,iconLink,msg,notificationsound){if(_this.permissionLevel()!==PERMISSION_GRANTED)w.Notification.requestPermission();if(_this.permissionLevel()===PERMISSION_GRANTED){var notification;if(notificationsound)notification=_this.getNotification(displayName,iconLink,msg,notificationsound);else notification=_this.getNotification(displayName,iconLink,msg);var notificationWrapper=_this.getWrapper(notification);
if(notification&&!notification.ieVerification&&notification.addEventListener)notification.addEventListener("show",function(){var notification=notificationWrapper;w.setTimeout(function(){notification.close()},3E4)})}};_this.getWrapper=function(notification){return{close:function(){if(notification)if(notification.close)notification.close();else if(notification.cancel)notification.cancel();else if(w.external&&w.external.msIsSiteMode())if(notification.ieVerification===ieVerification)w.external.msSiteModeClearIconOverlay()}}}}
var mckGroupUtils=new MckGroupUtils;var mckGroupService=new MckGroupService;
function MckGroupUtils(){var _this=this;_this.getGroup=function(groupId){if(typeof MCK_GROUP_MAP[groupId]==="object")return MCK_GROUP_MAP[groupId];else return};_this.getGroupByClientGroupId=function(clientGroupId){if(typeof MCK_CLIENT_GROUP_MAP[clientGroupId]==="object")return MCK_CLIENT_GROUP_MAP[clientGroupId];else return};_this.addGroup=function(group){var name=group.name?group.name:group.id;var users=[];$applozic.each(group.groupUsers,function(i,user){if(user.userId)users[user.userId]=user});
var removedMembersId=typeof group.removedMembersId!=="undefined"?group.removedMembersId:[];var groupFeed={"contactId":group.id.toString(),"htmlId":mckContactUtils.formatContactId(""+group.id),"displayName":name,"value":group.id.toString(),"adminName":group.adminId?group.adminId:group.adminName,"type":group.type,"members":group.membersId?group.membersId:group.membersName,"imageUrl":group.imageUrl,"users":users,"userCount":group.userCount,"removedMembersId":removedMembersId,"clientGroupId":group.clientGroupId,
"isGroup":true,"deletedAtTime":group.deletedAtTime,"metadata":group.metadata};MCK_GROUP_MAP[group.id]=groupFeed;if(group.clientGroupId)MCK_CLIENT_GROUP_MAP[group.clientGroupId]=groupFeed;return groupFeed};_this.createGroup=function(groupId){var group={"contactId":groupId.toString(),"htmlId":mckContactUtils.formatContactId(""+groupId),"displayName":groupId.toString(),"value":groupId.toString(),"members":group.membersId?group.membersId:group.membersName,"type":2,"adminName":"","imageUrl":"","userCount":"",
"users":[],"removedMembersId":[],"clientGroupId":"","isGroup":true,"deletedAtTime":""};MCK_GROUP_MAP[groupId]=group;return group}}
function MckGroupService(){var _this=this;var IS_MCK_VISITOR;var MCK_USER_ID;var MCK_OPEN_GROUP_SETTINGS;var MCK_LAST_SEEN_AT_MAP=[];var MCK_BLOCKED_TO_MAP=[];var GROUP_LIST_URL="/rest/ws/group/list";var GROUP_FEED_URL="/rest/ws/group/info";var GROUP_LEAVE_URL="/rest/ws/group/left";var GROUP_UPDATE_INFO_URL="/rest/ws/group/update";var GROUP_ADD_MEMBER_URL="/rest/ws/group/add/member";var GROUP_REMOVE_MEMBER_URL="/rest/ws/group/remove/member";MCK_GROUP_ARRAY=new Array;_this.init=function(optns){IS_MCK_VISITOR=
optns.visitor;MCK_USER_ID=IS_MCK_VISITOR?"guest":$applozic.trim(optns.userId);MCK_OPEN_GROUP_SETTINGS=optns.openGroupSettings};_this.loadGroups=function(params){var response=new Object;window.Applozic.ALApiService.loadGroups({baseUrl:MCK_BASE_URL,success:function(data){if(data.status==="success"){response.status="success";response.data=data.response;if(params.apzCallback)params.apzCallback(response)}else response.status="error";if(params.callback)params.callback(response)},error:function(){console.log("Unable to load groups. Please reload page.");
response.status="error";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};_this.getGroupFeed=function(params){var group={};if(typeof params.callback==="function"||typeof params.apzCallback==="function")var response=new Object;else return;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{if(typeof params.callback==="function"){response.status="error";response.errorMessage="GroupId or Client GroupId Required";
params.callback(response)}return}if(params.conversationId)group.conversationId=params.conversationId;Applozic.ALApiService.getGroupInfo({data:{group},success:function(response){if(response.status==="success"){var groupFeed=response.response;if(groupFeed+""==="null"||typeof groupFeed!=="object"){response.status="error";response.errorMessage="GroupId not found"}else{var group=mckGroupUtils.addGroup(groupFeed);response.status="success";response.data=group}}else if(data.status==="error"){response.status=
"error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback){if(response.status==="success")response.data=groupFeed;params.apzCallback(response,params)}},error:function(){console.log("Unable to load group. Please reload page.");response.status="error";response.errorMessage="Please reload page.";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,params)}})};_this.leaveGroup=function(params){var group=
{};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{response.status="error";response.errorMessage="GroupId or Client GroupId Required";if(params.callback)params.callback(response);return}Applozic.ALApiService.groupLeave({data:{group},success:function(data){if(data.status==="success"){if(params.clientGroupId){var groupInfo=mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);if(typeof groupInfo===
"object")params.groupInfo=groupInfo.contactId}response.status="success";response.data={groupId:params.groupId}}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,{groupId:params.groupId})},error:function(){console.log("Unable to process your request. Please reload page.");response.status="error";response.errorMessage="";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};
_this.removeGroupMemberFromChat=function(params){var group={};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{response.status="error";response.errorMessage="GroupId or Client GroupId Required";if(typeof params.callback==="function")params.callback(response);return}group.userId=params.userId;Applozic.ALApiService.removeGroupMember({data:{group:group},success:function(response){if(response.status==="success"){if(params.clientGroupId){var group=
mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);if(typeof group==="object")params.groupId=group.contactId}response.status="success"}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,params)},error:function(){console.log("Unable to process your request. Please reload page.");response.status="error";response.errorMessage="";if(params.callback)params.callback(response);
if(params.apzCallback)params.apzCallback(response);params.apzCallback(response)}})};_this.addGroupMember=function(params){var group={};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{if(typeof params.callback==="function")params.callback(response);return}group.userId=params.userId;if(typeof params.role!=="undefined")group.role=params.role;Applozic.ALApiService.addGroupMember({data:{group:group},success:function(data){if(data.status===
"success"){if(params.clientGroupId){var group=mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);if(typeof group==="object")params.groupId=group.contactId}response.status="success";response.data=data.response}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,params)},error:function(){console.log("Unable to process your request. Please reload page.");response.status=
"error";response.errorMessage="";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};_this.updateGroupInfo=function(params){var group={};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{if(typeof params.callback==="function"){response.status="error";response.errorMessage="GroupId or Client GroupId Required";params.callback(response)}return}if(params.name)group.newName=
params.name;if(params.imageUrl)group.imageUrl=params.imageUrl;if(params.users&&params.users.length>0)group.users=params.users;Applozic.ALApiService.groupUpdate({data:{group},success:function(data,group){if(data.status==="success"){if(params.clientGroupId){var group=mckGroupLayout.getGroupByClientGroupId(params.clientGroupId);if(typeof group==="object")params.groupId=group.contactId}response.status="success";response.data=data.response}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);
if(params.apzCallback)params.apzCallback(response,{groupId:params.groupId,groupInfo:group})},error:function(){console.log("Unable to process your request. Please reload page.");response.status="error";response.errorMessage="Unable to process your request. Please reload page.";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};_this.sendGroupMessage=function(params){if(typeof params==="object"){params=$applozic.extend(true,{},message_default_options,
params);var message=params.message;if(!params.groupId&&!params.clientGroupId)return"groupId or clientGroupId required";if(typeof message==="undefined"||message==="")return"message field required";if(params.type>12)return"invalid message type";message=$applozic.trim(message);var messagePxy={"type":params.messageType,"contentType":params.type,"message":message};if(params.groupId)messagePxy.groupId=$applozic.trim(params.groupId);else if(params.clientGroupId){var group=mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);
if(typeof group==="undefined")return"group not found";messagePxy.clientGroupId=$applozic.trim(params.clientGroupId)}mckMessageService.sendMessage(messagePxy);return"success"}else return"Unsupported format. Please check format"};_this.getContactFromGroupOfTwo=function(group,callback){var user;for(var i=0;i<group.members.length;i++){user=""+group.members[i];if(MCK_USER_ID===user)continue;if(typeof callback==="function")callback(user)}};_this.addGroupFromMessage=function(message,update,callback){var groupId=
message.groupId;var group=mckGroupUtils.getGroup(""+groupId);if(typeof group==="undefined"){group=mckGroupUtils.createGroup(groupId);mckGroupService.loadGroups({apzCallback:mckGroupLayout.loadGroups})}if(typeof callback==="function")callback(group,message,update)};_this.isGroupDeleted=function(tabId,isGroup){if(isGroup){var deletedAtTime=mckGroupLayout.getDeletedAtTime(tabId);return typeof deletedAtTime!=="undefined"&&deletedAtTime>0}return false};_this.loadGroupsCallback=function(response){var groups=
response.data;MCK_GROUP_ARRAY.length=0;$applozic.each(groups,function(i,group){if(typeof group.id!=="undefined"){var group=mckGroupUtils.addGroup(group);MCK_GROUP_ARRAY.push(group)}})};_this.getGroupDisplayName=function(groupId){if(typeof MCK_GROUP_MAP[groupId]==="object"){var group=MCK_GROUP_MAP[groupId];var displayName=group["displayName"];if(group.type===7){var contact=_this.getContactFromGroupOfTwo(group);if(typeof contact!=="undefined")displayName=mckMessageLayout.getTabDisplayName(contact.contactId,
false)}if(group.type===3)if(displayName.indexOf(MCK_USER_ID)!==-1){displayName=displayName.replace(MCK_USER_ID,"").replace(":","");if(typeof MCK_GETUSERNAME==="function"){var name=MCK_GETUSERNAME(displayName);displayName=name?name:displayName}}if(!displayName&&group.type===5)displayName="Broadcast";if(!displayName)displayName=group.contactId;return displayName}else return groupId};_this.getGroupImage=function(imageSrc){return imageSrc?'\x3cimg src\x3d"'+imageSrc+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+
'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};_this.getGroupDefaultIcon=function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};_this.addMemberToGroup=function(group,userId){if(typeof group.members==="object"){if(group.members.indexOf(userId)===-1)group.members.push(userId);if(typeof group.removedMembersId==="object"&&group.removedMembersId.indexOf(userId)!==-1)group.removedMembersId.splice(group.removedMembersId.indexOf(userId),1);MCK_GROUP_MAP[group.contactId]=
group}return group};_this.removeMemberFromGroup=function(group,userId){if(typeof group.removedMembersId!=="object"||group.removedMembersId.length<1){group.removedMembersId=[];group.removedMembersId.push(userId)}else if(group.removedMembersId.indexOf(userId)===-1)group.removedMembersId.push(userId);MCK_GROUP_MAP[group.contactId]=group;return group};_this.authenticateGroupUser=function(group){var isGroupLeft=mckGroupService.isGroupLeft(group);var isGroupMemeber=false;if(!isGroupLeft&&group.members.length>
0)for(var i=0;i<group.members.length;i++)if(MCK_USER_ID===""+group.members[i]){isGroupMemeber=true;return true}return isGroupMemeber};_this.isAppendOpenGroupContextMenu=function(group){if(MCK_OPEN_GROUP_SETTINGS.deleteChatAccess===0)return false;var isGroupMember=mckGroupService.authenticateGroupUser(group);if(!isGroupMember)return false;if(group.adminName===MCK_USER_ID)return true;if(MCK_OPEN_GROUP_SETTINGS.deleteChatAccess===2)return true;return false};_this.isGroupLeft=function(group){var isGroupLeft=
false;if(group.removedMembersId&&group.removedMembersId.length>0)$applozic.each(group.removedMembersId,function(i,removedMemberId){if(removedMemberId===MCK_USER_ID)isGroupLeft=true});return isGroupLeft}}var alUserService=new AlUserService;
function AlUserService(){var _this=this;var MCK_USER_DETAIL_MAP=[];var MCK_BLOCKED_TO_MAP=[];var MCK_GROUP_MEMBER_SEARCH_ARRAY=new Array;var USER_BLOCK_URL="/rest/ws/user/block";var USER_DETAIL_URL="/rest/ws/user/v2/detail";var USER_STATUS_URL="/rest/ws/user/chat/status";_this.updateUserStatus=function(params,callback){if(typeof MCK_USER_DETAIL_MAP[params.userId]==="object"){var userDetail=MCK_USER_DETAIL_MAP[params.userId];if(params.status===0){userDetail.connected=false;userDetail.lastSeenAtTime=
params.lastSeenAtTime}else if(params.status===1)userDetail.connected=true}else{var userIdArray=new Array;userIdArray.push(params.userId);if(typeof callback==="function")callback(userIdArray)}};_this.getUserDetail=function(userId){if(typeof MCK_USER_DETAIL_MAP[userId]==="object")return MCK_USER_DETAIL_MAP[userId];else return};_this.checkUserConnectedStatus=function(callback){var userIdArray=new Array;var otherUserIdArray=new Array;$applozic(".mck-user-ol-status").each(function(){var tabId=$applozic(this).data("mck-id");
if(typeof tabId!=="undefined"&&tabId!==""){userIdArray.push(tabId);var htmlId=mckContactUtils.formatContactId(""+tabId);$applozic(this).addClass(htmlId);$applozic(this).next().addClass(htmlId)}});if(userIdArray.length>0){$applozic.each(userIdArray,function(i,userId){if(typeof MCK_USER_DETAIL_MAP[userId]==="undefined")otherUserIdArray.push(userId)});if(typeof callback==="function")callback(otherUserIdArray)}};_this.loadUserProfile=function(userId){if(typeof userId!=="undefined"){var userIdArray=[];
var memberId=""+userId.split(",")[0];userIdArray.push(memberId);_this.loadUserProfiles(userIdArray)}};_this.loadUserProfiles=function(userIds,callback){var userIdArray=[];if(typeof callback==="function")callback(userIds,userIdArray)};_this.getUserStatus=function(params,callback){var response=new Object;window.Applozic.ALApiService.getUserStatus({success:function(data){if(data.users.length>0){MCK_GROUP_MEMBER_SEARCH_ARRAY=[];if(typeof callback==="function")callback(data)}response.status="success";
response.data=data;if(params.callback)params.callback(response);return},error:function(){response.status="error";if(params.callback)params.callback(response)}})};_this.blockUser=function(userId,isBlock,callback){if(!userId||typeof isBlock==="undefined")return;var data="userId\x3d"+userId+"\x26block\x3d"+isBlock;mckUtils.ajax({url:MCK_BASE_URL+USER_BLOCK_URL,type:"get",data:data,success:function(data){if(typeof data==="object")if(data.status==="success"){MCK_BLOCKED_TO_MAP[userId]=isBlock;if(typeof callback===
"function")callback(userId)}},error:function(){}})}}var alFileService=new AlFileService;
function AlFileService(){var _this=this;var ONE_KB=1024;var ONE_MB=1048576;var UPLOAD_VIA=["CREATE","UPDATE"];var FILE_PREVIEW_URL="/rest/ws/aws/file/";var FILE_UPLOAD_URL="/rest/ws/aws/file/url";var FILE_AWS_UPLOAD_URL="/rest/ws/upload/file";var FILE_DELETE_URL="/rest/ws/aws/file/delete";var CLOUD_HOST_URL="www.googleapis.com";var MCK_STORAGE_URL;var MCK_FILE_URL;var MCK_MAP_STATIC_API_KEY;var MCK_CUSTOM_UPLOAD_SETTINGS;var MCK_APP_ID;var AUTH_CODE;var USER_DEVICE_KEY;var MCK_ACCESS_TOKEN;var MCK_APP_MODULE_NAME;
var MCK_GENERATE_CLOUD_FILE_URL;_this.init=function(optns){MCK_FILE_URL=optns.fileBaseUrl;AUTH_CODE=btoa(optns.userId+":"+optns.deviceKey);USER_DEVICE_KEY=optns.deviceKey};_this.get=function(optns){MCK_APP_ID=optns.appId;MCK_STORAGE_URL=optns.customUploadUrl;MCK_CUSTOM_UPLOAD_SETTINGS=optns.fileupload;MCK_MAP_STATIC_API_KEY=optns.mapStaticAPIkey;MCK_ACCESS_TOKEN=optns.accessToken;MCK_APP_MODULE_NAME=optns.appModuleName;MCK_GENERATE_CLOUD_FILE_URL=optns.genereateCloudFileUrl};_this.deleteFileMeta=
function(blobKey){window.Applozic.ALApiService.deleteFileMeta({data:{blobKey:blobKey,url:MCK_FILE_URL+FILE_DELETE_URL+"?key\x3d"+blobKey},success:function(response){console.log(response)},error:function(){}})};_this.getFilePreviewPath=function(fileMeta){return typeof fileMeta==="object"?'\x3ca href\x3d"'+MCK_FILE_URL+FILE_PREVIEW_URL+fileMeta.blobKey+'" target\x3d"_blank"\x3e'+fileMeta.name+"\x3c/a\x3e":""};_this.getFilePreviewSize=function(fileSize){if(fileSize)if(fileSize>ONE_MB)return"("+parseInt(fileSize/
ONE_MB)+" MB)";else if(fileSize>ONE_KB)return"("+parseInt(fileSize/ONE_KB)+" KB)";else return"("+parseInt(fileSize)+" B)";return""};_this.getFileurl=function(msg){if(typeof msg.fileMeta==="object")if(msg.fileMeta.hasOwnProperty("url"))if(msg.fileMeta.url.indexOf(CLOUD_HOST_URL)!==-1){var fileUrl;_this.generateCloudUrl(msg.fileMeta.blobKey,function(result){fileUrl=result});return fileUrl}else return""+msg.fileMeta.url;else if(msg.fileMeta.thumbnailUrl==="thumbnail_"+msg.fileMeta.name)return MCK_STORAGE_URL+
"/files/get/"+msg.fileMeta.blobKey;else return MCK_FILE_URL+FILE_PREVIEW_URL+msg.fileMeta.blobKey;return""};_this.generateCloudUrl=function(key,callback){var url=MCK_GENERATE_CLOUD_FILE_URL.replace("{key}",key);var headers=window.Applozic.ALApiService.getAttachmentHeaders();mckUtils.ajax({type:"get",async:false,headers:headers,url:url,success:function(result){if(typeof callback==="function")callback(result)},error:function(result){console.log("error while getting token"+result)}})};_this.getFilePath=
function(msg){if(msg.contentType===2)try{var geoLoc=$applozic.parseJSON(msg.message);if(geoLoc.lat&&geoLoc.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+geoLoc.lat+","+geoLoc.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+geoLoc.lat+","+geoLoc.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+geoLoc.lat+","+geoLoc.lon+"\x26key\x3d"+MCK_MAP_STATIC_API_KEY+'"/\x3e\x3c/a\x3e'}catch(ex){if(msg.message.indexOf(",")!==
-1)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+msg.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+msg.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+msg.message+"\x26key\x3d"+MCK_MAP_STATIC_API_KEY+'" /\x3e\x3c/a\x3e'}if(typeof msg.fileMeta==="object")if(msg.fileMeta.contentType.indexOf("image")!==-1)if(msg.fileMeta.contentType.indexOf("svg")!==-1)return'\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+
msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'"\x3e\x3cimg src\x3d"'+_this.getFileurl(msg)+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';else if(msg.contentType===5)return'\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+msg.fileMeta.contentType+'" data-url\x3d"'+msg.fileMeta.blobKey+'" data-name\x3d"'+msg.fileMeta.name+'"\x3e\x3cimg src\x3d"'+msg.fileMeta.blobKey+
'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';else if(msg.fileMeta.hasOwnProperty("url"))if(msg.fileMeta.url.indexOf(CLOUD_HOST_URL)!==-1){var thumbnailUrl;_this.generateCloudUrl(msg.fileMeta.thumbnailBlobKey,function(result){thumbnailUrl=result});return'\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+msg.fileMeta.contentType+'" data-url\x3d"" data-blobKey\x3d"'+msg.fileMeta.blobKey+'" data-name\x3d"'+msg.fileMeta.name+
'"\x3e\x3cimg src\x3d"'+thumbnailUrl+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e'}else return'\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'"\x3e\x3cimg src\x3d"'+msg.fileMeta.thumbnailUrl+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';else if(msg.fileMeta.thumbnailUrl==="thumbnail_"+msg.fileMeta.name)return'\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+
msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'"\x3e\x3cimg src\x3d"'+MCK_STORAGE_URL+"/files/thumbnail_"+msg.fileMeta.name+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';else return'\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'"\x3e\x3cimg src\x3d"'+msg.fileMeta.thumbnailUrl+
'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';else if(msg.fileMeta.contentType.indexOf("video")!==-1)if(msg.fileMeta.hasOwnProperty("url")&&msg.fileMeta.url.indexOf(CLOUD_HOST_URL)!==-1){var getUrl;_this.generateCloudUrl(msg.fileMeta.blobKey,function(result){getUrl=result});return'\x3ca href\x3d"#" target\x3d"_self"\x3e\x3cvideo controls class\x3d"mck-video-player" onplay\x3d"alFileService.updateAudVidUrl(this);" data-cloud-service\x3d"google_cloud" data-blobKey\x3d"'+msg.fileMeta.blobKey+'"\x3e'+
'\x3csource src\x3d"'+getUrl+'" type\x3d"video/mp4"\x3e'+'\x3csource src\x3d"'+getUrl+'" type\x3d"video/ogg"\x3e\x3c/video\x3e'}else return'\x3ca href\x3d "#" target\x3d"_self"\x3e\x3cvideo controls class\x3d"mck-video-player"\x3e'+'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"video/mp4"\x3e'+'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e';else if(msg.fileMeta.contentType.indexOf("audio")!==-1)if(msg.fileMeta.hasOwnProperty("url")&&msg.fileMeta.url.indexOf(CLOUD_HOST_URL)!==
-1){var getUrl;_this.generateCloudUrl(msg.fileMeta.blobKey,function(result){getUrl=result});return'\x3ca href\x3d"#" target\x3d"_self"\x3e\x3caudio controls class\x3d"mck-audio-player" onplay\x3d"alFileService.updateAudVidUrl(this);" data-cloud-service\x3d"google_cloud" data-blobKey\x3d"'+msg.fileMeta.blobKey+'"\x3e'+'\x3csource src\x3d"'+getUrl+'" type\x3d"audio/ogg"\x3e'+'\x3csource src\x3d"'+getUrl+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e'+'\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e'}else return'\x3ca href\x3d"#" target\x3d"_self"\x3e\x3caudio controls class\x3d"mck-audio-player"\x3e'+
'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"audio/ogg"\x3e'+'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e'+'\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e';else return'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e';return""};_this.updateAudVidUrl=function(element){var keygen=element.dataset.blobkey;var time=(new Date).getTime();var currentSrc=element.currentSrc;var expiry=_this.fetchQueryString("Expires",
currentSrc);if(time>=expiry*1E3){_this.generateCloudUrl(keygen,function(result){getUrl=result});element.src=getUrl}};this.fetchQueryString=function(regKey,href){regKey=regKey.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexValue=new RegExp("[\\?\x26]"+regKey+"\x3d([^\x26#]*)");var result=regexValue.exec(href);if(result==null)console.log("The parameter is null for the searchedquery");return result[1]};_this.getFileAttachment=function(msg){if(typeof msg.fileMeta==="object"){if(msg.fileMeta.contentType.indexOf("image")!==
-1||msg.fileMeta.contentType.indexOf("audio")!==-1||msg.fileMeta.contentType.indexOf("video")!==-1)if(msg.fileMeta.hasOwnProperty("url")&&msg.fileMeta.url.indexOf(CLOUD_HOST_URL)!==-1)return'\x3ca href\x3d"javascript:void(0);" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link" data-blobKey\x3d"'+msg.fileMeta.blobKey+'" data-cloud-service\x3d"google_cloud"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
msg.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+alFileService.getFilePreviewSize(msg.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";else return'\x3ca href\x3d"'+_this.getFileurl(msg)+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+msg.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+
alFileService.getFilePreviewSize(msg.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";else return'\x3ca href\x3d"'+_this.getFileurl(msg)+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+msg.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+alFileService.getFilePreviewSize(msg.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";
return""}};_this.getFileIcon=function(msg){if(msg.fileMetaKey&&typeof msg.fileMeta==="object")if(msg.fileMeta.contentType.indexOf("image")!==-1)return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e';else if(msg.fileMeta.contentType.indexOf("audio")!==-1)return'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e';else if(msg.fileMeta.contentType.indexOf("video")!==-1)return'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e';
else return'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e';else return""};_this.downloadfile=function(){var url=_this.getFileurl(msg);var link=document.createElement("a");link.download=thefilename;link.setAttribute("href",url);var uri="data:text/csv;charset\x3dutf-8;base64,"+someb64data;link.href=uri;document.body.appendChild(link);link.click();document.body.removeChild(link)}}var alMessageService=new AlMessageService;
function AlMessageService(){var _this=this;var IS_MCK_VISITOR;var MCK_USER_ID;var TOPIC_ID_URL="/rest/ws/conversation/topicId";var CONVERSATION_ID_URL="/rest/ws/conversation/id";var CONVERSATION_FETCH_URL="/rest/ws/conversation/get";var MESSAGE_ADD_INBOX_URL="/rest/ws/message/add/inbox";var CONVERSATION_CLOSE_UPDATE_URL="/rest/ws/conversation/close";var CONVERSATION_DELETE_URL="/rest/ws/message/delete/conversation";var CONVERSATION_READ_UPDATE_URL="/rest/ws/message/read/conversation";var offlineblk=
'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';var refreshIntervalId;_this.init=function(optns){var IS_MCK_VISITOR=optns.visitor;var MCK_USER_ID=IS_MCK_VISITOR?"guest":$applozic.trim(optns.userId)};_this.addMessageToTab=function(messagePxy,contact,callback){var message={"to":messagePxy.to,"groupId":messagePxy.groupId,"deviceKey":messagePxy.deviceKey,
"contentType":messagePxy.contentType,"message":messagePxy.message,"conversationId":messagePxy.conversationId,"topicId":messagePxy.topicId,"sendToDevice":true,"createdAtTime":(new Date).getTime(),"key":messagePxy.key,"storeOnDevice":true,"sent":false,"read":true,"metadata":messagePxy.metadata?messagePxy.metadata:""};message.type=messagePxy.type?messagePxy.type:5;if(messagePxy.fileMeta)message.fileMeta=messagePxy.fileMeta;if(typeof callback==="function")callback(message,contact)};_this.getMessages=
function(params){var data={};if(params.startTime)data.endTime=params.startTime;if(typeof params.userId!=="undefined"&&params.userId!==""){if(params.isGroup)data.groupId=params.userId;else data.userId=params.userId;data.pageSize=30;if((IS_MCK_TOPIC_HEADER||IS_MCK_TOPIC_BOX)&&params.conversationId){data.conversationId=params.conversationId;if(typeof MCK_TAB_CONVERSATION_MAP[params.userId]==="undefined")data.conversationReq=true}}else data.mainPageSize=100;window.Applozic.ALApiService.getMessages({data:data,
success:params.callback,error:params.callback})};_this.getMessageList=function(params,callback){var tabId=params.id;var data={};var resp={};if(params.startTime)data.endTime=params.startTime;if(typeof params.clientGroupId!=="undefined"&&params.clientGroupId!==""){if(params.pageSize)data.pageSize=params.pageSize;else data.pageSize=50;data.clientGroupId=params.clientGroupId;resp={"clientGroupId":params.clientGroupId}}else if(typeof tabId!=="undefined"&&tabId!==""){if(params.pageSize)data.pageSize=params.pageSize;
else data.pageSize=50;if(""+params.isGroup==="true")data.groupId=tabId;else data.userId=tabId;resp={"id":tabId}}else{if(params.mainPageSize)data.mainPageSize=params.pageSize;else data.mainPageSize=50;resp={"id":""}}if(params.topicId&&(tabId||params.clientGroupId)){if(params.conversationId)data.conversationId=params.conversationId;if(params.topicId)resp["topicId"]=params.topicId}window.Applozic.ALApiService.getMessages({data:data,success:function(response){var data=response.data;resp.status="success";
if(typeof data.message==="undefined"||data.message.length===0)resp.messages=[];else{var messages=data.message;var messageFeeds=new Array;$applozic.each(messages,function(i,message){if(typeof callback==="function")callback(message)});resp.messages=messageFeeds}if(data.groupFeeds.length>0)resp.id=data.groupFeeds[0].id;params.callback(resp)},error:function(error){resp.status="error";params.callback(resp)}})};_this.getReplyMessageByKey=function(msgkey){var replyMsg=ALStorage.getMessageByKey(msgkey);if(typeof replyMsg===
"undefined")window.Applozic.ALApiService.updateReplyMessage({data:{key:msgkey},async:false,success:function(data){ALStorage.updateMckMessageArray(data)}});return ALStorage.getMessageByKey(msgkey)};_this.sendDeliveryUpdate=function(message){window.Applozic.ALApiService.sendDeliveryUpdate({data:{key:message.pairedMessageKey},success:function(){},error:function(){}})};_this.sendReadUpdate=function(key){if(typeof key!=="undefined"&&key!=="")window.Applozic.ALApiService.sendReadUpdate({data:{key:key},
success:function(){},error:function(){}})};_this.fetchConversationByTopicId=function(data,callback){window.Applozic.ALApiService.fetchConversationByTopicId({data,success:function(data){if(typeof data==="object"&&data.status==="success"){var conversationList=data.response;if(conversationList.length>0)$applozic.each(conversationList,function(i,conversationPxy){MCK_CONVERSATION_MAP[conversationPxy.id]=conversationPxy;MCK_TOPIC_CONVERSATION_MAP[conversationPxy.topicId]=[conversationPxy.id];if(conversationPxy.topicDetail)try{MCK_TOPIC_DETAIL_MAP[conversationPxy.topicId]=
$applozic.parseJSON(conversationPxy.topicDetail)}catch(ex){w.console.log("Incorect Topic Detail!")}if(params.tabId&&typeof MCK_TAB_CONVERSATION_MAP[params.tabId]!=="undefined"){var tabConvArray=MCK_TAB_CONVERSATION_MAP[params.tabId];tabConvArray.push(conversationPxy);MCK_TAB_CONVERSATION_MAP[params.tabId]=tabConvArray}});if(params.isExtMessageList)if(conversationList.length>0){params.conversationId=conversationList[0].id;params.pageSize=50;if(typeof callback==="function")callback(params)}else if(typeof params.callback===
"function"){var resp={};if(params.tabId){resp.id=params.tabId;resp.isGroup=params.isGroup}else if(params.clientGroupId)resp.clientGroupId=params.clientGroupId;resp.topicId=params.topicId;resp.status="success";resp.messages=[];params.callback(resp)}}else if(params.isExtMessageList&&typeof params.callback==="function"){var resp={};if(params.tabId)resp.id=params.tabId;else if(params.clientGroupId)resp.clientGroupId=params.clientGroupId;resp.topicId=params.topicId;resp.status="error";resp.errorMessage=
"Unable to process request. Please try again.";params.callback(resp)}},error:function(){if(typeof params.callback==="function"){var resp={};if(params.tabId)resp.id=params.tabId;else if(params.clientGroupId)resp.clientGroupId=params.clientGroupId;resp.topicId=params.topicId;resp.status="error";resp.errorMessage="Unable to process request. Please try again.";params.callback(resp)}}})};_this.getTopicId=function(params,callback){if(params.conversationId){var data="id\x3d"+params.conversationId;window.Applozic.ALApiService.getTopicId({data:{"conversationId":params.conversationId},
success:function(result){if(typeof data==="object"&&data.status==="success"){var conversationPxy=data.response;if(typeof conversationPxy==="object"){MCK_TOPIC_CONVERSATION_MAP[conversationPxy.topicId]=[params.conversationId];MCK_CONVERSATION_MAP[params.conversationId]=conversationPxy;if(conversationPxy.topicDetail)try{MCK_TOPIC_DETAIL_MAP[conversationPxy.topicId]=$applozic.parseJSON(conversationPxy.topicDetail)}catch(ex){w.console.log("Incorect Topic Detail!")}if(typeof MCK_PRICE_DETAIL==="function"&&
params.priceText){MCK_PRICE_DETAIL({"custId":MCK_USER_ID,"suppId":params.suppId,"productId":conversationPxy.topicId,"price":params.priceText});_this.sendConversationCloseUpdate(params.conversationId)}if(params.messageType&&typeof params.message==="object"){var tabId=params.message.groupId?params.message.groupId:params.message.to;if(typeof MCK_TAB_CONVERSATION_MAP[tabId]!=="undefined"){var tabConvArray=MCK_TAB_CONVERSATION_MAP[tabId];tabConvArray.push(conversationPxy);MCK_TAB_CONVERSATION_MAP[tabId]=
tabConvArray}if(typeof params.populate!=="undefined"?params.populate:true)if(typeof callback==="function")callback(params)}if(typeof params.callback==="function")params.callback(conversationPxy)}}},error:function(){}})}};_this.sendConversationCloseUpdate=function(conversationId){if(conversationId){var data="id\x3d"+conversationId;window.Applozic.ALApiService.sendConversationCloseUpdate({conversationId:conversationId,success:function(result){},error:function(){}})}};_this.dispatchMessage=function(params){if(params.messagePxy===
"object"){var messagePxy=params.messagePxy;if(params.topicId){var topicDetail=MCK_TOPIC_DETAIL_MAP[params.topicId];if(typeof topicDetail==="object"&&topicDetail.title!=="undefined"){if(!messagePxy.message)messagePxy.message=$applozic.trim(topicDetail.title);if(params.conversationId)messagePxy.conversationId=params.conversationId;else if(params.topicId){var conversationPxy={"topicId":params.topicId};if(typeof topicDetail==="object")conversationPxy.topicDetail=w.JSON.stringify(topicDetail);messagePxy.conversationPxy=
conversationPxy}}if(!messagePxy.message&&topicDetail.link){var fileMeta={"blobKey":$applozic.trim(topicDetail.link),"contentType":"image/png"};messagePxy.fileMeta=fileMeta;messagePxy.contentType=5;FILE_META=[];FILE_META.push(fileMeta)}}if(params.isGroup)messagePxy.groupId=params.tabId;else messagePxy.to=params.tabId;mckMessageService.sendMessage(messagePxy)}};_this.sendVideoCallMessage=function(callId,msgType,contentType,audioOnly,toUser,callback){var message=msgType=="CALL_MISSED"?"Missed Call":
msgType=="CALL_REJECTED"?"Call Rejected":"";if(message==""||message==undefined)message="video message";var metadata={"MSG_TYPE":msgType,"CALL_ID":callId,"CALL_AUDIO_ONLY":audioOnly};var messagePxy={"to":toUser,"type":5,"contentType":contentType,"message":message,"metadata":metadata,"senderName":MCK_USER_ID};callback(messagePxy);return messagePxy};_this.sendVideoCallEndMessage=function(callId,msgType,contentType,audioOnly,callDuration,toUser,callback){var callDurationStr="";if(callDuration)callDurationStr=
mckDateUtils.convertMilisIntoTime(callDuration);var message=msgType=="CALL_MISSED"?"Missed Call":msgType=="CALL_REJECTED"?"Call Rejected":msgType=="CALL_END"?"Call End \n Duration: "+callDurationStr:"video message";if(message==""||message==undefined)message="video message";var metadata={"MSG_TYPE":msgType,"CALL_ID":callId,"CALL_AUDIO_ONLY":audioOnly,"CALL_DURATION":callDuration};var messagePxy={"to":toUser,"type":5,"contentType":contentType,"message":message,"metadata":metadata};callback(messagePxy);
return messagePxy}};
var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(b,r,s){function ub(c){var f=this,Ea,m;MCK_GROUP_MAP=[];var F=[],S,fb,vb=!0,Fa=[],ga=0;MCK_CLIENT_GROUP_MAP=[];var wa=!1,ia=[],xa=[],ya=90,M=[],T=[],U=[],V=[],wb=!0,J=0,xb=c.mode;MCK_LABELS=c.labels;MCK_BASE_URL=c.baseUrl;var Ub=c.customFileUrl,Vb=c.customUploadUrl,Q=c.appId,yb=[],zb=[0,1,2,3],Ab=[1,2,5,6,7,9,10],ja=[],Xa=!1,Ta=c.launcher,gb=c.visitor,Wb=c.userName,Bb=c.locShare,za=c.video,hb=c.fileBaseUrl,Aa=c.fileupload,I=c.onInit,Cb=c.onTopicDetails,Xb=c.chatLauncherHtml,ub=[0,1,2],Db=
c.onClose,Eb=c.displayText,aa=c.accessToken,Oa=c.readConversation,ca=c.maxGroupSize,Fb=c.onTabClicked,Yb=c.contactNumber,W=c.maxAttachmentSize,ib=c.appModuleName,Ba=c.getTopicDetail,Gb=c.contactDisplayName,Hb=c.validateMessage,Ja=c.finalPriceResponse,Pa=c.contactDisplayImage,Ib=c.priceWidget,ka=c.openGroupSettings,la=c.offlineMessageDetail,jb=c.authenticationTypeId,Jb=c.getConversationDetail,qc=c.notificationIconLink,Zb=c.mapStaticAPIkey,Kb=c.unreadCountOnchatLauncher,Ga=c.disableSelfChat?c.disableSelfChat:
!1,$b=c.notificationSoundLink?c.notificationSoundLink:"",D=gb?"guest":b.trim(c.userId),rc="undefined"===typeof c.source?1:c.source,Ka="boolean"===typeof c.topicBox?c.topicBox:!1,kb="boolean"===typeof c.olStatus?c.olStatus:!1,ac="boolean"===typeof c.messageBubbleAvator?c.messageBubbleAvator:!1,Ya="boolean"===typeof c.showOfflineMessage?c.showOfflineMessage:!1,bc="boolean"===typeof c.hideGroupSubtitle?c.hideGroupSubtitle:!1,cc="undefined"===typeof c.defaultMessageMetaData?{}:c.defaultMessageMetaData,
Lb="boolean"===typeof c.groupUserCount?c.groupUserCount:!1,dc="boolean"===typeof c.checkUserBusyWithStatus?c.checkUserBusyWithStatus:!1,ec="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1,Ca="boolean"===typeof c.topicHeader?c.topicHeader:!1,fc=c.supportId?'data-mck-id\x3d"'+c.supportId+'"':"",lb="boolean"===typeof c.loadOwnContacts?c.loadOwnContacts:!1,gc="boolean"===typeof c.desktopNotification?c.desktopNotification:!1,hc="boolean"===typeof c.notification?c.notification:!0,ic="boolean"===
typeof c.autoTypeSearchEnabled?c.autoTypeSearchEnabled:!0,mb="boolean"===typeof c.launchOnNewMessage?c.launchOnNewMessage:!1,Mb="boolean"===typeof c.launchOnUnreadMessage?c.launchOnUnreadMessage:!1,jc="number"===typeof c.userTypeId?c.userTypeId:!1,L=["DEFAULT","NEW","OPEN"],kc=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],X={},Qa=[],La=[],Ha={},ma=[],Da=[],Ia=[],ta=[],Va=new function(){var a=this,e=!1,c,l,f=b("#mck-file-menu"),Za=b("#mck-message-cell .mck-message-inner");b("#mck-tab-individual");
var v=ya;a.getLauncherHtml=function(){return Xb?'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher"\x3e'+Xb+"\x3c/a\x3e\x3c/div\x3e":'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3cdiv id \x3d"applozic-badge-count"\x3e\x3c/div\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===xb?fc:"")+'\x3e\x3cspan class\x3d"mck-icon-chat"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
a.initializeApp=function(d,u){e=u;var c={applicationId:d.appId,userId:D};null!==Wb&&(c.displayName=d.userName);null!==d.email&&(c.email=d.email);null!==Yb&&(c.contactNumber=d.contactNumber);d.imageLink&&(c.imageLink=d.imageLink);d.appModuleName&&(c.appModuleName=d.appModuleName);aa&&(c.password=d.accessToken);-1===ub.indexOf(jb)&&(jb=0);ec&&(c.resetUserStatus=!0);"number"==typeof jc&&(c.userTypeId=jc);c.enableEncryption=!0;c.appVersionCode=108;c.authenticationTypeId=jb;S=m="";a.validateAppSession(c)?
za&&da.InitilizeVideoClient(D,S):(c.applicationId=Q,window.Applozic.ALApiService.login({data:{alUser:c,baseUrl:MCK_BASE_URL},success:function(b){a.onLoginSuccess(b,c)},error:function(b){a.onLoginFailure()}}));b(s).on("click",".fancybox",function(d){d=b(this);var e=this;if(-1!==d.data("type").indexOf("video")){var c=d.find(".mck-video-box").html(),O;d.fancybox({content:c,title:d.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},
beforeShow:function(){O=b(".fancybox-inner").find("video").get(0);O.load();O.play()}})}else if(c=d.data("url"),""===c){var u;d=d.data("blobkey");E.generateCloudUrl(d,function(b){u=b;e.dataset.url=u;a.setImageViewParams(u,e)})}else a.setImageViewParams(c,this)})};b(s).on("click",".file-preview-link",function(a){a=b(this);var d=this,e=d.host;if("google_cloud"===a.data("cloudService")){var c,l;c=a.data("blobkey");E.generateCloudUrl(c,function(b){l=b;d.href=l})}"storage.googleapis.com"===e&&(c=a.data("blobkey"),
E.generateCloudUrl(c,function(b){l=b;d.href=l}))});a.setImageViewParams=function(a,d){b(d).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:a,type:"image"})};a.onLoginSuccess=function(b,d){za&&da.InitilizeVideoClient(b.userId,b.deviceKey);ALStorage.clearMckMessageArray();ALStorage.clearMckContactNameArray();"INVALID_PASSWORD"===b?"function"===typeof I&&I({status:"error",errorMessage:"INVALID PASSWORD"}):"INVALID_APPID"===b?"function"===typeof I&&I({status:"error",errorMessage:"INVALID APPLICATION ID"}):
"error"===b||"USER_NOT_FOUND"===b?"function"===typeof I&&I({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===b?"function"===typeof I&&I({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof b&&null!==b&&b.token?(b.appId=d.applicationId,aa&&(b.accessToken=d.password),a.onInitApp(b)):"function"===typeof I&&I({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})};a.onLoginFailure=function(){ALStorage.clearMckMessageArray();"function"===typeof I&&I({status:"error",
errorMessage:"UNABLE TO PROCESS REQUEST"})};a.onInitApp=function(c){a.appendLauncher();a.setLabels();b(".applozic-launcher").each(function(){b(this).hasClass("mck-msg-preview")||b(this).show()});Ea=c.token;N.setEncryptionKey(c.encryptionKey);D=c.userId;S=c.deviceKey;fb=c.websocketUrl;ya=c.websocketIdleTimeLimit;hb=c.fileBaseUrl;Xa=c.deactivated;m=btoa(c.userId+":"+c.deviceKey);window.Applozic.ALApiService.setAjaxHeaders(m,Q,S,aa,ib);J=c.totalUnreadCount;N.badgeCountOnLaucher(Kb,J);gb||"guest"===D||
"0"===D||"C0"===D||(e?Y.reconnect():Y.init());d.createContactWithDetail({userId:D,displayName:c.displayName,photoLink:c.imageLink});b.ajaxPrefilter(function(b){-1!==b.url.indexOf(MCK_BASE_URL)&&(b.beforeSend=function(b){a.setHeaders(b)})});if(c.betaPackage){var u="https://www.applozic.com/?utm_source\x3d"+r.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";b(".mck-running-on a").attr("href",u);b(".mck-running-on").removeClass("n-vis").addClass("vis")}MCK_BASE_URL&&(c.baseUrl=
MCK_BASE_URL);u=ALStorage.getMckContactNameArray();if(null!==u&&0<u.length)for(var l=0;l<u.length;l++){var f=u[l];null!==f&&(ma[f[0]]=f[1])}na.checkUserConnectedStatus(function(b){0<b.length?Z.getUsersDetail(b,{setStatus:!0}):qa.updateUserConnectedStatus()});"function"===typeof I&&I("success",c);Va.tabFocused();0<oa.length&&0<J&&oa.html(J);Mb&&G.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});E.init(c);Z.loadContacts();lc.subscribeToServiceWorker();ALStorage.setAppHeaders(c);mckGroupService.loadGroups({apzCallback:t.loadGroups})};
a.validateAppSession=function(b){var d=ALStorage.getAppHeaders();if(d&&d.userId){if(b.applicationId===d.appId&&b.userId===d.userId&&b.password===d.accessToken)return a.onInitApp(d),!0;ALStorage.clearAppHeaders()}return!1};a.setHeaders=function(b){b.setRequestHeader("UserId-Enabled",!0);m&&b.setRequestHeader("Authorization","Basic "+m);b.setRequestHeader("Application-Key",Q);S&&b.setRequestHeader("Device-Key",S);aa&&b.setRequestHeader("Access-Token",aa);ib&&b.setRequestHeader("App-Module-Name",ib)};
a.setLabels=function(){b("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);b("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]);b("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]);b("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);b("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",
MCK_LABELS["search.placeholder"]);b("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);b("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);b("#mck-no-messages").html(MCK_LABELS["empty.messages"]);b("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);b("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);b("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);b("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);b("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",
MCK_LABELS["create.group.title"]);b("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);b("#mck-msg-error").html(MCK_LABELS["group.deleted"]);b("#mck-gc-title-label").html(MCK_LABELS["group.title"]);b("#mck-gc-type-label").html(MCK_LABELS["group.type"]);b("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);b("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);b("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",
MCK_LABELS["members.title"]);b("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]);b("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);b("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);b("#mck-typing-label").html(MCK_LABELS.typing);b("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",
MCK_LABELS["clear.messages"]);b("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);b("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]);b("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);b("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);b("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);b(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);
b("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);b("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close);b("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send);b("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);b("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);b("#mck-group-name-save").attr("title",MCK_LABELS.save);b("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);b("#mck-group-name-edit").attr("title",
MCK_LABELS.edit)};b(r).on("resize",function(){"block"===f.css("display")&&Nb.fileMenuReposition();if(0===Za.find(".mck-contact-list").length){var b=Za.get(0).scrollHeight;Za.height()<b&&Za.animate({scrollTop:Za.prop("scrollHeight")},0)}});a.appendLauncher=function(){b("#mck-sidebox-launcher").remove();b("body").append(a.getLauncherHtml());nb.init()};a.tabFocused=function(){function b(c){var e={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};c=c||r.event;(wb=c.type in e?e[c.type]:
this[d]?!1:!0)?(1>v&&vb&&Y.checkConnected(!0),a.stopIdleTimeCounter()):(1===ga&&Y.sendTypingStatus(0),a.manageIdleTime())}var d="hidden";d in s?s.addEventListener("visibilitychange",b):("mozHidden"===d)in s?s.addEventListener("mozvisibilitychange",b):("webkitHidden"===d)in s?s.addEventListener("webkitvisibilitychange",b):("msHidden"===d)in s?s.addEventListener("msvisibilitychange",b):"onfocusin"in s?s.onfocusin=s.onfocusout=b:r.onpageshow=r.onpagehide=r.onfocus=r.onblur=b;void 0!==s[d]&&b({type:s[d]?
"blur":"focus"})};a.manageIdleTime=function(){v=ya;c&&clearInterval(c);c=setInterval(function(){0>--v&&(v=0,Y.stopConnectedCheck(),clearInterval(c),c="")},6E4)};a.stopIdleTimeCounter=function(){v=ya;c&&clearInterval(c);c=""};a.manageOfflineMessageTime=function(b){if("object"!==typeof la||isNaN(la.timeout))r.console.log("Offline message timeout required.");else{if(1===la.type){if(!la.userIds||0===la.userIds.length){r.console.log("Offline message userIds required.");return}if(-1===la.userIds.indexOf(b))return}l&&
clearInterval(l);l=setTimeout(function(){clearInterval(l);l="";d.showOfflineMessage()},5E3*parseInt(la.timeout))}};a.stopOfflineMessageCounter=function(){l&&clearInterval(l);l=""}},N=new MckUtils,Nb=new function(){var a=this,d="",c="",l=!1,f=b("#mck-my-loc"),m=b("#mck-loc-box"),v=b("#mck-loc-lat"),O=b("#mck-loc-lon"),u=b("#mck-btn-loc"),A=b("#mck-sidebox-ft"),x=b("#mck-file-menu"),s=b("#mck-btn-attach"),t=b("#mck-map-content"),D=b("#mck-loc-address");a.init=function(){Bb&&r.google&&"object"===typeof r.google.maps&&
(d=new r.google.maps.Geocoder,s.on("click",function(){a.fileMenuToggle()}),u.on("click",function(){l?m.mckModal():(mckMapUtils.getCurrentLocation(a.onGetCurrLocation,a.onErrorCurrLocation),l=!0)}));f.on("click",function(){mckMapUtils.getCurrentLocation(a.onGetMyCurrLocation,a.onErrorMyCurrLocation)})};a.fileMenuReposition=function(){var b=A.offset();b.bottom=r.innerHeight-b.top;x.css({bottom:51<b.bottom?b.bottom:51,right:0})};a.fileMenuToggle=function(){s.hasClass("on")?(s.removeClass("on"),x.hide()):
(a.fileMenuReposition(),s.addClass("on"),x.show())};a.onGetCurrLocation=function(b){MCK_CURR_LATITIUDE=b.coords.latitude;MCK_CURR_LONGITUDE=b.coords.longitude;a.openMapBox()};a.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;a.openMapBox()};a.onErrorMyCurrLocation=function(b){alert("Unable to retrieve your location. ERROR("+b.code+"): "+b.message)};a.onGetMyCurrLocation=function(b){MCK_CURR_LATITIUDE=b.coords.latitude;MCK_CURR_LONGITUDE=b.coords.longitude;
v.val(MCK_CURR_LATITIUDE);O.val(MCK_CURR_LONGITUDE);v.trigger("change");O.trigger("change");c?D.val(c):d&&d.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(b,a){"OK"===a&&b[1]&&(c=b[1].formatted_address)})};a.openMapBox=function(){t.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:v,longitudeInput:O,locationNameInput:D},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(b){MCK_CURR_LATITIUDE=
b.latitude;MCK_CURR_LONGITUDE=b.longitude}});m.on("shown.bs.mck-box",function(){t.locationpicker("autosize")});m.mckModal()}},qa=new function(){var a=b("#mck-msg-form"),d=b("#mck-msg-error"),c=b("#mck-tab-title"),l=b("#mck-tab-status"),f=b(".mck-typing-box"),m=b("#mck-block-button"),v=b("#mck-message-cell .mck-message-inner");this.updateUserConnectedStatus=function(){b(".mck-user-ol-status").each(function(){var a=b(this),d=a.data("mck-id");if(d){var c=M[d];"undefined"!==typeof M[d]&&c.connected?(a.removeClass("n-vis").addClass("vis"),
a.next().html("("+MCK_LABELS.online+")")):(a.removeClass("vis").addClass("n-vis"),a.next().html("(Offline)"))}})};this.lastSeenOfGroupOfTwo=function(b){r.MCK_OL_MAP[b]?(l.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),l.removeClass("n-vis").addClass("vis")):U[b]&&(b=mckDateUtils.getLastSeenAtStatus(U[b]),l.html(b),l.attr("title",b),c.addClass("mck-tab-title-w-status"),l.removeClass("n-vis").addClass("vis"))};this.toggleBlockUser=function(b,u){if(u)d.html(MCK_LABELS.blocked),d.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),
a.removeClass("vis").addClass("n-vis"),c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis"),f.removeClass("vis").addClass("n-vis"),v.data("blocked",!0),m.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"]);else if(d.html(""),d.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),a.removeClass("n-vis").addClass("vis"),v.data("blocked",!1),m.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),!xa[b]&&(r.MCK_OL_MAP[b]||U[b])){if(r.MCK_OL_MAP[b])l.attr("title",
MCK_LABELS.online).html(MCK_LABELS.online);else if(U[b]){var A=mckDateUtils.getLastSeenAtStatus(U[b]);l.html(A);l.attr("title",A)}c.addClass("mck-tab-title-w-status");l.removeClass("n-vis").addClass("vis")}}};new function(){var a=b("#mck-msg-to");b("#mck-btn-loc");var d=b("#mck-loc-box"),c=b("#mck-msg-sbmt"),l=b("#mck-msg-error"),f=b("#mck-loc-submit"),m=b("#mck-msg-response"),v=b("#mck_response_text"),s=b("#mck-message-cell .mck-message-inner");f.on("click",function(){var b={type:5,contentType:2,
message:r.JSON.stringify(mckMapUtils.getSelectedLocation())},f=s.data("mck-conversationid"),q=s.data("mck-topicid");f?b.conversationId=f:q&&(f={topicId:q},q=T[q],"object"===typeof q&&(f.topicDetail=r.JSON.stringify(q)),b.conversationPxy=f);!0===s.data("isgroup")?b.groupId=a.val():b.to=a.val();c.attr("disabled",!0);l.removeClass("vis").addClass("n-vis");l.html("");v.html("");m.removeClass("vis").addClass("n-vis");G.sendMessage(b);d.mckModal("hide")})};var t=new function(){var a=this,c={0:MCK_LABELS.user,
1:MCK_LABELS.admin,2:MCK_LABELS.moderator,3:MCK_LABELS.member},f=document.getElementById("mck-group-create-type");f.options[f.options.length]=new Option(MCK_LABELS["public"],"1");f.options[f.options.length]=new Option(MCK_LABELS["private"],"2");f.options[f.options.length]=new Option(MCK_LABELS.open,"6");var l=b("#mck-msg-form"),q=b("#mck-msg-error"),m=b("#mck-tab-title"),v=b("#mck-tab-status"),O=b("#mck-no-gsm-text"),u=b("#mck-gms-loading"),A=b("#mck-contact-loading");b("#mck-tab-menu-box");b("#mck-search-loading");
var x=b("#mck-group-info-tab"),R=b("#mck-sidebox-search");b("#mck-group-name-box");var Ua=b("#mck-group-back-link"),E=b("#mck-group-name-edit"),y=b("#mck-group-name-save"),F=b("#mck-sidebox-content"),H=b("#mck-tab-option-panel"),h=b("#mck-btn-group-create"),K=b("#mck-group-create-tab"),C=b("#mck-contacts-content"),n=b("#mck-btn-group-update"),ra=b("#mck-group-create-type"),$a=b("#mck-group-icon-upload"),ob=b("#mck-group-icon-change"),Ob=b("#mck-group-member-list"),J=b("#mck-group-update-panel"),M=
b(".mck-tab-message-option"),Pb=b("#mck-group-create-title"),ab=b(".mck-group-menu-options"),bb=b("#mck-group-member-search"),ha=b("#mck-btn-group-icon-save");b("#mck-group-info-icon-box");var sc=b(".mck-group-admin-options"),pb=b("#mck-group-add-member-box"),P=b("#mck-message-cell .mck-message-inner"),pa=b("#mck-group-name-sec .mck-group-title");b("#mck-group-create-icon-box");var qb=b("#mck-group-info-icon-loading"),Q=b("#mck-gm-search-box");b("#mck-group-member-search-list");var I=b("#mck-group-create-icon-loading"),
L=b("#mck-group-info-icon-box .mck-group-icon"),ba=b("#mck-group-create-icon-box .mck-group-icon"),X=b("#mck-group-create-icon-box .mck-overlay-box"),aa=b("#mck-gc-overlay-label");b.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
b.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b(".mck-group-name-box div[contenteditable]").keypress(function(d){if(8===d.which||37===d.keyCode||38===d.keyCode||39===d.keyCode||40===d.keyCode||d.ctrlKey&&97===d.which)return!0;if(13!==d.keyCode||d.shiftKey||d.ctrlKey)return 30>this.innerHTML.length;b(d.target).hasClass("mck-group-create-title")&&a.submitCreateGroup();return!1}).on("paste",function(b){var a=this;setTimeout(function(){30<a.innerText.length&&(a.innerHTML=a.innerText.substring(0,30),N.setEndOfContenteditable(a));return!1},"fast")}).on("drop",
function(b){b.preventDefault();b.stopPropagation()});b(s).on("click",".mck-btn-change-role",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var d=b(this).parents(".mck-li-group-member").data("role");a.find("select").val(d);a.removeClass("n-vis").addClass("vis");J.removeClass("n-vis").addClass("vis")});n.on("click",function(){var a=[];b(".mck-group-change-role-box.vis").each(function(d,c){var e=b(this),n=parseInt(e.find("select").val()),h=
e.parents(".mck-li-group-member").data("role");n!==h&&(e={userId:e.parents(".mck-li-group-member").data("mck-id"),role:n},a.push(e))});if(0<a.length){var d=P.data("mck-id"),c=P.data("isgroup");d&&c&&(n.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),mckGroupService.updateGroupInfo({groupId:d,users:a,apzCallback:t.onUpdateGroupInfo}))}});b("#mck-group-info-icon-box .mck-overlay").on("click",function(b){ob.trigger("click")});b("#mck-group-create-icon-box .mck-overlay").on("click",function(b){$a.trigger("click")});
b(s).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var a=b(this);0===a.find(".mck-group-icon-default").length&&a.find(".mck-overlay-box").addClass("n-vis")});b(s).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").addClass("n-vis")});
E.on("click",function(){pa.attr("contenteditable",!0).focus();N.setEndOfContenteditable(pa[0]);y.removeClass("n-vis").addClass("vis");E.removeClass("vis").addClass("n-vis")});y.on("click",function(){var a=b.trim(b("#mck-group-title").text());if(0<a.length){var d=P.data("mck-id"),c=P.data("isgroup");d&&c&&(E.removeClass("n-vis").addClass("vis"),y.removeClass("vis").addClass("n-vis"),pa.attr("contenteditable",!1),mckGroupService.updateGroupInfo({groupId:d,name:a,apzCallback:t.onUpdateGroupInfo}))}else pa.addClass("mck-req-border")});
ha.on("click",function(){var b=L.data("iconurl");if(b){var a=P.data("mck-id"),d=P.data("isgroup");a&&d&&(setTimeout(function(){ha.removeClass("vis").addClass("n-vis")},1E3),L.data("iconurl",""),mckGroupService.updateGroupInfo({groupId:a,imageUrl:b,apzCallback:t.onUpdateGroupInfo}))}else pa.addClass("mck-req-border")});h.on("click",function(){a.submitCreateGroup()});a.submitCreateGroup=function(){var a=b.trim(Pb.text()),d=ra.val(),c=ba.data("iconurl");0<a.length?(a={groupName:a},d&&(d=parseInt(d),
-1!==Ab.indexOf(d)&&(a.type=d)),c&&(a.groupIcon=c),ba.data("iconurl",""),a.isInternal=!0,h.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),G.getGroup(a)):Pb.addClass("mck-req-border")};a.loadGroups=function(a){a=a.data;Qa.length=0;b.each(a,function(b,a){"undefined"!==typeof a.id&&(a=mckGroupUtils.addGroup(a),Qa.push(a))})};a.getDeletedAtTime=function(b){if("object"===typeof MCK_GROUP_MAP[b])return MCK_GROUP_MAP[b].deletedAtTime};a.validateOpenGroupUser=function(b){if(6===b.type){if(!mckGroupService.authenticateGroupUser(b)){if(ka.disableChatForNonGroupMember){var a=
ka.defaultChatDisabledMessage;a||(a="Chat disabled");q.html(a);q.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");m.removeClass("mck-tab-title-w-status");v.removeClass("vis").addClass("n-vis")}ab.removeClass("vis").addClass("n-vis");M.removeClass("vis").addClass("n-vis");H.removeClass("vis").addClass("n-vis");"undefined"===typeof yb[b.contactId]&&Y.subscribeToOpenGroup(b)}b.adminName===D?0===ka.deleteChatAccess&&M.removeClass("vis").addClass("n-vis"):
(ka.allowInfoAccessGroupMembers||ab.removeClass("vis").addClass("n-vis"),2!==ka.deleteChatAccess&&M.removeClass("vis").addClass("n-vis"),ka.allowInfoAccessGroupMembers||2===ka.deleteChatAccess||H.removeClass("vis").addClass("n-vis"));return!1}return!0};a.addGroupStatus=function(b){var c=a.isGroupLeft(b);if(6!==b.type&&(c||bc)){if(c)t.onGroupLeft("",{groupId:b.contactId});m.removeClass("mck-tab-title-w-status");v.removeClass("vis").addClass("n-vis")}else if(0<b.members.length){for(var c="",e=!1,n=
30>=b.members.length?b.members.length:25,p=0;p<n;p++)if(D===""+b.members[p]||-1!==b.removedMembersId.indexOf(b.members[p]))e=!0;else var h=d.fetchContact(""+b.members[p]),h=d.getTabDisplayName(h.contactId,!1),c=c+(" "+h+",");if(5!==b.type&&6!==b.type||e&&5!==b.type)c+=" You";30<b.members.length&&(c+=" and "+(b.members.length-25)+" more");c=c.replace(/,\s*$/,"");v.html(c);v.attr("title",c);v.removeClass("n-vis").addClass("vis");m.addClass("mck-tab-title-w-status");ab.removeClass("n-vis").addClass("vis")}else m.removeClass("mck-tab-title-w-status"),
v.removeClass("vis").addClass("n-vis");7===b.type&&(v.html(""),ab.removeClass("vis").addClass("n-vis"))};a.disableGroupTab=function(){q.html(MCK_LABELS["group.chat.disabled"]);q.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");m.removeClass("mck-tab-title-w-status");v.removeClass("vis").addClass("n-vis")};a.isGroupLeft=function(a){var d=!1;a.removedMembersId&&0<a.removedMembersId.length&&b.each(a.removedMembersId,function(b,a){a===D&&(d=!0)});return d};
a.onGroupLeft=function(b,d){A.removeClass("vis").addClass("n-vis");if("object"===typeof b&&"error"===b.status)alert("Unable to process your request. "+b.errorMessage);else{var c=d.groupId;if(x.hasClass("vis")){var e=x.data("mck-id");c===e&&Ua.trigger("click")}else if(F.hasClass("vis")){var e=P.data("mck-id"),n=P.data("isgroup");e===c.toString()&&n&&(ab.removeClass("vis").addClass("n-vis"),a.disableGroupTab())}}};a.onAddedGroupMember=function(c,e){A.removeClass("vis").addClass("n-vis");if("object"===
typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{var n=e.groupId,h=e.userId,p="";n?p=mckGroupUtils.getGroup(n):e.clientGroupId&&(p=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId));if("object"===typeof p)if(p=mckGroupService.addMemberToGroup(p,h),x.hasClass("vis")){var f=x.data("mck-id");n===f&&(n=d.fetchContact(""+h),0===b("#li-gm-"+n.htmlId).length&&a.addGroupMember(p,n),a.sortGroupMemberHtmlList(),a.enableGroupAdminMenuToggle())}else F.hasClass("vis")&&
(h=P.data("mck-id"),f=P.data("isgroup"),h===n.toString()&&f&&a.addGroupStatus(p));else mckGroupService.getGroupFeed({groupId:n,clientGroupId:e.clientGroupId,apzCallback:t.onGroupFeed})}};a.onRemovedGroupMember=function(c,e){A.removeClass("vis").addClass("n-vis");if("object"===typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{var n=e.groupId,h=e.userId,p="";n?p=mckGroupUtils.getGroup(n):e.clientGroupId&&(p=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId));
if("object"===typeof p)if(p=mckGroupService.removeMemberFromGroup(p,h),x.hasClass("vis"))p=x.data("mck-id"),n===p&&(n=d.fetchContact(""+h),n=b("#li-gm-"+n.htmlId),0<n.length&&n.remove());else{if(F.hasClass("vis")){var h=P.data("mck-id"),f=P.data("isgroup");h===n.toString()&&f&&a.addGroupStatus(p)}}else mckGroupService.getGroupFeed({groupId:n,clientGroupId:e.clientGroupId,apzCallback:t.onGroupFeed})}};a.onGroupFeed=function(c,e){A.removeClass("vis").addClass("n-vis");if("success"===c.status){var n=
c.data,h=n.conversationPxy,p=mckGroupUtils.getGroup(n.id);n.deletedAtTime&&(q.html(MCK_LABELS["group.deleted"]),q.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),l.removeClass("vis").addClass("n-vis"));var f=[];"object"===typeof h&&(V[h.id]=h,ja[h.topicId]=[h.id],h.topicDetail&&(T[h.topicId]=b.parseJSON(h.topicDetail)),f.push(h));0<f.length&&(ta[e.groupId]=f);na.loadUserProfiles(n.membersId,function(a,c){b.each(a,function(b,a){"undefined"===typeof d.getContact(a)&&c.push(a)});Z.getUsersDetail(c,
{async:!1})});e.isMessage&&"object"===typeof e.message&&d.populateMessage(e.messageType,e.message,e.notifyUser);e.isReloadTab&&a.reloadGroupTab(p)}};a.onUpdateGroupInfo=function(d,c){A.removeClass("vis").addClass("n-vis");n.attr("disabled",!1).html("Update");J.removeClass("vis").addClass("n-vis");if("object"===typeof d&&"error"===d.status)alert("Unable to process your request. "+d.errorMessage);else{var e=c.groupId,h=c.groupInfo,p=mckGroupUtils.getGroup(e);if("object"===typeof p){h.imageUrl&&(p.imageUrl=
h.imageUrl);h.newName&&(p.displayName=h.newName);h.metadata&&(p.metadata=h.metadata);h.users&&0<h.users.length&&b.each(h.users,function(b,a){a.userId&&(p.users[a.userId]=a)});if(x.hasClass("vis"))h.imageUrl&&L.html(mckGroupService.getGroupImage(p.imageUrl)),pa.html(p.displayName),h.users&&0<h.users.length&&(Ob.html(""),a.addMembersToGroupInfoList(p),p.adminName===D?pb.removeClass("n-vis").addClass("vis"):pb.removeClass("vis").addClass("n-vis"));else if(F.hasClass("vis")){var f=P.data("mck-id"),l=
P.data("isgroup");f===e.toString()&&l?m.html(p.displayName):0<b("#li-group-"+p.htmlId).length&&(b("#li-group-"+p.htmlId+" .mck-cont-name strong").html(p.displayName),h.imageUrl&&b("#li-group-"+p.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+p.imageUrl+"'\x3e"))}MCK_GROUP_MAP[p.contactId]=p}}};a.getGroupFeedFromMessage=function(b){var a=b.message;if(a){b.groupId=a.groupId;b.isMessage=!0;if(a.conversationId){var d=V[a.conversationId];if("object"!==typeof d||"object"!==typeof T[d.topicId])b.conversationId=
a.conversationId}b.apzCallback=t.onGroupFeed;mckGroupService.getGroupFeed(b)}};a.reloadGroupTab=function(b){var d=P.data("mck-id"),c=P.data("isgroup");d===b.contactId.toString()&&c&&a.addGroupStatus(b)};a.loadGroupTab=function(a){"error"===a.status?alert("Unable to process your request. "+a.errorMessage):(d.loadTab({tabId:a.data.contactId,isGroup:!0}),b("#mck-search").val(""))};a.addMembersToGroupInfoList=function(c){var e=c.members;e.sort();Ob.html("");b.each(e,function(e,h){if(h){var n=d.fetchContact(""+
h);0===b("#li-gm-"+n.htmlId).length&&a.addGroupMember(c,n)}});a.sortGroupMemberHtmlList();a.enableGroupAdminMenuToggle()};a.enableGroupAdminMenuToggle=function(){b(".mck-group-member-info").bind("mouseenter",function(){b(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",function(){b(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};a.addGroupMember=function(a,h){var n="n-vis",f="n-vis",p=a.users[h.contactId],l=MCK_LABELS.member,C=3;p&&"undefined"!==typeof p.role&&
(C=p.role,l=c[p.role]);p=d.getTabDisplayName(h.contactId,!1);h.contactId===a.adminName&&(n="vis");a.adminName===D&&(f="vis");h.contactId===D&&(p=MCK_LABELS.you,f="n-vis");var u=d.getContactImageLink(h,p),q="";ia[h.contactId]||(r.MCK_OL_MAP[h.contactId]?q=MCK_LABELS.online:U[h.contactId]&&(q=mckDateUtils.getLastSeenAtStatus(U[h.contactId])));n=[{roleExpr:l,roleVal:C,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:h.htmlId,contIdExpr:h.contactId,
contImgExpr:u,contLastSeenExpr:q,contNameExpr:p,contFirstAlphaExpr:p.charAt(0).toUpperCase(),isAdminExpr:n,enableAdminMenuExpr:f}];b.tmpl("groupMemberTemplate",n).appendTo("#mck-group-member-list")};a.addMembersToGroupSearchList=function(){var c=P.data("mck-id");if(P.data("isgroup")){var e=mckGroupUtils.getGroup(c),h=Ia,n=[],c=ALStorage.getFriendListGroupName(),f=ALStorage.getFriendListGroupType();c&&f&&(h=Z.getFriendList(c,f));c&&!f&&(h=Z.getFriendList(c));h=h.filter(function(b,a){return h.indexOf(b)===
a});h.sort();var l=e.members;b.each(h,function(b,c){c&&(c="object"===typeof c&&c.contactId?d.fetchContact(""+c.contactId):d.fetchContact(""+c),-1===l.indexOf(c.contactId)||-1!==l.indexOf(c.contactId)&&-1!==e.removedMembersId.indexOf(c.contactId))&&(a.addGroupSearchMember(c),n.push(c))});a.enableGroupAdminMenuToggle();0<n.length?O.removeClass("vis").addClass("n-vis"):O.removeClass("n-vis").addClass("vis");d.initAutoSuggest({contactsArray:n,$searchId:bb,isContactSearch:!1})}u.removeClass("vis").addClass("n-vis")};
a.addGroupSearchMember=function(a){var c=d.getTabDisplayName(a.contactId,!1),h=d.getContactImageLink(a,c),e="user-"+a.htmlId,n="";ia[a.contactId]||(r.MCK_OL_MAP[a.contactId]?n=MCK_LABELS.online:U[a.contactId]&&(n=mckDateUtils.getLastSeenAtStatus(U[a.contactId])));b.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:e,contIdExpr:a.contactId,contImgExpr:h,contLastSeenExpr:n,contNameExpr:c}]).appendTo("#mck-group-member-search-list")};a.loadCreateGroupTab=function(){C.removeClass("vis").addClass("n-vis");
F.removeClass("vis").addClass("n-vis");R.removeClass("vis").addClass("n-vis");x.removeClass("vis").addClass("n-vis");I.removeClass("vis").addClass("n-vis");ba.data("iconurl","");Pb.html("");X.removeClass("n-vis");aa.html(MCK_LABELS["add.group.icon"]);ba.html(mckGroupService.getGroupDefaultIcon());K.removeClass("n-vis").addClass("vis")};a.loadGroupInfo=function(b){if(b.groupId){pa.attr("contenteditable",!1);y.removeClass("vis").addClass("n-vis");E.removeClass("n-vis").addClass("vis");C.removeClass("vis").addClass("n-vis");
F.removeClass("vis").addClass("n-vis");R.removeClass("vis").addClass("n-vis");J.removeClass("vis").addClass("n-vis");K.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");qb.removeClass("vis").addClass("n-vis");x.removeClass("n-vis").addClass("vis");x.data("mck-id",b.groupId);L.data("iconurl","");b.conversationId&&x.data("mck-conversation-id",b.conversationId);Ob.html("");var d=mckGroupUtils.getGroup(b.groupId);"object"===typeof d?(L.html(mckGroupService.getGroupImage(d.imageUrl)),
pa.html(d.displayName),a.addMembersToGroupInfoList(d),d.adminName===D?pb.removeClass("n-vis").addClass("vis"):pb.removeClass("vis").addClass("n-vis")):mckGroupService.getGroupFeed({groupId:b.groupId,apzCallback:t.onGroupFeed})}};a.sortGroupMemberHtmlList=function(){b("#mck-group-member-list .mck-li-group-member").sort(function(b,a){return b.dataset.alpha>a.dataset.alpha}).appendTo("#mck-group-member-list")};a.addGroupMemberFromSearch=function(b){var a=x.data("mck-id");if("undefined"!==typeof a&&"undefined"!==
typeof b){var d=mckGroupUtils.getGroup(a);"object"===typeof d&&D===d.adminName?(na.loadUserProfile(b),mckGroupService.addGroupMember({groupId:a,userId:b,apzCallback:t.onAddedGroupMember})):sc.removeClass("vis").addClass("n-vis")}Q.mckModal("hide")}},rb=new function(){var a=this,c=["CREATE","UPDATE"],f=b("#mck-file-box"),l=b(".mck-overlay"),q=b("#mck-msg-sbmt"),r=b("#mck-text-box"),v=b("#mck-file-input"),O=b(".mck-overlay-box"),u=b(".mck-file-upload"),A=b("#mck-group-icon-upload"),x=b("#mck-group-icon-change"),
t=b("#mck-group-info-icon-box"),D=b("#mck-btn-group-icon-save"),y=b("#mck-message-cell .mck-message-inner"),G=b("#mck-group-create-icon-box"),J=b("#mck-group-info-icon-loading"),H=b("#mck-group-create-icon-loading"),h=b("#mck-group-info-icon-box .mck-group-icon"),K=b("#mck-group-create-icon-box .mck-group-icon"),C=b("#mck-gc-overlay-label");b.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"progress progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"progress-bar progress-bar-success bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
a.init=function(){u.on("click",function(){v.trigger("click")});A.on("change",function(){var d=b(this)[0].files[0];a.uplaodFileToAWS(d,c[0]);return!1});x.on("change",function(){var d=b(this)[0].files[0];a.uplaodFileToAWS(d,c[1]);return!1});v.on("change",function(){var d=b(this)[0].files[0],c={};c.file=d;c.name=d.name;"awsS3Server"===Aa?a.uploadAttachment2AWS(c):"googleCloud"===Aa?a.customFileUpload(c):a.uploadFile(c)});b(s).on("click",".mck-remove-file",function(){var a=b(this).parents(".mck-file-box"),
d=a.data("mckfile");a.remove();q.attr("disabled",!1);0===f.find(".mck-file-box").length&&(f.removeClass("vis").addClass("n-vis"),r.attr("required",""));"object"===typeof d&&(E.deleteFileMeta(d.blobKey),b.each(F,function(b,a){"undefined"!==typeof a&&a.blobKey===d.blobKey&&F.splice(b,1)}))})};a.audioRecoder=function(b){"awsS3Server"===Aa?a.uploadAttachment2AWS(b):"googleCloud"===Aa?a.customFileUpload(b):a.uploadFile(b)};a.customFileUpload=function(a){var c=a.file,h=new FormData,e=[];if("undefined"!==
typeof c)if(4<b(".mck-file-box").length&&e.push("Can't upload more than 5 files at a time"),c.size>1048576*W&&e.push("file size can not be more than "+W+" MB"),0<e.length)alert(e.toString());else{var e=N.randomId(),l=[{fileIdExpr:e,fileName:a.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+a.name+"\x3c/a\x3e",fileSizeExpr:E.getFilePreviewSize(c.size)}];b.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var C=b(".mck-file-box."+e),A=b(".mck-file-box."+e+" .mck-file-lb"),K=b(".mck-file-box."+
e+" .progress .bar"),v=b(".mck-file-box."+e+" .progress"),s=b(".mck-file-box."+e+" .mck-remove-file");K.css("width","0%");v.removeClass("n-vis").addClass("vis");s.attr("disabled",!0);u.attr("disabled",!0);f.removeClass("n-vis").addClass("vis");if(a.name===b(".mck-file-box."+e+" .mck-file-lb a").html()){var x=y.data("mck-id");X[a.name+c.size]=x;q.attr("disabled",!0);h.append("files[]",c);a=new XMLHttpRequest;(a.upload||a).addEventListener("progress",function(b){b=parseInt(b.loaded/b.total*100,10);
K.css("width",b+"%")});a.addEventListener("load",function(a){a=b.parseJSON(this.responseText);if("object"===typeof a){a=a.fileMeta;var c="object"===typeof a?'\x3ca href\x3d"'+a.url+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":"",e=a.name,h=a.size,n=y.data("mck-id"),e=e+h,h=X[e];if(x!==n)d.updateDraftMessage(h,a),delete X[e];else return s.attr("disabled",!1),u.attr("disabled",!1),q.attr("disabled",!1),delete X[e],A.html(c),v.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),
r.removeAttr("required"),F.push(a),C.data("mckfile",a),u.children("input").val(""),!1}else s.attr("disabled",!1),q.attr("disabled",!1),s.trigger("click")});a.open("post",Ub+"/files/upload/",!0);a.setRequestHeader("UserId-Enabled",!0);a.setRequestHeader("Authorization","Basic "+m);a.setRequestHeader("Application-Key",Q);a.setRequestHeader("Device-Key",S);aa&&a.setRequestHeader("Access-Token",aa);a.send(h)}return!1}};a.uploadFile=function(a){var c=a.file,e=[];if("undefined"!==typeof c)if(4<b(".mck-file-box").length&&
e.push("Can't upload more than 5 files at a time"),c.size>1048576*W&&e.push("file size can not be more than "+W+" MB"),0<e.length)alert(e.toString());else{var e=N.randomId(),h=[{fileIdExpr:e,fileName:a.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+a.name+"\x3c/a\x3e",fileSizeExpr:E.getFilePreviewSize(c.size)}];b.tmpl("fileboxTemplate",h).appendTo("#mck-file-box");var l=b(".mck-file-box."+e),C=b(".mck-file-box."+e+" .mck-file-lb"),m=b(".mck-file-box."+e+" .progress .bar"),A=b(".mck-file-box."+
e+" .progress"),K=b(".mck-file-box."+e+" .mck-remove-file");m.css("width","0%");A.removeClass("n-vis").addClass("vis");K.attr("disabled",!0);u.attr("disabled",!0);f.removeClass("n-vis").addClass("vis");if(a.name===b(".mck-file-box."+e+" .mck-file-lb a").html()){var v=y.data("mck-id");X[a.name+c.size]=v;q.attr("disabled",!0);a=[];a.push(c);var s=new XMLHttpRequest;(s.upload||s).addEventListener("progress",function(b){b=parseInt(b.loaded/b.total*100,10);m.css("width",b+"%")});s.addEventListener("load",
function(a){a=b.parseJSON(this.responseText);if("object"===typeof a.fileMeta){a=a.fileMeta;var c=E.getFilePreviewPath(a),e=a.name,h=a.size,n=y.data("mck-id"),e=e+h,h=X[e];if(v!==n)d.updateDraftMessage(h,a),delete X[e];else return K.attr("disabled",!1),u.attr("disabled",!1),q.attr("disabled",!1),delete X[e],C.html(c),A.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),F.push(a),l.data("mckfile",a),u.children("input").val(""),
!1}else K.attr("disabled",!1),q.attr("disabled",!1),K.trigger("click")});b.ajax({type:"GET",url:hb+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(b){var a=new FormData;a.append("files[]",c);s.open("POST",b,!0);s.send(a)},error:function(){}})}return!1}};a.uploadAttachment2AWS=function(a){var c=a.file,e=new FormData,h=[];if("undefined"!==typeof c)if(4<b(".mck-file-box").length&&h.push("Can't upload more than 5 files at a time"),c.size>1048576*W&&
h.push("file size can not be more than "+W+" MB"),0<h.length)alert(h.toString());else{var h=N.randomId(),l=[{fileIdExpr:h,fileName:a.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+a.name+"\x3c/a\x3e",fileSizeExpr:E.getFilePreviewSize(c.size)}];b.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var C=b(".mck-file-box."+h),K=b(".mck-file-box."+h+" .mck-file-lb"),A=b(".mck-file-box."+h+" .progress .bar"),v=b(".mck-file-box."+h+" .progress"),s=b(".mck-file-box."+h+" .mck-remove-file");
A.css("width","0%");v.removeClass("n-vis").addClass("vis");s.attr("disabled",!0);u.attr("disabled",!0);f.removeClass("n-vis").addClass("vis");if(a.name===b(".mck-file-box."+h+" .mck-file-lb a").html()){var x=y.data("mck-id");X[a.name+c.size]=x;q.attr("disabled",!0);e.append("file",c);a=new XMLHttpRequest;(a.upload||a).addEventListener("progress",function(b){b=parseInt(b.loaded/b.total*100,10);A.css("width",b+"%")});a.addEventListener("load",function(a){a=b.parseJSON(this.responseText);if("object"===
typeof a){var c="object"===typeof a?'\x3ca href\x3d"'+a.url+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":"",e=a.name,h=a.size,f=y.data("mck-id"),e=e+h,h=X[e];if(x!==f)d.updateDraftMessage(h,a),delete X[e];else return s.attr("disabled",!1),u.attr("disabled",!1),q.attr("disabled",!1),delete X[e],K.html(c),v.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),F.push(a),C.data("mckfile",a),u.children("input").val(""),!1}else s.attr("disabled",
!1),q.attr("disabled",!1),s.trigger("click")});a.open("post",MCK_BASE_URL+"/rest/ws/upload/image",!0);a.setRequestHeader("UserId-Enabled",!0);a.setRequestHeader("Authorization","Basic "+m);a.setRequestHeader("Application-Key",Q);a.setRequestHeader("Device-Key",S);aa&&a.setRequestHeader("Access-Token",aa);a.send(e)}return!1}};a.uplaodFileToAWS=function(b,a){var d=new FormData,f=[];"undefined"!==typeof b&&(-1===b.type.indexOf("image")&&f.push("Please upload image file."),0<f.length?alert(f.toString()):
(l.attr("disabled",!0),c[0]===a?(G.find(".mck-overlay-box").removeClass("n-vis"),G.removeClass("mck-hover-on"),H.removeClass("n-vis").addClass("vis")):(t.find(".mck-overlay-box").removeClass("n-vis"),t.removeClass("mck-hover-on"),J.removeClass("n-vis").addClass("vis")),f=new XMLHttpRequest,f.addEventListener("load",function(b){if(b=this.responseText)c[0]===a?(K.html('\x3cimg src\x3d"'+b+'"/\x3e'),K.data("iconurl",b),C.html(MCK_LABELS["change.group.icon"]),H.removeClass("vis").addClass("n-vis"),G.addClass("mck-hover-on")):
(h.html('\x3cimg src\x3d"'+b+'"/\x3e'),h.data("iconurl",b),J.removeClass("vis").addClass("n-vis"),t.addClass("mck-hover-on"),setTimeout(function(){D.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){O.addClass("n-vis")},1500);l.attr("disabled",!1);c[0]===a?A.val(""):x.val("");return!1}),d.append("file",b),f.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),f.setRequestHeader("UserId-Enabled",!0),f.setRequestHeader("Authorization","Basic "+m),f.setRequestHeader("Application-Key",
Q),f.setRequestHeader("Device-Key",S),aa&&f.setRequestHeader("Access-Token",aa),f.send(d)))};a.addFileBox=function(a){var d=N.randomId(),c="";"object"===typeof a.fileMeta&&(d=a.fileMeta.createdAtTime,c=a.fileMeta.name);b.tmpl("fileboxTemplate",[{fileNameExpr:a.filelb,fileSizeExpr:a.filesize,fileIdExpr:d,fileName:c}]).appendTo("#mck-file-box");var d=b(".mck-file-box."+d),c=d.find(".mck-remove-file"),e=d.find(".progress");"object"===typeof a.fileMeta?(d.data("mckblob",a.fileMeta.blobKey),r.removeAttr("required"),
q.attr("disabled",!1),c.attr("disabled",!1),e.removeClass("vis").addClass("n-vis"),F.push(a.fileMeta)):(q.attr("disabled",!0),c.attr("disabled",!0),e.removeClass("n-vis").addClass("vis"))}},d=new function(){var a=this,c="",f=b("#mck-search"),l=b("#mck-msg-to"),q=b(".mck-file-lb"),m=b(".mck-file-sz"),v=b("#mck-sidebox"),O=b("#mck-file-box"),u=b("#mck-msg-sbmt"),A=b("#mck-msg-form"),x=b("#mck-text-box"),R=b("#mck-msg-error");b("#mck-show-more");var Ua=b("#mck-tab-title"),L=b("#mck-tab-status"),Q=b("#mck-message-cell"),
I=b(".mck-typing-box"),H=b("#mck-no-messages"),h=b("#mck-product-box"),K=b(".mck-product-icon"),C=b(".mck-product-title"),n=b(".mck-product-subtitle"),ra=b("#mck-product-box .mck-caret"),$a=b(".mck-product-rt-up .mck-product-key"),ob=b("#mck-contact-search-input-box"),X=b(".mck-product-rt-up .mck-product-value"),aa=b(".mck-product-rt-down .mck-product-key"),Ea=b(".mck-product-rt-down .mck-product-value");b("#li-mck-group-info");b("#li-mck-leave-group");var S=b("#mck-group-info-tab"),da=b("#mck-group-search-tab"),
bb=b("#mck-no-search-groups"),ha=b("#mck-group-create-tab"),ga=b("#mck-group-search-list");b("#mck-group-search-tabview");var ka=b(".mck-group-menu-options"),P=b(".mck-videocall-btn"),pa=b("#mck-group-search-input"),qb=b("#mck-group-search-input-box"),fa=b("#mck-contact-search-list"),ja=b("#mck-contacts-content"),ca=b("#mck-contact-search-tab");b("#mck-contact-search-tabview");var ba=b("#mck-contact-search-input");b("#mck-search-list");var W=b("#mck-no-search-contacts"),Ba=b("#mck-search-tab-box li a"),
sa=b("#mck-search-tabview-box"),ea=b("#mck-sidebox-search"),Qb=b("#mck-contact-loading"),tc=b("#mck-typing-label"),p=b("#mck-price-widget"),ya=b("#mck-msg-response"),Aa=b("#mck_response_text"),Ja=b("#li-mck-block-user"),va=b("#li-mck-video-call"),Na=b("#mck-search-loading"),cb=b("#mck-tab-individual"),db=b("#mck-attachfile-box"),g=b("#mck-attachmenu-box"),B=b("#mck-sidebox-content"),w=b("#mck-tab-option-panel"),ua=b("#mck-tab-conversation"),Ra=b("#mck-conversation-header"),sb=b("#mck-no-conversations"),
Wa=b("#mck-conversation-list"),Sa=b(".mck-tab-message-option"),eb=b(".mck-box-ft .mck-box-form"),mc=b("#mck-btn-clear-messages"),Rb=b("#mck-offline-message-box"),z=b("#mck-message-cell .mck-message-inner");b("#mck-msg-new");var uc=RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);b.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}" data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d "move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${nameTextExpr} mck-truncate ${showNameExpr}"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}" data-filename\x3d"${fileNameExpr}" data-fileurl\x3d "${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
b.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.openConversation=function(){"none"===v.css("display")&&(b(".mckModal").mckModal("hide"),v.mckModal());l.focus()};a.initEmojis=function(){try{b("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(k){c||(c=setTimeout(function(){a.initEmojis()},3E4))}};a.loadTab=function(k,c){var e=z.data("mck-id");if(e)if(1<x.html().length||O.hasClass("vis")){var f={text:x.html(),files:[]};O.hasClass("vis")&&b(".mck-file-box").each(function(){var a=b(this),k={filelb:a.find(".mck-file-lb").html(),
filesize:a.find(".mck-file-sz").html()},a=a.data("mckfile");"object"===typeof a&&(k.fileMeta=a);f.files.push(k)});Ha[e]=f}else delete Ha[e];wa=!0;a.clearMessageField(!1);a.addDraftMessage(k.tabId);R.html("");R.removeClass("vis").addClass("n-vis");Aa.html("");ya.removeClass("vis").addClass("n-vis");A[0].reset();A.removeClass("n-vis").addClass("vis");z.html("");R.removeClass("mck-no-mb");ja.removeClass("n-vis").addClass("vis");eb.removeClass("vis").addClass("n-vis");ea.removeClass("vis").addClass("n-vis");
S.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");B.removeClass("n-vis").addClass("vis");h.removeClass("vis").addClass("n-vis");Ra.addClass("n-vis");Qb.removeClass("vis").addClass("n-vis");z.removeClass("mck-group-inner");L.removeClass("vis").addClass("n-vis");Ua.removeClass("mck-tab-title-w-status");Ua.removeClass("mck-tab-title-w-typing");I.removeClass("vis").addClass("n-vis");tc.html(MCK_LABELS.typing);z.data("isgroup",k.isGroup);z.data("datetime","");if(k.tabId)l.val(k.tabId),
z.data("mck-id",k.tabId),z.data("mck-conversationid",k.conversationId),z.data("mck-topicid",k.topicId),w.data("tabId",k.tabId),w.removeClass("n-vis").addClass("vis"),ja.removeClass("vis").addClass("n-vis"),eb.removeClass("n-vis").addClass("vis"),mc.removeClass("n-vis").addClass("vis"),ka.removeClass("vis").addClass("n-vis"),k.isGroup?(z.addClass("mck-group-inner"),Ja.removeClass("vis").addClass("n-vis"),va.removeClass("vis").addClass("n-vis"),P.removeClass("vis").addClass("n-vis")):(Ja.removeClass("n-vis").addClass("vis"),
va.removeClass("n-vis").addClass("vis"),za&&P.removeClass("n-vis").addClass("vis")),!k.topicId&&k.conversationId&&(e=V[k.conversationId],"object"===typeof e&&(k.topicId=e.topicId)),k.topicId&&(e=T[k.topicId],"object"===typeof e&&(Ca?(z.data("mck-title",e.title),Ra.html(e.title),Ra.removeClass("n-vis")):Ka&&(a.setProductProperties(e,k.topicId),ra.addClass("n-vis"),h.addClass("mck-product-box-wc"),Wa.addClass("n-vis"),h.removeClass("n-vis").addClass("vis")))),Bb&&r.google&&"object"===typeof r.google.maps?
(db.removeClass("vis").addClass("n-vis"),g.removeClass("n-vis").addClass("vis")):(g.removeClass("vis").addClass("n-vis"),db.removeClass("n-vis").addClass("vis")),e=a.getTabDisplayName(k.tabId,k.isGroup,k.userName),a.isGroupDeleted(k.tabId,k.isGroup)&&(R.html(MCK_LABELS["group.deleted"]),R.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),A.removeClass("vis").addClass("n-vis")),Ua.html(e),Ua.attr("title",e),ua.removeClass("vis").addClass("n-vis"),sa.removeClass("vis").addClass("n-vis"),cb.removeClass("n-vis").addClass("vis"),
"support"===xb&&b(".mck-tab-link").removeClass("vis").addClass("n-vis"),Ib&&(p.removeClass("n-vis").addClass("vis"),z.addClass("mck-msg-w-panel")),Xa&&(R.html("Deactivated"),R.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),A.removeClass("vis").addClass("n-vis")),Y.subscibeToTypingChannel(k.isGroup?k.tabId:D),"function"===typeof Fb&&Fb({tabId:k.tabId,isGroup:k.isGroup});else if(k.tabId="",Ya&&d.hideOfflineMessage(),cb.removeClass("vis").addClass("n-vis"),ua.removeClass("n-vis").addClass("vis"),
sa.removeClass("n-vis").addClass("vis"),h.removeClass("vis").addClass("n-vis"),z.data("mck-id",""),z.data("mck-conversationid",""),z.data("mck-topicid",""),p.removeClass("vis").addClass("n-vis"),z.removeClass("mck-msg-w-panel"),w.removeClass("vis").addClass("n-vis"),mc.removeClass("vis").addClass("n-vis"),l.val(""),e=ALStorage.getLatestMessageArray(),Y.unsubscibeToTypingChannel(),null!==e&&0<e.length){k.isReload=!0;d.addContactsFromMessageList({message:e},k);a.openConversation();wa=!1;return}G.loadMessageList(k,
c);a.openConversation()};a.setProductProperties=function(b,g){C.html(b.title);K.html(a.getTopicLink(b.link));n.html(b.subtitle?b.subtitle:"");var d=b.value1?":"+b.value1:"";$a.html(b.key1?b.key1:"");X.html(d);d=b.value2?":"+b.value2:"";aa.html(b.key2?b.key2:"");Ea.html(d);"function"===typeof Cb&&(b.topicId=g,Cb(b))};a.getTopicLink=function(b){return b?'\x3cimg src\x3d"'+b+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};a.processMessageList=function(k,g,c){var e,h=z.children("div[name\x3d'message']:first"),
B=z.data("mck-id"),f=z.data("isgroup")?mckGroupUtils.getGroup(B):d.fetchContact(B);"undefined"===typeof k.message.length?(B=[],B.push(k.message),ALStorage.updateMckMessageArray(B),a.addMessage(k.message,f,!1,!1,c),e=k.createdAtTime):(ALStorage.updateMckMessageArray(k.message),b.each(k.message,function(b,k){"undefined"!==typeof k.to&&(a.addMessage(k,f,!1,!1,c),e=k.createdAtTime)}));w.data("datetime",e);!g&&0<h.length?z.scrollTop(h.offset().top-z.offset().top+z.scrollTop()):g&&z.animate({scrollTop:z.prop("scrollHeight")},
"fast")};a.closeConversation=function(b){if("function"===typeof Eb){var a=Eb();if("object"===typeof a)var g="BUSY_WITH_OTHER"===b?a.onBusyWithOtherUser:a.onConversationClose}g||(g="Chat disabled with user");R.html(g);R.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");A.removeClass("vis").addClass("n-vis")};a.addTooltip=function(a){b("."+a+" .mck-icon-time").attr("title","pending");b("."+a+" .mck-btn-trash").attr("title","delete");b("."+a+" .mck-icon-sent").attr("title","sent");b("."+a+" .mck-btn-forward").attr("title",
"forward message");b("."+a+" .mck-icon-delivered").attr("title","delivered");b("."+a+" .mck-icon-read").attr("title","delivered and read");b("."+a+" .msgtype-outbox-cr").attr("title","sent via Carrier");b("."+a+" .msgtype-outbox-mck").attr("title","sent");b("."+a+" .msgtype-inbox-cr").attr("title","received via Carrier");b("."+a+" .msgtype-inbox-mck").attr("title","recieved")};a.fetchContact=function(b){var g=a.getContact(b);"undefined"===typeof g&&(g=a.createContact(b));return g};a.getContact=function(b){if("object"===
typeof Fa[b])return Fa[b]};a.getContactDisplayName=function(b){if("string"===typeof ma[b])return ma[b];if("undefined"===typeof ma[b]&&(b=M[b],"undefined"!==typeof b))return b.displayName};a.addMessage=function(k,g,c,e,h){var B="",f="",w="",l="vis",p="n-vis",n="",C="n-vis";if("object"===typeof k.metadata&&"undefined"!==typeof k.metadata.AL_REPLY&&(B=k.metadata.AL_REPLY,f=y.getReplyMessageByKey(B),"undefined"!==typeof f)){if(g.isGroup&&f||!g.isGroup&&"undefined"===typeof f.fileMeta)C="vis";n=5===f.type?
"You":d.getTabDisplayName(f.to,!1);if("object"===typeof f.fileMeta||2===f.contentType)w=a.getImageForReplyMessage(f),l="n-vis",p="vis",C="n-vis"}if(6!==k.type&&7!==k.type&&!(k.metadata&&"HIDDEN"===k.metadata.category||102===k.contentType||10===k.contentType&&k.metadata&&"true"===k.metadata.hide||0<b("#mck-message-cell ."+k.key).length)){H.hasClass("vis")&&H.removeClass("vis").addClass("n-vis");var ua="mck-msg-right",u="mck-icon-time";if(0===k.type||4===k.type||6===k.type)ua="mck-msg-left";if(4===
k.contentType||10===k.contentType||103===k.contentType)ua="mck-msg-center";var u=a.getStatusIconName(k),B=k.key,q="'"+k.deviceKey+"','"+k.to+"','"+k.to+"','"+B+"'",K="",m="",A="",v="n-vis",sb="";na.loadUserProfile(k.to);!k.groupId||4===k.contentType||7===g.type||0!==k.type&&4!==k.type&&6!==k.type||(K=a.getTabDisplayName(k.to,!1),v="vis",A=a.getNameTextClassByAlphabet(K));if(ac){var sb="mck-msg-avator-bubble",Ma="",x=K;"mck-msg-right"===ua?(Ma=d.fetchContact(D),x=a.getTabDisplayName(Ma.displayName,
!1)):"mck-msg-left"===ua&&(Ma=k.groupId?d.fetchContact(k.to):g);Ma&&(m=a.getContactImageLink(Ma,x))}k.groupId&&10===k.contentType&&(A=m=K="");g="n-vis";var x=Ma="",O=k.message;"object"===typeof k.fileMeta&&(Ma=k.fileMeta.name,x=k.fileMeta.size);"object"===typeof k.fileMeta&&(k.fileMeta.contentType.indexOf("audio")||k.fileMeta.contentType.indexOf("image")||k.fileMeta.contentType.indexOf("video"))&&(g="vis");var ra="n-vis";kb&&r.MCK_OL_MAP[k.to]&&10!==k.contentType&&(ra="vis");w=[{msgReply:f?f.message+
"\n":"",msgReplyTo:f?n+"\n":"",msgReplyDivExpr:f?"vis":"n-vis",msgReplyToVisibleExpr:C,msgPreview:w?a.getImageForReplyMessage(f):"",msgpreviewvisExpr:p,textreplyVisExpr:l,msgKeyExpr:k.key,msgDeliveredExpr:k.delivered,msgSentExpr:k.sent,msgCreatedAtTime:k.createdAtTime,msgTypeExpr:k.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"vis",msgSourceExpr:k.source,statusIconExpr:u,contactExpr:"vis",toExpr:k.to,msgAvatorClassExpr:sb,
showNameExpr:v,msgNameExpr:K,msgImgExpr:m,nameTextExpr:A,msgFloatExpr:ua,replyIdExpr:B,createdAtTimeExpr:mckDateUtils.getDate(k.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:q,downloadMediaUrlExpr:E.getFileAttachment(k),msgClassExpr:"",msgExpr:O,selfDestructTimeExpr:k.timeToLive,fileMetaKeyExpr:k.fileMetaKey,downloadIconVisibleExpr:g,fileExpr:d.getFilePath(k),fileUrlExpr:E.getFileurl(k),fileNameExpr:Ma,fileSizeExpr:x,contOlExpr:ra}];c?b.tmpl("messageTemplate",w).appendTo("#mck-message-cell .mck-message-inner"):
b.tmpl("messageTemplate",w).prependTo("#mck-message-cell .mck-message-inner");w="";k.message&&(w=k.message.replace(/\n/g,"\x3cbr/\x3e"),null!==r.emoji&&"undefined"!==typeof r.emoji&&(w=r.emoji.replace_unified(w),w=r.emoji.replace_colons(w)));k.conversationId&&(l=V[k.conversationId],"object"!==typeof l&&y.getTopicId({conversationId:k.conversationId},function(b){d.populateMessage(b.messageType,b.message,b.notifyUser)}),c&&(z.data("mck-conversationid",k.conversationId),l&&(p=T[l.topicId],"object"===
typeof p&&(Ka?a.setProductProperties(p,l.topicId):Ca&&Ra.html(p.title)))));4===k.contentType&&(l=w,w="Final agreed price: "+w,Ib||(w+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+l+'" data-mck-conversationid\x3d"'+k.conversationId+'"\x3eAccept\x3c/button\x3e'));l=b("."+B+" .mck-msg-content");if(-1===w.indexOf("emoji-inner")&&0===k.contentType)for(w=w.split("\x3cbr/\x3e"),p=0;p<w.length;p++)n=s.createElement("div"),n.appendChild(s.createTextNode(w[p])),w[p]&&w[p].match(uc)&&
(n=b(n).linkify({target:"_blank"})),l.append(n);else l.html(w),l.linkify({target:"_blank"});k.fileMeta&&(b("."+B+" .mck-file-text a:first").trigger("click"),b("."+B+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===l.html()&&l.removeClass("vis").addClass("n-vis"));2===k.contentType&&(l.removeClass("vis").addClass("n-vis"),b("."+B+" .mck-file-text").removeClass("n-vis").addClass("vis"));e&&z.animate({scrollTop:z.prop("scrollHeight")},"fast");Sa.hasClass("n-vis")&&(k.groupId?6!==mckGroupUtils.getGroup(k.groupId).type&&
Sa.removeClass("n-vis").addClass("vis"):Sa.removeClass("n-vis").addClass("vis"));a.addTooltip(k.key);4!==k.contentType&&10!==k.contentType&&h&&a.messageContextMenu(k.key);k.groupId&&10===k.contentType&&c&&mckGroupService.getGroupFeed({groupId:k.groupId,isReloadTab:!0,apzCallback:t.onGroupFeed})}};a.addContactForSearchList=function(k,g,d){var c=k.userCount,e=k.isGroup,h=a.getTabDisplayName(k.contactId,e),B=a.getContactImageLink(k,h),f=e?"gs-group-"+k.htmlId:"cs-user-"+k.htmlId,w="",l=e&&Lb;b("#li-"+
f+" .mck-group-count-text").html(c);e||ia[k.contactId]||(r.MCK_OL_MAP[k.contactId]?w=MCK_LABELS.online:U[k.contactId]&&(w=mckDateUtils.getLastSeenAtStatus(U[k.contactId])));k=[{contHtmlExpr:f,contIdExpr:k.contactId,contTabExpr:k.isGroup,contImgExpr:B,contLastSeenExpr:w,contNameExpr:h,groupUserCountExpr:k.userCount,displayGroupUserCountExpr:l?"vis":"n-vis"}];!0===d&&b.tmpl("searchContactbox",k).appendTo("#"+g);b.tmpl("searchContactbox",k).prependTo("#"+g)};a.getFilePath=function(k){if(2===k.contentType)try{var g=
b.parseJSON(k.message);if(g.lat&&g.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+g.lat+","+g.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+g.lat+","+g.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+g.lat+","+g.lon+"\x26key\x3d"+Zb+'"/\x3e\x3c/a\x3e'}catch(d){if(-1!==k.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+
k.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+k.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+k.message+"\x26key\x3d"+Zb+'" /\x3e\x3c/a\x3e'}if("object"===typeof k.fileMeta){if(-1!==k.fileMeta.contentType.indexOf("image")){if(-1!==k.fileMeta.contentType.indexOf("svg"))return'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+k.fileMeta.contentType+
'" data-url\x3d"'+E.getFileurl(k)+'" data-name\x3d"'+k.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.getFileurl(k)+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';if(5===k.contentType)return'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+k.fileMeta.contentType+'" data-url\x3d"'+k.fileMeta.blobKey+'" data-name\x3d"'+k.fileMeta.name+'"\x3e\x3cimg src\x3d"'+k.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';if(k.fileMeta.hasOwnProperty("url")){if(-1!==
k.fileMeta.url.indexOf("www.googleapis.com")){var c;E.generateCloudUrl(k.fileMeta.thumbnailBlobKey,function(b){c=b});return'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+k.fileMeta.contentType+'" data-url\x3d"" data-blobKey\x3d"'+k.fileMeta.blobKey+'" data-name\x3d"'+k.fileMeta.name+'"\x3e\x3cimg src\x3d"'+c+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e'}return'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
k.fileMeta.contentType+'" data-url\x3d"'+E.getFileurl(k)+'" data-name\x3d"'+k.fileMeta.name+'"\x3e\x3cimg src\x3d"'+k.fileMeta.thumbnailUrl+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e'}return k.fileMeta.thumbnailUrl==="thumbnail_"+k.fileMeta.name?'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+k.fileMeta.contentType+'" data-url\x3d"'+E.getFileurl(k)+'" data-name\x3d"'+k.fileMeta.name+'"\x3e\x3cimg src\x3d"'+Vb+"/files/thumbnail_"+k.fileMeta.name+
'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+k.fileMeta.contentType+'" data-url\x3d"'+E.getFileurl(k)+'" data-name\x3d"'+k.fileMeta.name+'"\x3e\x3cimg src\x3d"'+k.fileMeta.thumbnailUrl+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e'}if(-1!==k.fileMeta.contentType.indexOf("video")){if(-1!==k.fileMeta.url.indexOf("www.googleapis.com")){var e;E.generateCloudUrl(k.fileMeta.blobKey,function(b){e=
b});return'\x3ca href\x3d"#" target\x3d"_self"\x3e\x3cvideo controls class\x3d"mck-video-player" onplay\x3d"alFileService.updateAudVidUrl(this);" data-cloud-service\x3d"google_cloud" data-blobKey\x3d"'+k.fileMeta.blobKey+'"\x3e\x3csource src\x3d"'+e+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+e+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e'}return'\x3ca href\x3d "#" \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+E.getFileurl(k)+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+
E.getFileurl(k)+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e'}return-1!==k.fileMeta.contentType.indexOf("audio")?k.fileMeta.hasOwnProperty("url")&&-1!==k.fileMeta.url.indexOf("www.googleapis.com")?(E.generateCloudUrl(k.fileMeta.blobKey,function(b){e=b}),'\x3ca href\x3d"#" target\x3d"_self"\x3e\x3caudio controls class\x3d"mck-audio-player" onplay\x3d"alFileService.updateAudVidUrl(this);" data-cloud-service\x3d"google_cloud" data-blobKey\x3d"'+k.fileMeta.blobKey+'"\x3e\x3csource src\x3d"'+e+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+
e+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e'):'\x3ca href\x3d"#" target\x3d"_self"\x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+E.getFileurl(k)+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+E.getFileurl(k)+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e'}return""};a.getImageForMessagePreview=
function(a){if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+E.getFileurl(a)+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+
E.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+E.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};a.getImageForReplyMessage=function(a){var g=d.getTabDisplayName(a.to,!1);if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+g+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+
E.getFileurl(a)+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+g+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+E.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":
'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+g+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+E.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+g+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};a.getContactImageLink=function(b,g){var c="";if(b.isGroup&&7!==b.type)c=mckGroupService.getGroupImage(b.imageUrl);else{b.isGroup&&7===b.type&&1<b.members.length&&mckGroupService.getContactFromGroupOfTwo(b,function(a){b=d.fetchContact(a)});if("function"===typeof Pa){var e=Pa(b.contactId);e&&"undefined"!==typeof e&&(c='\x3cimg src\x3d"'+e+'"/\x3e')}c||
(b.photoSrc?c='\x3cimg src\x3d"'+b.photoSrc+'"/\x3e':b.photoData?c='\x3cimg src\x3d"data:image/jpeg;base64,'+b.photoData+'"/\x3e':b.photoLink?c='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+b.photoLink+'"/\x3e':(g||(g=b.displayName),c=a.getContactImageByAlphabet(g)))}return c};a.getContactImageByAlphabet=function(b){if("undefined"===typeof b||""===b)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';
b=b.charAt(0);return b.match(/^[a-zA-Z]+$/)?(b=b.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+b+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+b+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};a.getNameTextClassByAlphabet=function(b){if("undefined"===typeof b||""===b)return"mck-text-user";b=b.toString();b=b.charAt(0);return b.match(/^[a-zA-Z]+$/)?(b=b.toLowerCase(),"mck-text-"+b):"mck-text-user"};
a.addContactsFromMessageList=function(k,g){var d;H.removeClass("vis").addClass("n-vis");if("null"===k+"")d="";else if(sb.removeClass("vis").addClass("n-vis"),0==z.has(b("#mck-contact-list")).length&&z.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof k.message.length?(k.message.groupId?mckGroupService.addGroupFromMessage(k.message,!1,function(b,k,g){a.updateRecentConversationList(b,k,g)}):a.addContactsFromMessage(k.message),
d=k.message.createdAtTime):b.each(k.message,function(b,k){"undefined"!==typeof k.to&&(k.groupId?mckGroupService.addGroupFromMessage(k,!0,function(b,k,g){a.updateRecentConversationList(b,k,g)}):a.addContactsFromMessage(k,!0),d=k.createdAtTime)}),z.data("datetime",d),g.isReload){var c="";g.lastActiveTabId&&(c=g.isLastActiveTabGroup?"group-"+g.lastActiveTabId:"user-"+mckContactUtils.formatContactId(g.lastActiveTabId),c=b("#li-"+c));0<c.length?z.animate({scrollTop:c.offset().top-z.offset().top+z.scrollTop()},
"fast"):z.animate({scrollTop:0},0)}};a.addGroupFromMessageList=function(k,g){"null"!==k+""&&(g&&z.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof k.message.length?mckGroupService.addGroupFromMessage(k.message,!1,function(b,k,g){a.updateRecentConversationList(b,k,g)}):b.each(k.message,function(b,k){"undefined"!==typeof k.to&&mckGroupService.addGroupFromMessage(k,!0,function(b,k,g){a.updateRecentConversationList(b,
k,g)})}))};a.createContact=function(b){var g=a.getContactDisplayName(b);"undefined"===typeof g&&(g=b);g={contactId:b,htmlId:mckContactUtils.formatContactId(b),displayName:g,name:g+" \x3c"+b+"\x3e [Main]",value:b,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return Fa[b]=g};a.createContactWithDetail=function(b){var g=b.displayName,d=b.userId;g||(g=a.getContactDisplayName(d));"undefined"===typeof g?g=d:ma[d]=g;var c=b.photoLink?b.photoLink:"";c||(c=b.imageLink?b.imageLink:"");
b=b.imageData?b.imageData:"";g={contactId:d,htmlId:mckContactUtils.formatContactId(d),displayName:g,name:g+" \x3c"+d+"\x3e [Main]",value:d,photoLink:"",photoSrc:c,photoData:b,email:"",unsaved:!0,isGroup:!1};return Fa[d]=g};a.updateContactDetail=function(b,g){var d=g.displayName,c=g.userId;b.displayName&&b.displayName!==b.contactId||(d||(d=a.getContactDisplayName(c)),"undefined"===typeof d?d=c:ma[c]=d,b.displayName=d);(d=g.photoLink)||(d=g.imageLink?g.imageLink:"");d&&!b.photoSrc&&(b.photoSrc=d);(d=
g.imageData?g.imageData:"")&&!b.photoData&&(b.photoData=d);return Fa[c]=b};a.addContactsFromMessage=function(b,g){var d=a.getUserIdFromMessage(b);if(0<d.length&&d[0])for(var c=0;c<d.length;c++){var e=a.fetchContact(""+d[c]);a.updateRecentConversationList(e,b,g)}};a.updateRecentConversationList=function(k,g,d){0<b("#mck-contact-list #li-"+(k.isGroup?"group-"+k.htmlId:"user-"+k.htmlId)).length?(b("#mck-contact-list #li-"+k.htmlId+" .mck-cont-msg-wrapper").is(":empty")||d)&&void 0!==g&&a.updateContact(k,
g,"mck-contact-list"):a.addContact(k,"mck-contact-list",g)};a.addContactsToSearchList=function(k){var g=[],d=[],c=[];b.each(La,function(b,a){d.push(a.contactId);"string"!==typeof M[a.contactId]&&c.push(a.contactId)});Z.getUsersDetail(c,{async:!1});var e=d.filter(function(b,a){return d.indexOf(b)===a});e.sort();Na.removeClass("vis").addClass("n-vis");0<e.length?b.each(e,function(d,c){if(c){var e=a.fetchContact(""+c);g.push(e);0===b("#li-cs-user-"+e.htmlId).length&&a.addContactForSearchList(e,"mck-contact-search-list",
k)}}):W.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:g,$searchId:ba,isContactSearch:!0})};a.initAutoSuggest=function(g){for(var c=g.contactsArray,e=g.$searchId,h=[],B,f={},w=[],l=0;l<c.length;l++){var p=c[l];p.displayName=a.getTabDisplayName(p.contactId,p.isGroup);B=p.displayName?b.trim(p.displayName):b.trim(p.contactId);if(!0===Ga&&p.contactId!==D||!0!==Ga)f[B]=p,h.push(B),w.push(B)}c=function(b){b=f[b];var a=b.displayName.split(" "),g=a.length,k=a[0],d="",c="";2===g?c=a[1]:
3<=g&&(c=a[g-1],d=a[g-2]);a=RegExp(this.query,"i");return a.test(b.displayName)||a.test(b.contactId)||a.test(d)||a.test(c)||a.test(b.email)||a.test(k+" "+c)};B=function(b){return f[b].displayName};w=function(b){b=f[b];g.isContactSearch?(d.loadTab({tabId:b.contactId,isGroup:b.isGroup}),eb.removeClass("n-vis").addClass("vis")):t.addGroupMemberFromSearch(b.contactId)};e.hasClass("mck-typeahead")?(e.mcktypeahead().data("mcktypeahead").source=h,e.mcktypeahead().data("mcktypeahead").matcher=c,e.mcktypeahead().data("mcktypeahead").highlighter=
B,e.mcktypeahead().data("mcktypeahead").updater=w):(e.addClass("mck-typeahead"),e.mcktypeahead({source:h,matcher:c,highlighter:B,updater:w}))};a.initSearchAutoType=function(){ic&&(ba.keypress(function(b){13===b.which&&((b=ba.val())&&(!0===Ga&&b!==D||!0!==Ga)&&(b="undefined"!==typeof b&&""!==b?b.toString():"")&&(d.loadTab({tabId:b,isGroup:!1,isSearch:!0}),eb.removeClass("n-vis").addClass("vis")),ba.val(""))}),pa.keypress(function(b){if(13===b.which)return!0}),b(s).on("click",".mck-group-search-link",
function(b){b.preventDefault();return!0}),b(s).on("click",".mck-contact-search-link",function(b){b.preventDefault();b=ba.val();""!==b&&(!0===Ga&&b!==D||!0!==Ga)&&(d.loadTab({tabId:b,isGroup:!1,isSearch:!0}),eb.removeClass("n-vis").addClass("vis"));ba.val("")}))};a.removeContact=function(a){b("#li-"+(a.isGroup?"group-"+a.htmlId:"user-"+a.htmlId)).remove()};a.updateContact=function(g,d,c){var e=g.isGroup?"group-"+g.htmlId:"user-"+g.htmlId,h=b("#li-"+e),B=h.data("msg-time");if(d&&d.createdAtTime>B){B=
a.getUnreadCount(d.groupId?"group_"+g.contactId:"user_"+g.contactId);g=a.getMessageTextForContactPreview(d,g,15);b("#li-"+e+" .mck-cont-msg-date").html("undefined"===typeof d.createdAtTime?"":mckDateUtils.getTimeOrDate(d?d.createdAtTime:"",!0));var f=b("#li-"+e+" .mck-cont-msg-wrapper");f.html("");"object"===typeof g?f.append(g):f.html(g);d.conversationId&&(g=d.conversationId,f=V[g],"object"===typeof f&&(f=f.topicId)&&Ca&&(f=T[f],"object"===typeof f&&b("#li-"+e+" .mck-conversation-topic").html(f.title)),
b("#li-"+e+" a").data("mck-conversationid",g));0<B&&(b("#li-"+e+" .mck-unread-count-text").html(B),b("#li-"+e+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));e=b("#"+c+" li:nth-child(1)").data("msg-time");h.data("msg-time",d.createdAtTime);("undefined"===typeof e||(d?d.createdAtTime:"")>=e)&&0!==b("#mck-contact-list li").index(h)&&b("#"+c+" li:nth-child(1)").before(h)}};a.clearContactMessageData=function(a,g){var d=mckContactUtils.formatContactId(a),d=g?"group-"+d:"user-"+d;b("#li-"+
d+" .mck-cont-msg-date").html("");b("#li-"+d+" .mck-cont-msg-wrapper").html("")};a.addContact=function(g,c,e){var h=a.getMessageTextForContactPreview(e,g,100),B=g.userCount,f="",w=!1;if("undefined"!==typeof e){if(e.conversationId)var f=e.conversationId,l=V[f];e.groupId&&(w=!0)}var p=a.getTabDisplayName(g.contactId,w),n=a.getContactImageLink(g,p),C=!1,ua=a.getUnreadCount(w?"group_"+g.contactId:"user_"+g.contactId),u=0<ua&&"mck-search-list"!==c?"vis":"n-vis",z="n-vis",q=w?"group-"+g.htmlId:"user-"+
g.htmlId,K=w&&Lb;b("#li-"+q+" .mck-group-count-text").html(B);b("#li-"+q+" .mck-group-count-box").removeClass("n-vis").addClass("vis");w||ia[g.contactId]||xa[g.contactId]||!kb||!r.MCK_OL_MAP[g.contactId]||(z="vis",C=!0);if(7===g.type&&1<g.members.length){var Ra,q=mckGroupUtils.getGroup(e.groupId);mckGroupService.getContactFromGroupOfTwo(q,function(b){Ra=d.fetchContact(b)});w&&kb&&r.MCK_OL_MAP[Ra.contactId]&&(z="vis",C=!0)}B="n-vis";if("object"===typeof l&&Ca&&(q=T[l.topicId],"object"===typeof q))var B=
"vis",m=q.title;q=w?"group-"+g.htmlId:"user-"+g.htmlId;g=[{contHtmlExpr:q,contIdExpr:g.contactId,contTabExpr:w,msgCreatedAtTimeExpr:e?e.createdAtTime:"",mckLauncherExpr:Ta,contImgExpr:n,contOlExpr:z,onlineLabel:MCK_LABELS.online,contUnreadExpr:u,contUnreadCount:ua,contNameExpr:p,conversationExpr:f,contHeaderExpr:B,titleExpr:m,groupUserCountExpr:w?g.userCount:"",displayGroupUserCountExpr:K?"vis":"n-vis",msgCreatedDateExpr:e?mckDateUtils.getTimeOrDate(e.createdAtTime,!0):""}];f=b("#"+c+" li:nth-child(1)").data("msg-time");
"undefined"===typeof f||(e?e.createdAtTime:"")>=f||-1!==c.indexOf("search")&&C?b.tmpl("contactTemplate",g).prependTo("#"+c):b.tmpl("contactTemplate",g).appendTo("#"+c);c=b("#li-"+q+" .msgTextExpr");"object"===typeof h?c.append(h):c.html(h)};a.addContactsToContactSearchList=function(){W.removeClass("vis").addClass("n-vis");bb.removeClass("vis").addClass("n-vis");ca.hasClass("active")||(Ba.removeClass("active"),ca.addClass("active"));ga.removeClass("vis").addClass("n-vis");fa.removeClass("n-vis").addClass("vis");
qb.removeClass("vis").addClass("n-vis");ob.removeClass("n-vis").addClass("vis");fa.html("");ja.removeClass("vis").addClass("n-vis");B.removeClass("vis").addClass("n-vis");S.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");ea.removeClass("n-vis").addClass("vis");Na.removeClass("n-vis").addClass("vis");0!==La.length?d.addContactsToSearchList():lb?(Na.removeClass("vis").addClass("n-vis"),W.removeClass("n-vis").addClass("vis")):Z.loadContacts();ba.focus()};a.addGroupsToGroupSearchList=
function(){var g=[],d=[];W.removeClass("vis").addClass("n-vis");bb.removeClass("vis").addClass("n-vis");da.hasClass("active")||(Ba.removeClass("active"),da.addClass("active"));fa.removeClass("vis").addClass("n-vis");ga.removeClass("n-vis").addClass("vis");ob.removeClass("vis").addClass("n-vis");qb.removeClass("n-vis").addClass("vis");ga.html("");ja.removeClass("vis").addClass("n-vis");B.removeClass("vis").addClass("n-vis");S.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");
ea.removeClass("n-vis").addClass("vis");Na.removeClass("n-vis").addClass("vis");if(0<Qa.length){b.each(Qa,function(b,a){d.push(a.contactId)});var c=d.filter(function(b,a){return d.indexOf(b)===a});c.sort();b.each(c,function(d,c){if(c){var e=mckGroupUtils.getGroup(""+c);g.push(e);0===b("#li-gs-group-"+e.htmlId).length&&a.addContactForSearchList(e,"mck-group-search-list")}})}else bb.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:g,$searchId:pa,isContactSearch:!0});Na.removeClass("vis").addClass("n-vis")};
a.addConversationMenu=function(a,g){var d=z.data("mck-id");Wa.html("");a===d&&(d=ta[a],"undefined"===typeof d||0===d.length||1===d.length?(ra.addClass("n-vis"),h.addClass("mck-product-box-wc"),Wa.addClass("n-vis")):(Wa.removeClass("n-vis"),ra.removeClass("n-vis"),h.removeClass("mck-product-box-wc"),b.each(d,function(d,c){if(0===b("#mck-conversation-list #li-"+c.id).length){var e="";c.topicDetail&&(e=b.parseJSON(c.topicDetail),e="object"===typeof e?e.title:c.topicDetail);e||(e=c.topicId);b.tmpl("convTemplate",
[{convIdExpr:c.id,tabIdExpr:a,isGroupExpr:g,topicIdExpr:c.topicId,convTitleExpr:e,mckLauncherExpr:Ta}]).appendTo(Wa)}}),2>b("#mck-conversation-list li").length&&(ra.addClass("n-vis"),h.addClass("mck-product-box-wc"),Wa.addClass("n-vis"))))};a.loadContacts=function(g){"null"!==g+""&&"undefined"!==typeof g&&"undefined"!==typeof g.contacts&&0!==g.contacts.length&&(La.length=0,Ia.length=0,b.each(g.contacts,function(b,g){if("undefined"!==typeof g.userId){var d=a.getContact(""+g.userId),d="undefined"===
typeof d?a.createContactWithDetail(g):a.updateContactDetail(d,g);La.push(d);Ia.push(d.contactId)}}))};a.loadContactsForContactList=function(b){var a=b.startIndex?b.startIndex:"0",g=b.pageSize?b.pageSize:"50",d=MCK_BASE_URL+"/rest/ws/user/filter?pageSize\x3d"+g+"\x26orderBy\x3d1\x26startTime\x3d"+a,a=MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d"+a+"\x26pageSize\x3d"+g+"\x26orderBy\x3d1";N.ajax({url:b.startIndex?d:a,type:"get",global:!1,success:function(b){console.log(b)},error:function(){r.console.log("Unable to load contacts. Please reload page.")}})};
a.getStatusIcon=function(b){return'\x3cspan class\x3d"'+a.getStatusIconName(b)+" move-right "+b.key+'_status status-icon"\x3e\x3c/span\x3e'};a.getStatusIconName=function(b){return 7===b.type||6===b.type||4===b.type||0===b.type?"":5===b.status?"mck-icon-read":4===b.status?"mck-icon-delivered":3===b.type||5===b.type||1===b.type&&(0===b.source||1===b.source)?"mck-icon-sent":""};a.clearMessageField=function(b){x.html("");u.attr("disabled",!1);O.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required",
"").html("");b?x.focus().select():(f.blur(),x.blur())};a.addDraftMessage=function(a){F=[];a&&"object"===typeof Ha[a]?(a=Ha[a],x.html(a.text),0<a.files.length&&(b.each(a.files,function(b,a){rb.addFileBox(a)}),q.html(a.filelb),m.html(a.filesize),O.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):F=[]};a.showOfflineMessage=function(){"object"===typeof la&&la.innerHTML?(Rb.html(la.innerHTML),Rb.removeClass("n-vis").addClass("vis")):r.console.log("Offline message innerHTML required.")};
a.hideOfflineMessage=function(){Va.stopOfflineMessageCounter();Rb.removeClass("vis").addClass("n-vis")};a.removeConversationThread=function(a,g){ALStorage.clearMckMessageArray();var c=g?mckGroupUtils.getGroup(a):d.getContact(a),e=z.data("mck-id"),h=z.data("isgroup");"undefined"===typeof e||""===e?(c="undefined"!==typeof c?c.htmlId:mckContactUtils.formatContactId(a),b("#li-"+(g?"group-"+c:"user-"+c)).remove()):e===a&&h===g&&(w.data("datetime",""),H.removeClass("n-vis").addClass("vis"),Q.removeClass("n-vis").addClass("vis"),
Sa.removeClass("vis").addClass("n-vis"))};a.removedDeletedMessage=function(a,g,d){ALStorage.clearMckMessageArray();a=b("."+a);0<a.length?(a.remove(),z.is(":empty")&&(Q.removeClass("n-vis").addClass("vis"),Sa.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof g&&0<b("#mck-contact-list").length&&y.updateContactList(g,d)};a.getMessageTextForContactPreview=function(b,a,g){var c="";if("undefined"!==typeof b){if(b.message)if(2===b.contentType)c='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';
else{c=b.message;if(N.startsWith(c,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==r.emoji&&"undefined"!==typeof r.emoji&&(c=r.emoji.replace_unified(c),c=r.emoji.replace_colons(c),c=-1!==c.indexOf("\x3c/span\x3e")?c.substring(0,c.lastIndexOf("\x3c/span\x3e")):c.substring(0,g));a.isGroup||-1!==c.indexOf("emoji-inner")||0!==b.contentType||(g=s.createElement("p"),g.appendChild(s.createTextNode(c)),c=g)}else b.fileMetaKey&&"object"===
typeof b.fileMeta&&(c=E.getFileIcon(b));a.isGroup&&3!==a.type&&7!==a.type&&(a=b.to.split(",")[0]===D?"Me":d.getTabDisplayName(b.to.split(",")[0],!1),10!==b.contentType&&(c=a+": "+c),-1===c.indexOf("emoji-inner")&&b&&b.message&&0===b.contentType&&(g=s.createElement("p"),g.appendChild(s.createTextNode(c)),c=g))}return c};a.getTextForMessagePreview=function(a,g){var c="";if("undefined"!==typeof a){if(2===a.contentType)c="Shared location";else if(a.message)if(c=a.message,N.startsWith(c,"\x3cimg"))c="Image attachment";
else{var e=s.createElement("div");e.innerHTML=c;c=b.trim(N.textVal(e));c=c.substring(0,50)}else a.fileMetaKey&&"object"===typeof a.fileMeta&&(c=-1!==a.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");g.isGroup&&3!==g.type&&7!==g.type&&(c=(a.to.split(",")[0]===D?"Me":d.getTabDisplayName(a.to.split(",")[0],!1))+": "+c)}return c};a.getUserIdFromMessage=function(b){b=b.to;b.lastIndexOf(",")===b.length-1&&(b=b.substring(0,b.length-1));return b.split(",")};a.getUserIdArrayFromMessageList=
function(g){var c=[];"undefined"===typeof g.length?c.concat(a.getUserIdFromMessage(g)):b.each(g,function(b,g){"undefined"!==typeof g.to&&(c=c.concat(a.getUserIdFromMessage(g)))});return c};a.messageContextMenu=function(a){var g=b("."+a+" .mck-msg-box");g.addEventListener?g.addEventListener("contextmenu",function(b){b.preventDefault()},!1):g.bind("contextmenu",function(g){g.preventDefault();b(".mck-context-menu").removeClass("vis").addClass("n-vis");b("."+a+" .mck-context-menu").removeClass("n-vis").addClass("vis");
r.event.returnValue=!1})};a.isValidMetaData=function(b){return b.metadata?"HIDDEN"===b.metadata.category||"ARCHIVE"===b.metadata.category?!1:!0:!0};a.updateDraftMessage=function(a,g){if("object"===typeof g){var c={text:"",files:[]},d={fileMeta:g,filelb:E.getFilePreviewPath(g),filesize:E.getFilePreviewSize(g.size)};"undefined"!==typeof a&&"object"===typeof Ha[a]&&(c=Ha[a],b.each(c.files,function(b,a){a.filelb===d.filelb&&c.files.splice(b,1)}));c.files.push(d)}Ha[a]=c};a.updateUnreadCount=function(b,
g,c){var d=a.getUnreadCount(b);Da[b]=g;if(c||0<oa.length)J+=g-d,0>J&&(J=0),0<J?oa.html(J):oa.html("");c&&N.badgeCountOnLaucher(Kb,J)};a.incrementUnreadCount=function(b){J+=1;Da[b]="undefined"===typeof Da[b]?1:Da[b]+1;0<oa.length&&oa.html(J);N.badgeCountOnLaucher(Kb,J)};a.getUnreadCount=function(b){return"undefined"===typeof Da[b]?Da[b]=0:Da[b]};a.isGroupDeleted=function(b,a){if(a){var g=t.getDeletedAtTime(b);return"undefined"!==typeof g&&0<g}return!1};a.getTabDisplayName=function(b,g,c){var d="";
if(g)return mckGroupService.getGroupDisplayName(b);"function"===typeof Gb&&(d=Gb(b));"undefined"!==typeof c&&c&&(d=c,ma[b]=c);d||(d=a.getContactDisplayName(b));g=a.fetchContact(""+b);d?(g.displayName=d,Fa[g.contactId]=g):"undefined"!==typeof g.displayName&&(d=g.displayName);d||(d=b);return d};a.populateMessage=function(g,c,e){var h=mckDateUtils.convertMilisIntoTime(c.metadata.CALL_DURATION);na.loadUserProfile(c.to);103==c.contentType&&(4==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message="you rejected a Video call from "+
c.to:5==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message=c.to+"rejected a Video call from you":4==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+c.to+"\n call duration : "+h:5==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+c.to+"\n call duration : "+h:4==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE?c.message="you missed a Video call from "+c.to:5==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE&&(c.message=c.to+"missed a Video call from you"));
var B=z.data("mck-id"),f=d.isValidMetaData(c),h=c.groupId?mckGroupUtils.getGroup(c.groupId):d.getContact(c.to);if("undefined"===typeof B||""===B){var w=b("#mck-contact-list").length;0<w&&f?c.groupId?mckGroupService.addGroupFromMessage(c,!0,function(b,g,c){a.updateRecentConversationList(b,g,c)}):d.addContactsFromMessage(c,!0):d.addContactsFromMessageList({message:[c]},"");if("APPLOZIC_01"===g||"MESSAGE_RECEIVED"===g){"undefined"===typeof h&&(h=c.groupId?mckGroupUtils.createGroup(c.groupId):d.createContact(c.to));
if(mb){d.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}g=c.groupId?"group_"+h.contactId:"user_"+h.contactId;f&&(10!==c.contentType&&102!==c.contentType&&d.incrementUnreadCount(g),nb.notifyUser(c));e=c.groupId?"group-"+h.htmlId:"user-"+h.htmlId;b("#li-"+e+" .mck-unread-count-text").html(d.getUnreadCount(g));0<d.getUnreadCount(g)&&b("#li-"+e+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");y.sendDeliveryUpdate(c)}}else if("undefined"===typeof h&&
(h=c.groupId?mckGroupUtils.createGroup(c.groupId):d.createContact(c.to)),"APPLOZIC_01"===g||"MESSAGE_RECEIVED"===g){if("undefined"!==typeof h&&(g=z.data("isgroup"),("undefined"===typeof c.oldKey||0===b("."+c.oldKey).length)&&0===b("."+c.key).length||10===c.contentType)){if("undefined"===typeof B||B!==h.contactId||g!==h.isGroup||S.hasClass("vis")){if(mb){d.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}if(f&&10!==c.contentType||102!==c.contentType)g=c.groupId?
"group_"+h.contactId:"user_"+h.contactId,d.incrementUnreadCount(g);y.sendDeliveryUpdate(c)}else{f=!0;g&&6===h.type&&(f=mckGroupService.isAppendOpenGroupContextMenu(h));if(c.conversationId&&(Ca||Ka))if((g=z.data("mck-conversationid"))&&g.toString()===c.conversationId.toString())c.metadata&&"HIDDEN"===c.metadata.category||d.addMessage(c,h,!0,!0,f),y.sendReadUpdate(c.pairedMessageKey);else{if(mb){d.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}}else{var l;7===
h.type&&(g=mckGroupUtils.getGroup(c.groupId),mckGroupService.getContactFromGroupOfTwo(g,function(b){l=d.fetchContact(b)}),qa.lastSeenOfGroupOfTwo(l.contactId),d.addMessage(c,h,!0,!0,f));(!c.metadata||"HIDDEN"!==c.metadata.category&&7!==h.type)&&d.addMessage(c,h,!0,!0,f);y.sendReadUpdate(c.pairedMessageKey)}c.groupId||(b("#mck-tab-status").html(MCK_LABELS.online),na.updateUserStatus({userId:c.to,status:1},function(b){Z.getUsersDetail(b,{})}))}e&&6!==h.type&&nb.notifyUser(c)}}else"APPLOZIC_02"!==g||
102!=!c.contentType||("undefined"!==typeof c.oldKey&&0!==b("."+c.oldKey).length||0!==b("."+c.key).length)&&10!==c.contentType||(0<w?d.addContactsFromMessage(c,!0):"undefined"!==typeof h&&(g=z.data("isgroup"),"undefined"!==typeof B&&B===h.contactId&&g===h.isGroup&&(f=!0,g&&6===h.type&&(f=mckGroupService.isAppendOpenGroupContextMenu(h)),c.metadata&&"HIDDEN"===c.metadata.category||d.addMessage(c,h,!0,!0,f),3===c.type&&(b("."+c.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),
d.addTooltip(c.key)))));Qb.removeClass("vis").addClass("n-vis")};a.getMessageFeed=function(a){var g={};g.key=a.key;g.timeStamp=a.createdAtTime;g.message=a.message;g.from=4===a.type?a.to:D;g.to=a.groupId?a.groupId:5===a.type?a.to:D;g.status="read";g.type=4===a.type?"inbox":"outbox";5===a.type&&(3===a.status?g.status="sent":4===a.status&&(g.status="delivered"));if("object"===typeof a.fileMeta){var c=b.extend({},a.fileMeta);if("undefined"===typeof c.url||""===c.url)c.url=hb+"/rest/ws/aws/file/"+a.fileMeta.blobKey;
delete c.blobKey;g.file=c}g.source=a.source;g.metadata=a.metadata;return g};a.updateUnreadCountonChatIcon=function(a){if(Mb&&0<a.length){var g=null,c=0;0<a.length&&(b.each(a,function(b,a){!(0<a.unreadCount&&null!==g)&&0<a.unreadCount&&(g=a.userId,c=a.unreadCount)}),0<J&&"none"===v.css("display")&&(null!==g&&c===J?d.loadTab({tabId:g,isGroup:!1}):d.loadTab({tabId:"",isGroup:!1})))}};a.loadMessageListOnUserDetailFetch=function(a){Qb.removeClass("vis").addClass("n-vis");var g=z.data("mck-id"),c=z.data("isgroup");
if("undefined"===typeof g||a.tabId===g&&""+c===""+a.isGroup)g=mckGroupUtils.getGroup(a.tabId),t.addGroupStatus(g),c=6===g.type?!1:!0,c=!0,6===g.type&&(t.validateOpenGroupUser(g),c=mckGroupService.isAppendOpenGroupContextMenu(g)),a.isMessages?(H.removeClass("vis").addClass("n-vis"),d.processMessageList(a.messageData,!0,c),6!==g.type&&Sa.removeClass("n-vis").addClass("vis"),"function"===typeof Oa&&Oa(a.tabId)):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(Sa.removeClass("vis").addClass("n-vis"),
H.removeClass("n-vis").addClass("vis"))}},G=new function(){var a=this,c=b("#mck-search"),f=b("#mck-msg-to"),l=b("#mck-msg-new");b("#mck-audio");b("#mck-mike-btn");var q=b("#mck-sidebox"),m=b("#mck-file-box"),v=b("#mck-text-box"),O=b("#mck-msg-form"),u=b("#mck-msg-sbmt"),A=b("#mck-new-group"),x=b("#mck-tab-title"),R=b("#mck-msg-error"),E=b("#mck-btn-attach"),J=b("#mck-tab-status"),Q=b("#mck-message-cell"),I=b(".mck-typing-box"),H=b("#mck-gms-loading"),h=b("#mck-group-title"),K=b("#mck-contact-loading"),
C=b("#mck-no-messages"),n=b(".mck-group-search"),ra=b("#mck-msg-response"),$a=b("#mck-msg-form input"),X=b("#mck-block-button"),S=b("#li-mck-block-user"),aa=b("#li-mck-group-info"),da=b("#li-mck-video-call"),Ea=b("#mck_response_text"),fa=b(".mck-contact-search"),W=b("#mck-group-info-tab"),ha=b("#mck-price-text-box");b("#mck-sidebox-search");var ka=b("#mck-group-info-btn"),W=b("#mck-group-info-tab"),la=b("#mck-btn-group-exit"),P=b("#mck-group-back-link"),pa=b("#mck-btn-leave-group"),ca=b(".mck-sidebox-content"),
ma=b("#mck-no-more-messages"),sa=b("#mck-btn-group-create");b("#mck-group-create-tab");var Da=b("#mck-group-add-member");b("#mck-contacts-content");var ba=b("#mck-tab-option-panel"),va=b("#mck-no-conversations"),Fa=b("#mck-group-create-title"),ya=b(".mck-group-menu-options"),ea=b(".mck-tab-message-option"),Aa=b(".mck-group-admin-options"),oa=b("#mck-group-member-search"),p=b("#mck-message-cell .mck-message-inner");b("#mck-search-cell .mck-message-inner");var za=b("#mck-no-more-conversations"),Ga=
b("#mck-gm-search-box"),Pa=b("#mck-group-member-search-list"),Qa=b("#mck-no-gsm-text");b.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');var Na,cb=b("#mck-minutes"),db=b("#mck-seconds");a.timer=function(){var b=0,a=this;Na=setInterval(function(){++b;db.html(a.pad(b%60));cb.html(a.pad(parseInt(b/60)))},
1E3);a.pad=function(b){b+="";return 2>b.length?"0"+b:b}};a.stoptimer=function(){db.html("0");cb.html("0");clearInterval(Na)};b(s).on("click",".mck-message-delete",function(){a.deleteMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(s).on("click",".mck-message-reply",function(){a.replyMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(s).on("click",".mck-message-forward",function(){l.data("forwardMessageKey",b(this).parents(".mck-m-b").data("msgkey"));l.trigger("click")});b(".mck-minimize-icon").click(function(){b(".mck-box-md,.mck-box-ft").animate({height:"toggle"});
ca.hasClass("minimized")?(ca.css("height","100%"),ca.removeClass("minimized")):(ca.css("height","0%"),ca.addClass("minimized"))});a.init=function(){ALStorage.clearMckMessageArray();b(s).on("click","."+Ta,function(){b(this).hasClass("mck-msg-preview")&&b(this).hide()});d.initSearchAutoType();fa.click(function(){d.addContactsToContactSearchList()});n.click(function(){d.addGroupsToGroupSearchList()});v.keydown(function(b){v.hasClass("mck-text-req")&&v.removeClass("mck-text-req");if(13===b.keyCode&&(b.shiftKey||
b.ctrlKey)){if(b.preventDefault(),r.getSelection){b=r.getSelection();var a=b.getRangeAt(0),c=s.createElement("br"),d=s.createTextNode("\u00a0");a.deleteContents();a.insertNode(c);a.collapse(!1);a.insertNode(d);a.selectNodeContents(d);b.removeAllRanges();b.addRange(a);v.animate({scrollTop:v.prop("scrollHeight")},0);return!1}}else 13===b.keyCode?(b.preventDefault(),1===ga&&Y.sendTypingStatus(0,p.data("mck-id")),u.is(":disabled")&&m.hasClass("vis")?alert("Please wait file is uploading."):O.submit()):
0===ga&&Y.sendTypingStatus(1,p.data("mck-id"))});b(s).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&G.deleteConversation()});b(s).on("click",".applozic-tm-launcher",function(a){a.preventDefault();var c=b(this).data("mck-id"),c="undefined"!==typeof c&&""!==c?c.toString():"",e=b(this).data("mck-name"),e="undefined"!==typeof e&&""!==e?e.toString():"";a=b(this).data("mck-supportid");a="undefined"!==typeof a&&""!==a?a.toString():"";var h=b(this).data("mck-topicid"),
h="undefined"!==typeof h&&""!==h?h.toString():"",f=b(this).data("mck-msg"),f="undefined"!==typeof f&&""!==f?f.toString():"";if("function"===typeof Ba&&h){var l=Ba(h);"object"===typeof l&&"undefined"!==l.title&&(T[h]=l)}c={topicId:h,tabId:c,userName:e,isMessage:!0};c.messagePxy={type:5,contentType:0,message:f};a?(c.isGroup=!0,c.supportId=a,G.getConversationId(c)):(c.isGroup=!1,d.loadTab(c,y.dispatchMessage))});b(s).on("click",".applozic-wt-launcher",function(a){a.preventDefault();a=b(this).data("mck-id");
a="undefined"!==typeof a&&""!==a?a.toString():"";var c=b(this).data("mck-name"),c="undefined"!==typeof c&&""!==c?c.toString():"",d=b(this).data("mck-topicid"),d="undefined"!==typeof d&&""!==d?d.toString():"",e=b(this).data("mck-topic-status"),e=e?-1===L.indexOf(e)?L[0]:e.toString():L[0];if("function"===typeof Ba){var h=Ba(d);"object"===typeof h&&"undefined"!==h.title&&(T[d]=h)}G.getConversationId({tabId:a,isGroup:!1,userName:c,topicId:d,topicStatus:e,isMessage:!1})});b(s).on("click",".applozic-ct-launcher",
function(a){a.preventDefault();var c=b(this).data("mck-id"),c="undefined"!==typeof c&&""!==c?c.toString():"",d=b(this).data("mck-name"),d="undefined"!==typeof d&&""!==d?d.toString():"";a=b(this).data("mck-topicid");a="undefined"!==typeof a&&""!==a?a.toString():"";var e=b(this).data("mck-topic-status"),e=e?-1===L.indexOf(e)?L[0]:e.toString():L[0],c={tabId:c,isGroup:!1,userName:d,topicId:a,topicStatus:e,isMessage:!1};"function"===typeof Jb&&(d=Jb(a),"object"===typeof d&&(d.topicDetail&&"object"===typeof d.topicDetail&&
"undefined"!==d.topicDetail.title&&(T[a]=d.topicDetail),d.fallBackTemplatesList&&0<d.fallBackTemplatesList.length&&(c.fallBackTemplatesList=d.fallBackTemplatesList)));G.getConversationId(c)});b(s).on("click","."+Ta+", .mck-contact-list ."+Ta,function(g){g.preventDefault();var d=this;b(this).parents(".mck-search-list").length?(c.bind("blur"),setTimeout(function(){a.openChat(d)},600)):a.openChat(this)});b(s).on("click",".mck-conversation-tab-link",function(a){a.preventDefault();b(this);a=p.data("mck-id");
var c=p.data("isgroup");d.loadTab({tabId:"",isGroup:!1,lastActiveTabId:a,isLastActiveTabGroup:c})});b(s).on("click",".mck-close-sidebox",function(b){b.preventDefault();q.mckModal("hide");b=p.data("mck-conversationid");p.data("mck-id","");p.data("mck-topicid","");p.data("mck-name","");p.data("mck-conversationid","");b&&(b=V[b],"object"===typeof b&&(b=b.topicId,"function"===typeof Db&&Db(D,b)));Y.unsubscibeToTypingChannel()});b(s).on("click",".mck-price-submit",function(b){b.preventDefault();a.sendPriceMessage()});
ha.keydown(function(b){13===b.keyCode&&a.sendPriceMessage()});p.bind("scroll",function(){if(0<p.find(".mck-contact-list").length){if(p.scrollTop()+p.innerHeight()>=p[0].scrollHeight){var b=p.data("datetime");0<b&&!wa&&G.loadMessageList({tabId:"",isGroup:!1,startTime:b})}}else if(0===p.scrollTop()){var a=p.data("mck-id");if("undefined"!==typeof a&&""!==a){var c=p.data("isgroup"),d=p.data("mck-conversationid"),d=d?d.toString():"",b=ba.data("datetime");0<b&&!wa&&G.loadMessageList({tabId:a,isGroup:c,
conversationId:d,startTime:b})}}});ha.on("click",function(b){b.preventDefault();ha.removeClass("mck-text-req")});X.on("click",function(b){b.preventDefault();b=p.data("mck-id");var a=p.data("isgroup"),c=!p.data("blocked");a?(S.removeClass("vis").addClass("n-vis"),da.removeClass("vis").addClass("n-vis")):confirm(c?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&na.blockUser(b,c,function(b){qa.toggleBlockUser(b,c)})});pa.on("click",function(b){b.preventDefault();b=p.data("mck-id");
p.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({apzCallback:t.onGroupLeft,groupId:b}):ya.removeClass("vis").addClass("n-vis")});b(s).on("click",".mck-add-to-group",function(a){a.preventDefault();a=b(this).data("mck-id");"undefined"!==typeof a&&t.addGroupMemberFromSearch(a);Ga.mckModal("hide")});b(s).on("click",".mck-btn-remove-member",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").data("mck-id");var c=W.data("mck-id");if("undefined"!==
typeof c&&"undefined"!==typeof a){var d=mckGroupUtils.getGroup(c);"object"===typeof d&&D===d.adminName?confirm(MCK_LABELS["remove.member.alert"])&&mckGroupService.removeGroupMemberFromChat({groupId:c,userId:a,apzCallback:t.onRemovedGroupMember}):Aa.removeClass("vis").addClass("n-vis")}});la.on("click",function(b){b.preventDefault();(b=W.data("mck-id"))?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({groupId:b,apzCallback:t.onGroupLeft}):d.loadTab({tabId:"",isGroup:!1})});ka.on("click",
function(b){b.preventDefault();b=p.data("mck-id");if(p.data("isgroup")){b={groupId:b};var a=p.data("mck-conversationid");a&&(b.conversationId=a);t.loadGroupInfo(b)}else ya.removeClass("vis").addClass("n-vis")});A.on("click",function(b){b.preventDefault();t.loadCreateGroupTab()});P.on("click",function(b){b.preventDefault();var a=W.data("mck-id");b=W.data("mck-conversation-id");a?(a={tabId:a,isGroup:!0},b&&(a.conversationId=b),d.loadTab(a)):d.loadTab({tabId:"",isGroup:!1})});Da.on("click",function(a){a.preventDefault();
if(a=W.data("mck-id"))(a=mckGroupUtils.getGroup(a))&&a.adminName===D?(Pa.html(""),Ga.mckModal(),H.removeClass("n-vis").addClass("vis"),0<Ia.length?t.addMembersToGroupSearchList():lb?0<La.length?(b.each(La,function(b,a){Ia.push(a.contactId)}),t.addMembersToGroupSearchList()):(H.removeClass("vis").addClass("n-vis"),Qa.removeClass("n-vis").addClass("vis")):na.getUserStatus({callback:t.addMembersToGroupSearchList},function(a){b.each(a.users,function(b,a){var c=d.getContact(""+a.userId),c="undefined"===
typeof c?d.createContactWithDetail(a):d.updateContactDetail(c,a);Ia.push(c.contactId)})})):Aa.removeClass("vis").addClass("n-vis")});oa.keypress(function(b){if(13===b.which)return b=oa.val(),""!==b&&t.addGroupMemberFromSearch(b),oa.val(""),!0});b(s).on("click",".mck-group-member-search-link",function(b){b.preventDefault();b=oa.val();""!==b&&t.addGroupMemberFromSearch(b);oa.val("")});b(s).on("click",".mck-show-more",function(a){a.preventDefault();var c=b(this);a=c.data("tabId");var d=p.data("isgroup"),
e=p.data("mck-conversationid"),e=e?e.toString():"",c=c.data("datetime");G.loadMessageList({tabId:a,isGroup:d,conversationId:e,startTime:c})});b(s).on("click",".mck-accept",function(a){a=b(this).data("mck-conversationid");var c=b(this).data("mck-topic-price");if("function"===typeof Ja&&c&&a){var e=V[a],h=f.val(),h=mckGroupService.getGroupDisplayName(h);"object"===typeof e?(Ja({custId:D,suppId:h,productId:e.topicId,price:c}),y.sendConversationCloseUpdate(a)):y.getTopicId({conversationId:a,suppId:h,
priceText:c},function(b){d.populateMessage(b.messageType,b.message,b.notifyUser)})}});O.submit(function(){1===ga&&Y.sendTypingStatus(0,p.data("mck-id"));var c=b.trim(N.textVal(v[0]));m.hasClass("n-vis")&&0<F.length&&(F=[]);if(0===c.length&&0===F.length)return v.addClass("mck-text-req"),!1;if("function"===typeof Hb&&!Hb(c))return!1;var c={type:5,contentType:0,message:c},d=p.data("mck-conversationid"),e=p.data("mck-topicid");d?c.conversationId=d:e&&(d={topicId:e},e=T[e],"object"===typeof e&&(d.topicDetail=
r.JSON.stringify(e)),c.conversationPxy=d);!0===p.data("isgroup")?c.groupId=f.val():c.to=f.val();u.attr("disabled",!0);R.removeClass("vis").addClass("n-vis");R.html("");Ea.html("");ra.removeClass("vis").addClass("n-vis");a.sendMessage(c);return!1});$a.on("click",function(){b(this).val("");R.removeClass("vis").addClass("n-vis");ra.removeClass("vis").addClass("n-vis")});b(s).bind("click",function(a){b(".mck-context-menu").removeClass("vis").addClass("n-vis");!E.hasClass("on")||b(a.target).hasClass("mck-icon-upload")||
b(a.target).hasClass("mck-btn-attach")||Nb.fileMenuToggle();v.removeClass("mck-text-req");s.activeElement&&s.activeElement!==v&&1===ga&&Y.sendTypingStatus(0,p.data("mck-id"));s.activeElement&&"mck-group-name-save"!==s.activeElement.id&&h.removeClass("mck-req-border");s.activeElement&&"mck-btn-group-create"!==s.activeElement.id&&Fa.removeClass("mck-req-border");b(".mcktypeahead.mck-dropdown-menu").hide()});b(".mck-tabview-item").click(function(){b(".mck-tabview-item").removeClass("active");b(this).addClass("active")})};
b(".mck-sidebox").on("click","#mck-mike-btn",function(){b(this).removeClass("vis").addClass("n-vis");b(".mck-stop-btn").addClass("vis").removeClass("n-vis");Fr.voice.record(!1,function(){b("#mck-audio").removeClass("n-vis").addClass("vis");G.timer()})});b(".mck-sidebox").on("click","#mck-stop-recording",function(){b("#mck-mike-btn").addClass("vis").removeClass("n-vis");b(".mck-stop-btn").addClass("n-vis").removeClass("vis");b("#mck-audio").removeClass("vis").addClass("n-vis");G.stoptimer();Fr.voice.export(function(a){var c=
{};c.file=a;c.name="blob";b.fn.applozic("audioAttach",c)},"blob");Fr.voice.stop()});a.openChat=function(a){var h=b(a);a=h.data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():"";var f=h.data("mck-name"),f="undefined"!==typeof f&&""!==f?f.toString():"",l=h.data("mck-topicid"),l="undefined"!==typeof l&&""!==l?l.toString():"",p=!0===h.data("isgroup"),h=h.data("mck-conversationid"),h="undefined"!==typeof h&&""!==h?h.toString():"";l&&!h?(h=(h=b(elem).data("mck-topic-status"))?-1===L.indexOf(h)?
L[0]:h.toString():L[0],G.getConversationId({tabId:a,isGroup:p,userName:f,topicId:l,topicStatus:h,isMessage:!1})):d.loadTab({tabId:a,isGroup:p,userName:f,conversationId:h,topicId:l});c.val("")};a.sendMessage=function(c){var e;void 0!==$("#mck-message-cell .mck-message-inner div[name\x3d'message']:last-child").data("msgkey")&&(e=$("#mck-message-cell .mck-message-inner div[name\x3d'message']:last-child").data("msgkey"),e=y.getReplyMessageByKey(e));if("object"===typeof c)if(c.to&&M[c.to]&&(M[c.to].deletedAtTime||
!0===tb))R.html(MCK_LABELS["user.delete"]).removeClass("n-vis").addClass("vis"),b("#mck-tab-status").removeClass("vis").addClass("n-vis"),O.removeClass("vis").addClass("n-vis"),S.removeClass("vis").addClass("n-vis");else{var h=c.metadata?c.metadata:{},f=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof f||""===f||c.forward||(h.AL_REPLY=f);c.metadata=h;if("undefined"!==typeof c.message&&0!==c.message.length||0!==F.length){e&&e.metadata.altype&&(0===e.type||4===e.type||6===e.type)&&(h.altype=
e.metadata.altype);if(c.conversationId&&(e=V[c.conversationId],"undefined"!==e&&e.closed)){d.closeConversation();u.attr("disabled",!1);return}if(p.data("blocked")&&!c.groupId)qa.toggleBlockUser(n,!0),u.attr("disabled",!1);else{var l="";c.groupId?(l=mckGroupUtils.getGroup(c.groupId),"undefined"===typeof l&&(l=mckGroupUtils.createGroup(c.groupId))):l=c.clientGroupId?mckGroupUtils.getGroupByClientGroupId(c.clientGroupId):d.fetchContact(c.to);0<b("#mck-message-cell .mck-no-data-text").length&&b(".mck-no-data-text").remove();
if(c.message&&0===F.length){var h=ea.hasClass("n-vis"),n=p.data("mck-id"),C=N.randomId();c.key=C;12!==c.contentType&&n&&n.toString()===l.contactId&&102!==c.contentType&&y.addMessageToTab(c,l,function(b,a){d.addMessage(b,a,!0,!0,!1)});n={tabId:l.contactId,isTopPanelAdded:h};a.submitMessage(c,n)}else!c.message||0===F.length||1!==c.contentType&&2!==c.contentType?0<F.length&&b.each(F,function(b,e){var h=ea.hasClass("n-vis"),f=p.data("mck-id"),n=N.randomId();c.key=n;c.fileMeta=e;c.contentType=1;12!==c.contentType&&
f&&f.toString()===l.contactId&&y.addMessageToTab(c,l,function(b,a){d.addMessage(b,a,!0,!0,!1)});a.submitMessage(c,{tabId:l.contactId,isTopPanelAdded:h})}):(h=ea.hasClass("n-vis"),n=p.data("mck-id"),C=N.randomId(),c.key=C,e={},c.groupId?e.groupId=c.groupId:e.to=c.to,e.type=c.type,e.key=N.randomId(),e.message=c.message,e.contentType=c.contentType,c.contentType=1,c.fileMeta=F[0],c.message="",12!==c.contentType&&n&&n.toString()===l.contactId&&(y.addMessageToTab(c,l,function(b,a){d.addMessage(b,a,!0,!0,
!1)}),y.addMessageToTab(e,l,function(b,a){d.addMessage(b,a,!0,!0,!1)})),n={tabId:l.contactId,isTopPanelAdded:h},a.submitMessage(c,n),a.submitMessage(e,n));v.removeClass("mck-text-req");u.attr("disabled",!1);b("."+C+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");d.addTooltip(C);d.clearMessageField(!0);F=[];delete Ha[l.contactId]}}else v.addClass("mck-text-req")}};a.sendForwardMessage=function(b){var c=ALStorage.getMessageByKey(b);if("undefined"!==typeof c){c.fileMeta&&
F.push(c.fileMeta);b={type:5,contentType:c.contentType,message:c.message,forward:"forward"};c.metadata&&(c.metadata.AL_REPLY&&(c.metadata.AL_REPLY=""),b.metadata=c.metadata);var d=p.data("mck-conversationid"),c=p.data("mck-topicid");d?b.conversationId=d:c&&(d={topicId:c},c=T[c],"object"===typeof c&&(d.topicDetail=r.JSON.stringify(c)),b.conversationPxy=d);!0===p.data("isgroup")?b.groupId=f.val():b.to=f.val();a.sendMessage(b)}};a.sendWelcomeMessage=function(b){var a=N.randomId(),c=p.data("mck-id"),
e=p.data("isgroup"),a={key:a,type:4,contentType:0,to:b.sender,message:b.messageContent};c&&c.toString()===b.sender&&!e&&(c=d.fetchContact(c),y.addMessageToTab(a,c,function(b,a){d.addMessage(b,a,!0,!0,!1)}));N.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(b.sender)+"\x26messageContent\x3d"+encodeURIComponent(b.messageContent),contentType:"text/plain",success:function(a){b.callback&&b.callback(a)}})};a.submitMessage=function(a,c){var e=
a.key,h=a.metadata?a.metadata:{};dc&&(a.metadata={userStatus:4});var f=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof f||""===f||a.forward||(h.AL_REPLY=f,b("#mck-text-box").data("AL_REPLY",""));a.source=rc;var l=b("#mck-message-cell .mck-message-inner div[name\x3d'message']."+e);102!=a.contentType&&103!=a.contentType&&(a.metadata=cc);a.metadata=h;N.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:r.JSON.stringify(a),contentType:"application/json",success:function(h){var f=
p.data("mck-id");if("object"===typeof h){var n=h.messageKey;if(f&&f.toString()===c.tabId){var C=h.conversationId;p.data("mck-conversationid",C);l.removeClass(e).addClass(n);l.data("msgkey",n);b("."+n+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");d.addTooltip(n);c.isTopPanelAdded&&ba.data("datetime",h.createdAt);h=!0;a.groupId&&6===mckGroupUtils.getGroup(a.groupId).type&&(h=!1);h&&d.messageContextMenu(n)}a.conversationPxy&&(n=a.conversationPxy,
a.topicId&&(ja[a.topicId]=[C]),V[C]=n)}else"CONVERSATION_CLOSED"===h||"BUSY_WITH_OTHER"===h?(u.attr("disabled",!1),d.closeConversation(h),l.remove(),c.isTopPanelAdded&&ea.removeClass("vis").addClass("n-vis")):"error"===h&&(u.attr("disabled",!1),R.html("Unable to process your request. Please try again"),R.removeClass("n-vis").addClass("vis"),l.remove(),c.isTopPanelAdded&&ea.removeClass("vis").addClass("n-vis"));C=d.getTabDisplayName(f,!1);M[f]||f===C||(Z.updateDisplayName(f,C),f={userId:f,userName:C},
M[f.userId]=f)},error:function(){R.html("Unable to process your request. Please try again.");R.removeClass("n-vis").addClass("vis");l&&l.remove();c.isTopPanelAdded&&ea.removeClass("vis").addClass("n-vis")}});b("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};a.downloadImage=function(b){window.open(b,"_blank")};b("div").scroll(function(){(b("#mck-sidebox-search").hasClass("vis")||"block"==b("#mck-gm-search-box").css("display"))&&b(this).scrollTop()+b(this).innerHeight()>=b(this)[0].scrollHeight&&
Sb&&Z.ajaxcallForContacts("?pageSize\x3d50\x26orderBy\x3d1\x26startTime\x3d"+Sb,!0)});a.replyMessage=function(a){var c="";p.data("mck-id");var e=y.getReplyMessageByKey(a);v.focus().select();b("#mck-reply-to-div").removeClass("n-vis").addClass("vis");c=5===e.type?"You":d.getTabDisplayName(e.to,!1);b("#mck-reply-to").html(c);"object"===typeof e.fileMeta||2===e.contentType?b("#mck-reply-msg").html(d.getImageForMessagePreview(e)):b("#mck-reply-msg").html(e.message);b("#mck-text-box").data("AL_REPLY",
a)};b("#close").click(function(){b("#mck-reply-to-div").removeClass("vis").addClass("n-vis");b("#mck-text-box").data("AL_REPLY","")});a.deleteMessage=function(a){var c=p.data("mck-id");"undefined"!==typeof c&&N.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+a,type:"get",success:function(d){"success"===d?(p.data("mck-id")===c&&(b("."+a).remove(),p.is(":empty")&&ea.removeClass("vis").addClass("n-vis")),ALStorage.clearMckMessageArray()):r.console.log("Unable to delete message. Please reload page.")}})};
a.deleteConversation=function(){var b=p.data("mck-id"),a=p.data("isgroup"),c=p.data("mck-conversationid");if("undefined"!==typeof b){var d={};a?d.groupId=b:d.userId=b;c&&(d.conversationId=c);wa=!0;window.Applozic.ALApiService.deleteConversation({data:d,success:function(){p.data("mck-id")===b&&(p.html(""),ba.data("datetime",""),Q.removeClass("n-vis").addClass("vis"),C.removeClass("n-vis").addClass("vis"),ea.removeClass("vis").addClass("n-vis"),wa=!1)},error:function(){}})}};a.loadMessageList=function(a,
c){var e=!1,h=!1,f="";"undefined"!==typeof a.tabId&&""!==a.tabId?(f=a.isGroup?"\x26groupId\x3d"+a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId),e=!0,a.startTime&&(f+="\x26endTime\x3d"+a.startTime),f+="\x26pageSize\x3d30",(Ca||Ka)&&a.conversationId&&(f+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof ta[a.tabId]?(h=!0,f+="\x26conversationReq\x3dtrue"):d.addConversationMenu(a.tabId,a.isGroup))):(wa=!0,a.startTime&&(f+="\x26endTime\x3d"+a.startTime),f+="\x26mainPageSize\x3d60");a.startTime||
p.html("");K.removeClass("n-vis").addClass("vis");N.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+f,type:"get",global:!1,success:function(f){var n=!0,u=p.data("mck-id"),q=p.data("isgroup");a.isGroup&&!a.startTime||K.removeClass("vis").addClass("n-vis");wa=tb=!1;if("undefined"===typeof u||a.tabId===u&&""+q===""+a.isGroup){if("null"===f+""||"undefined"===typeof f.message||0===f.message.length)n=!1,e?a.startTime?(ma.removeClass("n-vis").addClass("vis"),ma.fadeOut(5E3,function(){ma.removeClass("vis").addClass("n-vis")}),
ba.data("datetime","")):a.isGroup||0!==b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||(ea.removeClass("vis").addClass("n-vis"),va.removeClass("vis").addClass("n-vis"),C.removeClass("n-vis").addClass("vis")):(C.removeClass("vis").addClass("n-vis"),a.startTime?(za.removeClass("n-vis").addClass("vis"),za.fadeOut(5E3,function(){za.removeClass("vis").addClass("n-vis")})):(C.removeClass("vis").addClass("n-vis"),va.removeClass("n-vis").addClass("vis")),p.data("datetime",""));if("null"!==
f+""&&"error"!==f.status)if(e){n&&(0<a.startTime?d.processMessageList(f,!1,!0):a.isGroup||(d.processMessageList(f,!0,!0),ea.removeClass("n-vis").addClass("vis")));0<!a.startTime&&!a.isGroup&&"function"===typeof Oa&&Oa(a.tabId);0<f.userDetails.length&&b.each(f.userDetails,function(c,e){M[e.userId]=e;if(!a.isGroup)if(e.connected?r.MCK_OL_MAP[e.userId]=!0:(r.MCK_OL_MAP[e.userId]=!1,"undefined"!==typeof e.lastSeenAtTime&&(U[e.userId]=e.lastSeenAtTime)),Xa||a.isGroup||(e.blockedByThis?(ia[e.userId]=!0,
qa.toggleBlockUser(a.tabId,!0)):e.blockedByOther?(xa[e.userId]=!0,x.removeClass("mck-tab-title-w-status"),J.removeClass("vis").addClass("n-vis"),I.removeClass("vis").addClass("n-vis"),p.data("blocked",!1)):qa.toggleBlockUser(a.tabId,!1)),u&&M[u]&&(M[u].deletedAtTime||!0===tb))R.html(MCK_LABELS["user.delete"]).removeClass("n-vis").addClass("vis"),b("#mck-tab-status").removeClass("vis").addClass("n-vis"),O.removeClass("vis").addClass("n-vis"),S.removeClass("vis").addClass("n-vis");else if(e.userName&&
!a.startTime){var h=d.getTabDisplayName(a.tabId,a.isGroup,e.userName);x.html(h);x.attr("title",h)}});!Ya||a.isGroup||a.startTime||r.MCK_OL_MAP[a.tabId]||Va.manageOfflineMessageTime(a.tabId);if(0<f.conversationPxys.length){var m=[];b.each(f.conversationPxys,function(a,c){if("object"===typeof c&&(m.push(c),V[c.id]=c,ja[c.topicId]=[c.id],c.topicDetail))try{T[c.topicId]=b.parseJSON(c.topicDetail)}catch(d){r.console.log("Incorect Topic Detail!")}});h&&(ta[a.tabId]=m,d.addConversationMenu(a.tabId,a.isGroup))}a.conversationId&&
(q=V[a.conversationId],"object"===typeof q&&q.closed&&d.closeConversation());a.startTime||(a.isGroup?(t.addGroupStatus(mckGroupUtils.getGroup(a.tabId)),d.updateUnreadCount("group_"+a.tabId,0,!0)):d.updateUnreadCount("user_"+a.tabId,0,!0),"function"===typeof c&&c(a));0<f.groupFeeds.length&&b.each(f.groupFeeds,function(c,e){var h=mckGroupUtils.addGroup(e);if(!a.startTime){var k=[];b.each(e.membersId,function(b,a){"undefined"===typeof d.getContact(a)&&k.push(a)});if(0<k.length)a.isMessages=n,a.messageData=
f,a.isLoadMessageList=!0,Z.getUsersDetail(k,a);else{t.addGroupStatus(h);var l=!0,p;7===h.type&&(aa.removeClass("vis").addClass("n-vis"),mckGroupService.getContactFromGroupOfTwo(h,function(b){p=d.fetchContact(b)}),qa.lastSeenOfGroupOfTwo(p.contactId));6===h.type&&(t.validateOpenGroupUser(h),l=mckGroupService.isAppendOpenGroupContextMenu(h));K.removeClass("vis").addClass("n-vis");n?(C.removeClass("vis").addClass("n-vis"),d.processMessageList(f,!0,l),6!==h.type&&ea.removeClass("n-vis").addClass("vis")):
0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(ea.removeClass("vis").addClass("n-vis"),C.removeClass("n-vis").addClass("vis"));"function"===typeof Oa&&Oa(a.tabId)}}})}else a.startTime||(r.MCK_OL_MAP=[]),0<f.userDetails.length&&b.each(f.userDetails,function(b,a){M[a.userId]=a;a.connected?r.MCK_OL_MAP[a.userId]=!0:(r.MCK_OL_MAP[a.userId]=!1,"undefined"!==typeof a.lastSeenAtTime&&(U[a.userId]=a.lastSeenAtTime));d.updateUnreadCount("user_"+a.userId,a.unreadCount,!1);var c=
d.getContact(""+a.userId);"undefined"===typeof c?d.createContactWithDetail(a):d.updateContactDetail(c,a)}),0<f.groupFeeds.length&&b.each(f.groupFeeds,function(b,a){d.updateUnreadCount("group_"+a.id,a.unreadCount,!1);mckGroupUtils.addGroup(a)}),0<f.blockedUserPxyList.blockedToUserList.length&&b.each(f.blockedUserPxyList.blockedToUserList,function(b,a){a.userBlocked&&(ia[a.blockedTo]=!0)}),0<f.blockedUserPxyList.blockedByUserList.length&&b.each(f.blockedUserPxyList.blockedByUserList,function(b,a){a.userBlocked&&
(xa[a.blockedBy]=!0)}),0<f.conversationPxys.length&&b.each(f.conversationPxys,function(a,c){V[c.id]=c;ja[c.topicId]=[c.id];if(c.topicDetail)try{T[c.topicId]=b.parseJSON(c.topicDetail)}catch(d){r.console.log("Incorect Topic Detail!")}}),n?(a.startTime?a.startTime&&(a.isReload=!1,e||ALStorage.updateLatestMessageArray(f.message)):(a.isReload=!0,e||ALStorage.setLatestMessageArray(f.message)),e&&ALStorage.updateMckMessageArray(f.message),d.addContactsFromMessageList(f,a)):p.data("datetime",""),a.isLaunch&&
d.updateUnreadCountonChatIcon(f.userDetails)}q=l.data("forwardMessageKey");"undefined"!==typeof q&&(G.sendForwardMessage(q),l.data("forwardMessageKey",""))},error:function(b,a,c){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));wa=!1;K.removeClass("vis").addClass("n-vis");r.console.log("Unable to load messages. Please reload page.")}})};a.updateContactList=function(b,c){var e={};c?e.groupId=b:e.userId=b;e.pageSize=1;window.Applozic.ALApiService.getMessages({data:e,success:function(e){e=
e.data;"null"===e+""||"undefined"===typeof e.message||0===e.message.length?d.clearContactMessageData(b,c):(e=e.message[0],"undefined"!==typeof e&&(e.groupId?mckGroupService.addGroupFromMessage(e,!0,function(b,c,d){a.updateRecentConversationList(b,c,d)}):d.addContactsFromMessage(e,!0)))},error:function(a){d.clearContactMessageData(b,c)}})};a.conversationReadUpdate=function(b){var a=b.tabId,c=b.isGroup?"group_"+a:"user_"+a;"undefined"!==typeof a&&""!==a&&window.Applozic.ALApiService.conversationReadUpdate({data:data,
success:function(b){d.updateUnreadCount(c,0,!0)},error:function(){}})};a.getConversationId=function(a){if(!a.isGroup&&!a.isMessage&&a.topicStatus!==L[1]){var c=ja[a.topicId];if(c&&(c=V[c],"object"===typeof c)){p.data("mck-conversationid",c.id);a.conversationId=c.id;if("undefined"!==typeof ta[a.tabId]){var e=ta[a.tabId];e.push(c);ta[a.tabId]=e}d.loadTab(a);return}}a.topicId&&(c={topicId:a.topicId,userId:a.tabId,status:a.topicStatus},a.isGroup?c.groupId=a.groupId:c.userId=a.tabId,e=T[a.topicId],"object"===
typeof e&&(c.topicDetail=r.JSON.stringify(e)),a.fallBackTemplatesList&&0<a.fallBackTemplatesList.length&&(c.fallBackTemplatesList=a.fallBackTemplatesList),window.Applozic.ALApiService.getConversationId({data:c,success:function(c){if("object"===typeof c&&"success"===c.status){var e=c.response;if("object"===typeof e&&"undefined"!==e.conversationPxy){c=e.conversationPxy;V[c.id]=c;ja[c.topicId]=[c.id];if(c.topicDetail)try{T[c.topicId]=b.parseJSON(c.topicDetail)}catch(h){r.console.log("Incorect Topic Detail!")}p.data("mck-conversationid",
c.id);a.conversationId=c.id;if("undefined"!==typeof ta[a.tabId]){var f=ta[a.tabId];f.push(c);ta[a.tabId]=f}a.isGroup&&(e=mckGroupUtils.addGroup(e),a.tabId=e.contactId);a.isMessage&&c.created?d.loadTab(a,y.dispatchMessage):d.loadTab(a)}}},error:function(){}}))};a.sendPriceMessage=function(){var c=ha.val();if(""===c)ha.addClass("mck-text-req");else{var c=b.trim(c),e=f.val(),h=p.data("mck-conversationid",h),l={type:5,contentType:4,message:c};!0===p.data("isgroup")?l.groupId=e:l.to=e;if(p.data("mck-conversationid")){h=
p.data("mck-conversationid");l.conversationId=h;var n=V[h];"object"!==n?y.getTopicId({conversationId:h,suppId:e,priceText:c},function(a){d.populateMessage(a.messageType,a.message,a.notifyUser)}):"function"===typeof Ja&&Ja({custId:D,suppId:e,productId:n.topicId,price:c});ha.val("")}a.sendMessage(l)}};a.getGroup=function(a){var c=[];b.each(a.users,function(a,b){"undefined"!==typeof b.userId&&("undefined"!==typeof b.groupRole&&-1===zb.indexOf(b.groupRole)||c.push(b))});var e={groupName:b.trim(a.groupName),
users:c,type:a.type};a.admin&&(e.admin=a.admin);a.clientGroupId&&(e.clientGroupId=a.clientGroupId);a.groupIcon&&(e.imageUrl=a.groupIcon);e.metadata=a.metadata?a.metadata:MCK_LABELS["group.metadata"];var h={};window.Applozic.ALApiService.createGroup({data:{group:e},success:function(c){a.isInternal&&sa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);if("object"===typeof c&&"success"===c.status){if(c=c.response,"object"===typeof c){var e=mckGroupUtils.addGroup(c);0<c.users.length&&b.each(c.users,
function(a,b){M[b.userId]=b;b.connected?r.MCK_OL_MAP[b.userId]=!0:(r.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(U[b.userId]=b.lastSeenAtTime));d.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);var c=d.getContact(""+b.userId);"undefined"===typeof c?d.createContactWithDetail(b):d.updateContactDetail(c,b)});a.tabId=e.contactId;a.isGroup=!0;a.isMessage?d.loadTab(a,y.dispatchMessage):a.isInternal?(p.data("mck-id",e.contactId),p.data("isgroup",!0),t.loadGroupInfo({groupId:e.contactId})):
d.loadTab(a);"function"===typeof a.callback&&(h.status="success",h.data=e,a.callback(h))}}else"error"===c.status&&"function"===typeof a.callback&&(h.status="error",h.errorMessage=c.errorResponse[0].description,a.callback(h))},error:function(){a.isInternal&&sa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof a.callback&&(h.status="error",h.errorMessage="Unable to process request.",a.callback(h))}})}},Z=new function(){b("#mck-search-list");var a=b("#mck-sidebox-search"),
c=b("#mck-search-loading");b("#mck-search-cell .mck-message-inner");b("#mck-message-cell .mck-message-inner");b(".mck-tab-message-option");b("#mck-contact-loading");this.getContactDisplayName=function(a){var b=[];window.Applozic.ALApiService.getContactDisplayName({data:{userIdArray:a},success:function(a){for(var c in a)a.hasOwnProperty(c)&&(b.push([c,a[c]]),ma[c]=a[c],d.fetchContact(c).displayName=a[c]);ALStorage.updateMckContactNameArray(b)},error:function(){}})};this.ajaxcallForContacts=function(f,
l){var q=[],m=[];window.Applozic.ALApiService.getContactList({url:f,baseUrl:MCK_BASE_URL,success:function(c){Sb=c.lastFetchTime;if(a.hasClass("vis")||b("#mck-group-member-search-list").hasClass("mck-group-member-search-list"))"object"===typeof c&&0<c.users.length&&(b.each(c.users,function(a,b){"string"!==typeof M[b.userId]&&m.push(b.userId);if("undefined"!==typeof b.userId){var c=d.getContact(""+b.userId),c="undefined"===typeof c?d.createContactWithDetail(b):d.updateContactDetail(c,b);lb||(La.push(c),
Ia.push(c),q.push([b.userId,c.displayName]));b.connected?r.MCK_OL_MAP[b.userId]=!0:(r.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(U[b.userId]=b.lastSeenAtTime))}}),Z.getUsersDetail(m,{async:!1}),0<q.length&&ALStorage.updateMckContactNameArray(q)),d.addContactsToSearchList(l),t.addMembersToGroupSearchList()},error:function(){c.removeClass("vis").addClass("n-vis");r.console.log("Unable to load contacts. Please reload page.")}})};this.loadContacts=function(){Z.ajaxcallForContacts("?startIndex\x3d0\x26pageSize\x3d50\x26orderBy\x3d1")};
this.getUsersDetail=function(a,c){if(!("undefined"===typeof a||1>a.length)){for(var e="undefined"!==typeof c.cached?c.cached:!0,f=[],m=a.filter(function(b,c){return a.indexOf(b)===c}),s=0;s<m.length;s++){var u=m[s];e&&"undefined"!==typeof M[u]||f.push(u)}if(0===f.length)c.setStatus?qa.updateUserConnectedStatus():c.message?d.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&d.loadMessageListOnUserDetailFetch(c);else{var A={};window.Applozic.ALApiService.getUserDetail({data:{userIdList:f},
success:function(a){"success"===a.status&&0<a.response.length&&b.each(a.response,function(a,b){M[b.userId]=b;r.MCK_OL_MAP[b.userId]=b.connected;var c=d.getContact(""+b.userId);"undefined"===typeof c?d.createContactWithDetail(b):d.updateContactDetail(c,b)});c.setStatus?qa.updateUserConnectedStatus():c.message?d.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&d.loadMessageListOnUserDetailFetch(c);A.status="success";A.data=a;c.callback&&c.callback(A)},error:function(){c.setStatus?
qa.updateUserConnectedStatus():c.message?d.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&d.loadMessageListOnUserDetailFetch(c);A.status="error";c.callback&&c.callback(A)}})}}};this.updateDisplayName=function(a,c){""!==a&&""!==c&&b.ajax({url:MCK_BASE_URL+"/rest/ws/user/name",type:"get",data:"userId\x3d"+a+"\x26displayName\x3d"+c,success:function(a){if("object"===typeof a&&"success"===a.status)return"success"},error:function(){}})}},nb=new function(){var a=this,c,f,l,q,
m,r,s;a.init=function(){b("#mck-sidebox");f=b("#mck-msg-preview");m=b("#mck-group-info-tab");b("#mck-sidebox-launcher");c=b("#mck-message-cell .mck-message-inner");l=b("#mck-msg-preview .mck-preview-icon");q=b("#mck-msg-preview .mck-preview-cont-name");r=b("#mck-msg-preview .mck-preview-msg-content");s=b("#mck-msg-preview .mck-preview-file-content")};a.notifyUser=function(b){if(!1!==b.alert&&7!==b.type){var c=b.groupId?mckGroupUtils.getGroup(""+b.groupId):d.fetchContact(""+b.to.split(",")[0]),e=!1;
b.groupId&&(e=!0);na.loadUserProfile(b.to);var e=d.getTabDisplayName(c.contactId,e),f=nc;a.showNewMessageNotification(b,c,e);if(gc&&!wb){var l=qc;b=d.getTextForMessagePreview(b,c);"function"!==typeof Pa||c.isGroup||(c=Pa(c.contactId))&&"undefined"!==typeof c&&(l=c);f?oc.sendDesktopNotification(e,l,b,f):oc.sendDesktopNotification(e,l,b)}}};a.showNewMessageNotification=function(a,b,x){if(hc&&102!==a.contentType){var t=c.data("mck-id"),y=c.data("isgroup");if(t===b.contactId&&y===b.isGroup&&!m.hasClass("vis"))if(a.conversationId&&
(Ca||Ka)){if(t=c.data("mck-conversationid"),t="undefined"!==typeof t&&""!==t?t.toString():"",t===a.conversationId.toString())return}else return;f.data("isgroup",b.isGroup);f.data("mck-conversationid",a.conversationId?a.conversationId:"");t=d.getContactImageLink(b,x);a.message?(y=d.getMessageTextForContactPreview(a,b,50),r.html(""),"object"===typeof y?r.append(y):r.html(y),r.removeClass("n-vis").addClass("vis")):r.html("");a.fileMetaKey?(s.html(E.getFileIcon(a)),s.removeClass("n-vis").addClass("vis"),
""===r.html()&&r.removeClass("vis").addClass("n-vis")):(s.html(""),s.removeClass("vis").addClass("n-vis"));q.html(x);l.html(t);f.data("mck-id",b.contactId);f.show();setTimeout(function(){f.fadeOut(3E3)},1E4)}}},y=new AlMessageService,E=new AlFileService,oc=new MckNotificationUtils,lc=new AlNotificationService,na=new AlUserService,oa=b(".chat-launcher-icon"),da=new function(){var a=this,c;a.token=null;a.Identity=null;a.outgoingCallServices=null;a.incomingCallServices=null;var f=b("#mck-msg-to"),l=
b(".mck-videocall-btn"),q=b(".applozic-vid-container"),m=b("#mck-sidebox"),r=b("#mck-video-call-indicator");a.hideVideoBox=function(){q.addClass("n-vis").removeClass("vis");m.addClass("vis").removeClass("n-vis");r.addClass("n-vis").removeClass("vis")};a.init=function(){sa.loop=!0;a.token=null!==ALStorage.getAppHeaders()?ALStorage.getAppHeaders().videoToken:void 0;a.ringToneForHost=va.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",sa);b("#mck-btn-video-call").on("click",
function(l){if(a.token){var q=f.val();l=D+(new Date).getTime().toString()+Math.random().toString(36).slice(2);var q=y.sendVideoCallMessage(l,"CALL_DIALED",102,!1,q,function(a){G.sendMessage(a)}),m=d.fetchContact(q.to),q=d.getTabDisplayName(m.contactId,!1),m=d.getContactImageLink(m,q),r=new Date;a.outgoingCallServices=new MckCallingService(D,da.token,l,q,!0,r,G,m,!1,a.ringToneForHost);a.outgoingCallServices.startVideoCall();b("#mck-btn-video-call").data("isCallHost",!0);b("#mck-btn-video-call").data("callStartTime",
r)}else"INSUFFICIENT_FUNDS"===c?alert("Video calling is not available at the moment. For details, contact support."):alert("Calling token is missing, try refreshing page and initiate call again.")});b("#mck-vid-receive-btn").on("click",function(a){b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");l.removeClass("vis").addClass("n-vis");a=b("#mck-video-call-indicator").data("call-id");var c=b("#mck-video-call-indicator").data("isAudioCall");b("#mck-video-call-indicator").data("callReceived",
!0);b("#mck-video-call-indicator").addClass("n-vis");da.callReceived(a,c)});b("#mck-vid-reject-btn").on("click",function(a){a=b("#mck-video-call-indicator").data("call-id");var c=b("#mck-video-call-indicator").data("isAudioCall");da.callRejected(a,c);b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};a.InitilizeVideoClient=function(d,f){a.Identity=d;b.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:d,device:f},success:function(b){if(null!=
b&&""!=b){a.token=b.token;var d=ALStorage.getAppHeaders();d.videoToken=b.token;ALStorage.setAppHeaders(d)}b.hasOwnProperty("errorResponse")&&(c=b.errorResponse[0].description)},error:function(a){console.log("error while getting token"+a)}})};a.callReceived=function(b,c){var d=f.val();fa&&fa.stop();y.sendVideoCallMessage(b,"CALL_ANSWERED",102,c,d,function(a){G.sendMessage(a)});a.incomingCallServices=new MckCallingService(a.Identity,a.token,b,null,!1,null,G,null,c);a.incomingCallServices.startVideoCall()};
a.callRejected=function(a,b){fa&&fa.stop();y.sendVideoCallMessage(a,"CALL_REJECTED",102,b,toUser,function(a){G.sendMessage(a)})}},nc=null,sa={},va,Sb,tb=!1,fa=null;r.MCK_OL_MAP=[];f.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},
onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};var Y=new function(a){var c=this,f=a.events,l=null,q=null,m="",s=null,E=[],u,A,x="",J=b("#mck-sidebox"),F=b("#mck-tab-title"),L=b(".mck-typing-box"),I=b("#mck-tab-status");b("#mck-offline-message-box");var M=b("#mck-typing-label"),H=b("#mck-message-cell .mck-message-inner");c.init=function(){if("undefined"!==
typeof fb){var a=N.startsWith(fb,"https")?"15675":"15674";"function"===typeof r.SockJS&&(x||(x=new SockJS(fb+":"+a+"/stomp")),q=r.Stomp.over(x),q.heartbeat.outgoing=0,q.heartbeat.incoming=0,q.onclose=function(){c.disconnect()},q.connect("guest","guest",c.onConnect,c.onError,"/"),r.addEventListener("beforeunload",function(a){(a=a.target.activeElement.href)&&0!==a.length||c.disconnect()}))}};c.checkConnected=function(a){q.connected?(u&&clearInterval(u),A&&clearInterval(A),u=setInterval(function(){c.connectToSocket(a)},
6E5),A=setInterval(function(){c.sendStatus(1)},12E5)):c.connectToSocket(a)};c.connectToSocket=function(a){if(!q.connected){if(a&&"block"===J.css("display"))if(a=H.data("mck-id")){var b=H.data("isgroup"),f=H.data("mck-conversationid"),l=H.data("mck-topicid");ALStorage.clearMckMessageArray();d.loadTab({tabId:a,isGroup:b,conversationId:f,topicId:l})}else ALStorage.clearMckMessageArray(),d.loadTab({tabId:"",isGroup:!1});c.init()}};c.stopConnectedCheck=function(){u&&clearInterval(u);A&&clearInterval(A);
A=u="";c.disconnect()};c.disconnect=function(){clearInterval(void 0);q&&q.connected&&(c.sendStatus(0),q.disconnect(),x.close(),x="")};c.unsubscibeToTypingChannel=function(){q&&q.connected&&s&&(1===ga&&c.sendTypingStatus(0,m),s.unsubscribe());s=null};c.unsubscibeToNotification=function(){q&&q.connected&&l&&l.unsubscribe();l=null};c.subscibeToTypingChannel=function(a,b){var d=b?a:D;q&&q.connected?s=q.subscribe("/topic/typing-"+Q+"-"+d,c.onTypingStatus):c.reconnect()};c.subscribeToOpenGroup=function(a){if(q&&
q.connected){var b=q.subscribe("/topic/group-"+Q+"-"+a.contactId,c.onOpenGroupMessage);E.push(b.id);yb[a.contactId]=b.id}else c.reconnect()};c.sendTypingStatus=function(a,b){if(q&&q.connected){1===a&&1===ga&&q.send("/topic/typing-"+Q+"-"+m,{"content-type":"text/plain"},Q+","+D+","+a);if(b){if(b===m&&a===ga&&1===a)return;m=b;q.send("/topic/typing-"+Q+"-"+b,{"content-type":"text/plain"},Q+","+D+","+a);setTimeout(function(){ga=0},6E4)}else 0===a&&q.send("/topic/typing-"+Q+"-"+m,{"content-type":"text/plain"},
Q+","+D+","+a);ga=a}};c.onTypingStatus=function(a){if(null!=s&&s.id===a.headers.subscription){var b=a.body,c=b.split(",")[1],b=Number(b.split(",")[2]);a=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+1,a.headers.destination.length);var e=H.data("mck-id"),f=H.data("isgroup"),l=mckGroupUtils.getGroup(e);if(!ia[c]&&!xa[c])if(1===b){if(!(D===c&&f||e!==c&&e!==a)){if(f=H.data("isgroup")){if(c!==D){if(mckGroupService.authenticateGroupUser(l)||6===l.type&&!ka.disableChatForNonGroupMember)F.addClass("mck-tab-title-w-typing"),
I.removeClass("vis").addClass("n-vis"),c=d.getTabDisplayName(c,!1),c=c.split(" ")[0],M.html(c+" "+MCK_LABELS["is.typing"]);7===l.type&&(F.addClass("mck-tab-title-w-typing"),M.html(MCK_LABELS["is.typing"]),I.html(""))}}else F.addClass("mck-tab-title-w-typing"),I.removeClass("vis").addClass("n-vis"),M.html(MCK_LABELS.typing);L.removeClass("n-vis").addClass("vis");setTimeout(function(){F.removeClass("mck-tab-title-w-typing");L.removeClass("vis").addClass("n-vis");F.hasClass("undefined"===typeof l||7!=
l.type)&&I.removeClass("n-vis").addClass("vis");M.html(MCK_LABELS.typing)},6E4)}}else F.removeClass("mck-tab-title-w-typing"),L.removeClass("vis").addClass("n-vis"),!F.hasClass("mck-tab-title-w-status")||"undefined"!==typeof l&&7==l.type||I.removeClass("n-vis").addClass("vis"),M.html(MCK_LABELS.typing)}};c.reconnect=function(){c.unsubscibeToTypingChannel();c.unsubscibeToNotification();c.disconnect();c.init()};c.onError=function(a){r.console.log("Error in channel notification. "+a);f.onConnectFailed()};
c.sendStatus=function(a){q&&q.connected&&q.send("/topic/status-v2",{"content-type":"text/plain"},Ea+","+S+","+a)};c.onConnect=function(){q.connected?(l&&c.unsubscibeToNotification(),l=q.subscribe("/topic/"+Ea,c.onMessage),c.sendStatus(1),c.checkConnected(!0)):setTimeout(function(){l=q.subscribe("/topic/"+Ea,c.onMessage);c.sendStatus(1);c.checkConnected(!0)},5E3);f.onConnect()};c.onOpenGroupMessage=function(a){if(-1!==E.indexOf(a.headers.subscription)){var c=b.parseJSON(a.body),e=c.type;a=c.message;
if("APPLOZIC_03"===e)ALStorage.updateLatestMessage(a),0!==a.type&&4!==a.type&&(b("."+a.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),d.addTooltip(a.key)),f.onMessageSentUpdate({messageKey:a.key});else if("APPLOZIC_01"===e||"APPLOZIC_02"===e||"MESSAGE_RECEIVED"===e){ALStorage.updateLatestMessage(a);var l=a.groupId?mckGroupUtils.getGroup(a.groupId):d.getContact(a.to);b("#mck-sidebox-content");H.data("mck-id");if("APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e){var m=d.getMessageFeed(a);
f.onMessageReceived({message:m})}else"APPLOZIC_02"===e&&(m=d.getMessageFeed(a),f.onMessageSent({message:m}));a.conversationId&&(m=V[a.conversationId],!Ca&&!Ka||"object"===typeof m&&"object"===typeof T[m.topicId]||y.getTopicId({conversationId:a.conversationId,messageType:e,message:a,notifyUser:c.notifyUser,async:!1,populate:!1},function(a){d.populateMessage(a.messageType,a.message,a.notifyUser)}));"undefined"===typeof l?(c={message:a,messageType:e,notifyUser:c.notifyUser},a.groupId?t.getGroupFeedFromMessage(c):
(e=[],e.push(a.to),Z.getUsersDetail(e,c))):d.populateMessage(e,a,c.notifyUser)}}};c.onMessage=function(a){if(null!=l&&l.id===a.headers.subscription){a=b.parseJSON(a.body);var c=a.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),d.addTooltip(a.message.split(",")[0]),f.onMessageDelivered({messageKey:a.message.split(",")[0]});else if("APPLOZIC_34"===c)b("#mck-msg-error").html(MCK_LABELS["user.delete"]).removeClass("n-vis").addClass("vis"),
b("#mck-tab-status").removeClass("vis").addClass("n-vis"),b("#mck-msg-form").removeClass("vis").addClass("n-vis"),b("#li-mck-block-user").removeClass("vis").addClass("n-vis"),tb=!0;else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),d.addTooltip(a.message.split(",")[0]),f.onMessageRead({messageKey:a.message.split(",")[0]});
else if("APPLOZIC_05"===c){var e=a.message.split(",")[0],n=a.message.split(",")[1],m="1"===a.message.split(",")[2]?!0:!1;d.removedDeletedMessage(e,n,m);a={messageKey:a.message.split(",")[0]};m?a.groupId=n:a.userKey=n;f.onMessageDeleted(a)}else if("APPLOZIC_27"===c)e=a.message.split(",")[0],a=a.message.split(",")[1],"undefined"!==typeof e&&(d.removeConversationThread(e,!1),d.updateUnreadCount("user_"+e,0,!0),n={userId:e},a&&(n.topicId=a),f.onConversationDeleted(n));else if("APPLOZIC_11"===c){e=a.message;
m=d.fetchContact(e);n=H.data("mck-id");if(!ia[e]&&!xa[e]){if(n!==m.contactId||H.data("isgroup")){var q=mckContactUtils.formatContactId(e);b("#li-user-"+q+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else b("#mck-tab-status").html(MCK_LABELS.online),Ya&&d.hideOfflineMessage();b(".mck-user-ol-status."+q).removeClass("n-vis").addClass("vis");b(".mck-user-ol-status."+q).next().html("("+MCK_LABELS.online+")");r.MCK_OL_MAP[e]=!0;na.updateUserStatus({userId:a.message,status:1},function(a){Z.getUsersDetail(a,
{})})}f.onUserConnect({userId:a.message})}else if("APPLOZIC_12"===c)e=a.message.split(",")[0],a=a.message.split(",")[1],m=d.fetchContact(e),r.MCK_OL_MAP[e]=!1,a&&(U[e]=a),ia[e]||xa[e]||(n=H.data("mck-id"),n!==m.contactId||H.data("isgroup")||(b("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(a)),Ya&&Va.manageOfflineMessageTime(n)),b(".mck-user-ol-status."+m.htmlId).removeClass("vis").addClass("n-vis"),b(".mck-user-ol-status."+m.htmlId).next().html("(Offline)"),b("#li-user-"+q+" .mck-ol-status").removeClass("vis").addClass("n-vis"),
na.updateUserStatus({userId:e,status:0,lastSeenAtTime:a},function(a){Z.getUsersDetail(a,{})})),f.onUserDisconnect({userId:e,lastSeenAtTime:a});else if("APPLOZIC_29"===c){e=a.message.split(",")[0];a=a.message.split(",")[1];m=d.fetchContact(e);d.updateUnreadCount("user_"+m.contactId,0,!0);n=H.data("mck-id");if("undefined"===typeof n||""===n)b("#li-user-"+m.htmlId+" .mck-unread-count-text").html(d.getUnreadCount("user_"+m.contactId)),b("#li-user-"+m.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");
n={userId:e};a&&(n.topicId=a);f.onConversationReadFromOtherSource(n)}else if("APPLOZIC_28"===c)e=a.message.split(",")[0],a=a.message.split(",")[1],n=H.data("mck-id"),n===e&&(b(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),b(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),m=d.getContact(e),"undefined"===typeof m&&(n=[],n.push(e),Z.getUsersDetail(n,{}))),n={userId:e},
a&&(n.topicId=a),f.onConversationRead(n);else if("APPLOZIC_16"===c)c=a.message.split(":")[0],e=a.message.split(":")[1],m=d.fetchContact(e),n=H.data("mck-id"),n===m.contactId?c===kc[0]?(ia[m.contactId]=!0,qa.toggleBlockUser(n,!0)):(xa[m.contactId]=!0,F.removeClass("mck-tab-title-w-status"),I.removeClass("vis").addClass("n-vis"),L.removeClass("vis").addClass("n-vis")):b("#li-user-"+m.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),f.onUserBlocked({status:c,userId:e});else if("APPLOZIC_17"===
c){c=a.message.split(":")[0];e=a.message.split(":")[1];m=d.fetchContact(e);n=H.data("mck-id");if(n===m.contactId)if(c===kc[2])ia[m.contactId]=!1,qa.toggleBlockUser(n,!1);else{if(r.MCK_OL_MAP[n]||U[n])xa[m.contactId]=!1,ia[n]||(r.MCK_OL_MAP[n]?I.html(MCK_LABELS.online):U[n]&&I.html(mckDateUtils.getLastSeenAtStatus(U[n])),F.addClass("mck-tab-title-w-status"),I.removeClass("n-vis").addClass("vis"))}else r.MCK_OL_MAP[n]&&b("#li-user-"+m.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis");f.onUserUnblocked({status:c,
userId:e})}else if("APPLOZIC_18"===c)Xa=!1,f.onUserActivated();else if("APPLOZIC_19"===c)Xa=!0,f.onUserDeactivated();else if(e=a.message,"APPLOZIC_03"===c)ALStorage.updateLatestMessage(e),0!==e.type&&4!==e.type&&(b("."+e.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),d.addTooltip(e.key)),f.onMessageSentUpdate({messageKey:e.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===c)ALStorage.updateLatestMessage(e),m=e.groupId?mckGroupUtils.getGroup(e.groupId):
d.getContact(e.to),b("#mck-sidebox-content"),n=H.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===c?(n=d.getMessageFeed(e),f.onMessageReceived({message:n})):"APPLOZIC_02"===c&&(n=d.getMessageFeed(e),f.onMessageSent({message:n})),e.conversationId&&(n=V[e.conversationId],!Ca&&!Ka||"object"===typeof n&&"object"===typeof T[n.topicId]||y.getTopicId({conversationId:e.conversationId,messageType:c,message:e,notifyUser:a.notifyUser,async:!1,populate:!1},function(a){d.populateMessage(a.messageType,a.message,
a.notifyUser)})),"undefined"===typeof m?(a={message:e,messageType:c,notifyUser:a.notifyUser},e.groupId?t.getGroupFeedFromMessage(a):(n=[],n.push(e.to),Z.getUsersDetail(n,a))):(102==e.contentType&&za&&(a.notifyUser=!1,4==e.type&&"CALL_DIALED"==e.metadata.MSG_TYPE?(m=d.fetchContact(e.to),n=d.getTabDisplayName(m.contactId,!1),m=d.getContactImageLink(m,n),b("#mck-video-call-indicator").data("call-id",e.metadata.CALL_ID),b("#mck-video-call-indicator").data("isAudioCall",e.metadata.CALL_AUDIO_ONLY),b("#mck-video-call-indicator-txt").html(n+
" calling..."),b("#mck-video-call-icon").html(m),b("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),fa.play(),setTimeout(function(){b("#mck-video-call-indicator").data("callReceived")||(fa.stop(),b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==e.type&&"CALL_REJECTED"==e.metadata.MSG_TYPE&&b("#mck-btn-video-call").data("isCallHost")&&(n=$mck_msg_to.val(),y.sendVideoCallMessage(e.metadata.CALL_ID,"CALL_REJECTED",103,!1,n,function(a){G.sendMessage(a)}),
da.ringToneForHost.stop(),da.outgoingCallServices.twilioService.leaveRoomIfJoined(),da.hideVideoBox(),da.outgoingCallServices&&(da.outgoingCallServices.rejectedByReceiver=!0))),103==e.contentType?4==e.type&&"CALL_MISSED"==e.metadata.MSG_TYPE&&(b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),fa&&fa.stop()):d.populateMessage(c,e,a.notifyUser))}}}(f);f.getOptions=function(){return c};f.init=function(){window.Applozic.ALApiService.initServerUrl(MCK_BASE_URL);E.get(c);y.init(c);lc.init(c);
sa.loop=!1;$b&&(va=new RingToneService,nc=va.loadRingTone($b,sa));G.init();rb.init();Va.initializeApp(c,!1);nb.init();Nb.init();d.initEmojis();za&&(sa.loop=!0,va=new RingToneService,fa=va.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",sa),da.init())};f.reInit=function(a){"object"===b.type(a)&&(a=b.extend(!0,{},Tb,a),b.fn.applozic("reset",a),a.userId&&a.appId&&""!==b.trim(a.userId)&&""!==b.trim(a.appId)?(Va.initializeApp(a,!0),c=a):r.console("Oops! looks like incorrect application id or user Id."))};
f.loadTabView=function(a){"undefined"===typeof a.isGroup&&(a.isGroup=!1);d.loadTab(a);b("#mck-search").val("")};f.loadTab=function(a){d.loadTab({tabId:a,isGroup:!1});b("#mck-search").val("")};f.loadChat=function(a){if(!("undefined"!==typeof a.userId&&""!==a.userId||"undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId))return"UserId or groupId or clientGroupId required";var c={tabId:a.userId,isGroup:!1},c={};a.userId&&(c.tabId=userId,c.isGroup=
!1);a.displayName&&(c.userName=a.displayName);a.convId&&(c.conversationId=a.convId);if(a.groupId||a.clientGroupId)if(c.isGroup=!0,a.clientGroupId){c.clientGroupId=a.clientGroupId;var f=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);if("object"===typeof f)c.tabId=f.contactId;else{mckGroupService.getGroupFeed({clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}}else if(f=mckGroupUtils.getGroup(a.groupId),"object"===typeof f)c.tabId=
a.groupId;else{mckGroupService.getGroupFeed({groupId:a.groupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}d.loadTab(c);b("#mck-search").val("")};f.uploadFile=function(a){rb.uploadFile(a)};f.audioAttach=function(a){rb.audioRecoder(a)};f.loadGroupTab=function(a){if("undefined"===typeof a||""===a)return"GroupId required";"object"===typeof mckGroupUtils.getGroup(a)?(d.loadTab({tabId:a,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({groupId:a,
apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};f.loadGroupTabByClientGroupId=function(a){if("undefined"===typeof a.clientGroupId||""===a.clientGroupId)return"Client Group Id Required";var c=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);"object"===typeof c?(d.loadTab({tabId:c.contactId,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({clientGroupId:a.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};f.loadConvTab=function(a){"object"===typeof a&&a.userId&&
a.convId&&d.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};f.loadTabWithTopic=function(a){if("object"===typeof a&&(a.userId||a.groupId)&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=a.topicStatus?-1===L.indexOf(a.topicStatus)?L[0]:a.topicStatus.toString():L[0];if("function"===typeof Ba||a.topicDetail){var c=a.topicDetail?a.topicDetail:Ba(a.topicId);"object"===typeof c&&"undefined"!==c.title&&(T[a.topicId]=c)}a.message?(b.messagePxy=
{type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.groupId?(b.isGroup=!0,b.groupId=a.groupId):(b.isGroup=!1,b.userId=a.userId);G.getConversationId(b)}else{if(!a.userId||!a.groupId)return"UserId or groupId required";if(!a.topicId)return"TopicId required"}};f.loadContacts=function(a){d.loadContacts(a)};f.loadContactsForContactList=function(a){d.loadContactsForContactList(a)};f.setOffline=function(){"undefined"!==typeof Y&&Y.sendStatus(0)};f.reset=function(a){r.sessionStorage.clear();
m=Ea="";F=[];MCK_GROUP_MAP=[];vb=!0;Fa=[];S="";xb=a.mode;ia=[];xa=[];wa=!1;ya=90;Q=a.appId;U=[];V=[];T=[];MCK_CLIENT_GROUP_MAP=[];wb=!0;MCK_LABELS=a.labels;J=0;MCK_BASE_URL=a.baseUrl;Aa=a.fileupload;Ub=a.customFileUrl;Vb=a.customUploadUrl;X={};Qa=[];Ta=a.launcher;yb=[];Wb=a.userName;gb=a.visitor;ja=[];La=[];Ha={};hb=a.fileBaseUrl;Bb=a.locShare;za=c.video;I=a.onInit;Cb=a.onTopicDetails;ma=[];Da=[];Db=a.onClose;aa=a.accessToken;Eb=a.displayText;Oa=a.readConversation;ca=a.maxGroupSize;ta=[];Fb=a.onTabClicked;
Yb=a.contactNumber;ib=a.appModuleName;Ba=a.getTopicDetail;W=a.maxAttachmentSize;Hb=a.validateMessage;Gb=a.contactDisplayName;Ia=[];Ja=a.finalPriceResponse;Pa=a.contactDisplayImage;Ib=a.priceWidget;ka=c.openGroupSettings;la=a.offlineMessageDetail;Jb=a.getConversationDetail;jb=a.authenticationTypeId;D=gb?"guest":b.trim(a.userId);kb="boolean"===typeof a.olStatus?a.olStatus:!1;Ka="boolean"===typeof a.topicBox?a.topicBox:!1;Ya="boolean"===typeof a.showOfflineMessage?a.showOfflineMessage:!1;Ca="boolean"===
typeof a.topicHeader?a.topicHeader:!1;hc="boolean"===typeof a.notification?a.notification:!0;fc=a.supportId?'data-mck-id\x3d"'+a.supportId+'"':"";bc="boolean"===typeof a.hideGroupSubtitle?a.hideGroupSubtitle:!1;cc="undefined"===typeof a.defaultMessageMetaData?{}:a.defaultMessageMetaData;Lb="boolean"===typeof a.groupUserCount?a.groupUserCount:!1;gc="boolean"===typeof a.desktopNotification?a.desktopNotification:!1;lb="boolean"===typeof a.loadOwnContacts?a.loadOwnContacts:!1;ac="boolean"===typeof a.messageBubbleAvator?
a.messageBubbleAvator:!1;ec="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1;mb="boolean"===typeof a.launchOnNewMessage?a.launchOnNewMessage:!1;ic="boolean"===typeof a.autoTypeSearchEnabled?a.autoTypeSearchEnabled:!0;dc="boolean"===typeof a.checkUserBusyWithStatus?a.checkUserBusyWithStatus:!1;Mb="boolean"===typeof a.launchOnUnreadMessage?a.launchOnUnreadMessage:!1};f.logout=function(){"undefined"!==typeof Y&&(Y.disconnect(),ALStorage.clearMckMessageArray(),b.fn.applozic("reset",c),b("#mck-sidebox").hide(),
b("#mck-sidebox-launcher").hide());vb=!1;ALStorage.clearApplozicSessionStorage()};f.setOnline=function(){"undefined"!==typeof Y&&Y.sendStatus(1)};f.getUserStatus=function(a){"function"===typeof a.callback&&("undefined"!==typeof a.userIds?Z.getUsersDetail(a.userIds,a):na.getUserStatus(a,function(a){b.each(a.users,function(a,b){var c=d.getContact(""+b.userId),c="undefined"===typeof c?d.createContactWithDetail(b):d.updateContactDetail(c,b);Ia.push(c.contactId)})}))};f.getGroupList=function(a){return"function"===
typeof a.callback?(a.apzCallback=t.loadGroups,mckGroupService.loadGroups(a),"success"):"Callback Function Required"};f.leaveGroup=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=t.onGroupLeft,mckGroupService.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};
f.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof a.role&&-1===zb.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return na.loadUserProfile(a.userId),
a.apzCallback=t.onAddedGroupMember,mckGroupService.addGroupMember(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};f.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",
errorMessage:"UserId required"});else return a.apzCallback=t.onRemovedGroupMember,mckGroupService.removeGroupMemberFromChat(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};f.updateGroupInfo=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){if("undefined"!==
typeof a.name&&""!==a.name||"undefined"!==typeof a.imageUrl&&""!==a.imageUrl||a.users&&0!==a.users.length){if(a.users&&0<a.users.length){var c=[];b.each(a.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==zb.indexOf(b.role)&&c.push(b)});if(0===c.length){a.callback({status:"error",errorMessage:"Incorrect users detail"});return}}c=[];b(".mck-group-change-role-box.vis").each(function(a,d){var f=b(this),m=parseInt(f.find("select").val()),r=f.parents(".mck-li-group-member").data("role");
m!==r&&(f={userId:f.parents(".mck-li-group-member").data("mck-id"),role:m},c.push(f))});a.apzCallback=t.onUpdateGroupInfo;mckGroupService.updateGroupInfo(a);return"success"}a.callback({status:"error",errorMessage:"Group properties required"})}else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};f.getMessages=function(a){"function"===typeof a.callback&&y.getMessages(a)};f.getMessageList=function(a){return"undefined"!==typeof a&&
"function"===typeof a.callback?(y.getMessageList(a,function(a){if("undefined"!==typeof a.to||"undefined"!==typeof a.groupId)a=d.getMessageFeed(a),messageFeeds.push(a)}),"success"):"Callback function required"};f.getMessageListByTopicId=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",
errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=L[0];var b=ja[a.topicId];b&&"object"===typeof V[b]?(a.conversationId=b,y.getMessageList(a,function(a){if("undefined"!==typeof a.to||"undefined"!==typeof a.groupId)a=d.getMessageFeed(a),messageFeeds.push(a)})):(a.isExtMessageList=!0,a.pageSize=1,y.fetchConversationByTopicId(a,function(a){G.getMessageList(a)}));return"success"}a.callback("TopicId required")}else a.callback({status:"error",errorMessage:"Id or clientGroupId required"});
else return"Callback function required."};f.sendMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},pc,a);var c=a.message;if(!a.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";if(12<a.type)return"Invalid message type";c=b.trim(c);a={to:b.trim(a.to),type:a.messageType,contentType:a.type,message:c,metadata:a.metadata};G.sendMessage(a);return"success"}return"Unsupported format. Please check format"};f.sendGroupMessage=function(a){if("object"===typeof a){a=
b.extend(!0,{},pc,a);var c=a.message;if(!a.groupId&&!a.clientGroupId)return"groupId or clientGroupId required";if("undefined"===typeof c||""===c)return"message field required";if(12<a.type)return"invalid message type";c=b.trim(c);c={type:a.messageType,contentType:a.type,message:c};if(a.groupId)c.groupId=b.trim(a.groupId);else if(a.clientGroupId){if("undefined"===typeof mckGroupUtils.getGroupByClientGroupId(a.clientGroupId))return"group not found";c.clientGroupId=b.trim(a.clientGroupId)}G.sendMessage(c);
return"success"}return"Unsupported format. Please check format"};f.addWelcomeMessage=function(a){if("object"===typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===typeof a.messageContent||""===a.messageContent)return"Message Content Required";G.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};f.createGroup=function(a){if("object"===typeof a)if("function"===typeof a.callback){var b=a.users;if("undefined"===typeof b||1>
b.length)a.callback({status:"error",errorMessage:"Users list required"});else if(b.length>ca)a.callback({status:"error",errorMessage:"Users limit exceeds "+ca+". Max number of users allowed is "+ca+"."});else if(a.groupName)if("undefined"===typeof a.type||""===a.type)a.callback({status:"error",errorMessage:"Group type required"});else if(-1===Ab.indexOf(a.type))a.callback({status:"error",errorMessage:"Invalid group type"});else return G.getGroup(a),"success";else a.callback({status:"error",errorMessage:"Group name required"})}else return"Callback function required";
else return"Unsupported Format. Please check format"};f.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>ca)return"Users limit exceeds "+ca+". Max number of users allowed is "+ca+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===Ab.indexOf(a.type))return"Invalid group type";G.getGroup(a);return"success"}return"Unsupported format. Please check format"};
f.getTotalUnreadCount=function(){return J};f.subscribeToEvents=function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(f.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(f.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(f.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(f.events.onMessageRead=a.onMessageRead),"function"===typeof a.onMessageDeleted&&(f.events.onMessageDeleted=a.onMessageDeleted),
"function"===typeof a.onConversationDeleted&&(f.events.onConversationDeleted=a.onConversationDeleted),"function"===typeof a.onUserConnect&&(f.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(f.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(f.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&(f.events.onConversationRead=a.onConversationRead),"function"===
typeof a.onMessageReceived&&(f.events.onMessageReceived=a.onMessageReceived),"function"===typeof a.onMessageSentUpdate&&(f.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(f.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(f.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(f.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&(f.events.onUserActivated=a.onUserActivated),"function"===
typeof a.onUserDeactivated&&(f.events.onUserDeactivated=a.onUserDeactivated))};f.getConversation=function(a){y.getTopicId({conversationId:a.conversationId},function(a){d.populateMessage(a.messageType,a.message,a.notifyUser)})}}r.applozic||(r.applozic=r.applozic?r.applozic:{},b.extend(!0,r.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var Tb={baseUrl:MCK_BASE_URL?MCK_BASE_URL:"https://apps.applozic.com",fileBaseUrl:"https://applozic.appspot.com",customFileUrl:"https://googleupload.applozic.com",
genereateCloudFileUrl:"https://googleupload.applozic.com/files/url?key\x3d{key}",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",launcher:"applozic-launcher",userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!1,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,
isAnonymousChat:!0,labels:{"conversations.title":"Conversations","start.new":"Start New","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members",
"add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?",
"unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info",
"exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",hour:" hour",min:" min",yesterday:"yesterday",hours:" hours",mins:" mins","user.delete":"This user has been deleted",ago:"ago",admin:"Admin",user:"User",moderator:"Moderator",member:"Member",
"public":"Public","private":"Private",open:"Open",you:"You","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",
GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},pc={messageType:5,type:0};b.fn.applozic=function(c,f){var r=b("#mck-sidebox");"object"===b.type(c)&&(c=b.extend(!0,{},Tb,c));var m=void 0;if("undefined"!==typeof r.data("applozic_instance"))if(m=r.data("applozic_instance"),"string"===b.type(c))switch(c){case "reInitialize":return m.reInit(f);case "loadConvTab":m.loadConvTab(f);
break;case "loadTab":m.loadTab(f);break;case "uploadFile":m.uploadFile(f);break;case "loadTabView":m.loadTabView(f);break;case "loadChat":m.loadChat(f);break;case "loadContextualTab":return m.loadTabWithTopic(f);case "audioAttach":m.audioAttach(f);break;case "addWelcomeMessage":m.addWelcomeMessage(f);break;case "loadContacts":m.loadContacts(f);break;case "loadContactsForContactList":m.loadContactsForContactList(f);break;case "sendMessage":return m.sendMessage(f);case "sendGroupMessage":return m.sendGroupMessage(f);
case "createGroup":return m.createGroup(f);case "loadBroadcastTab":return f.groupName=f.groupName?f.groupName:"Broadcast",f.type=5,m.initGroupTab(f);case "initBroadcastTab":return f.groupName=f.groupName?f.groupName:"Broadcast",f.type=5,m.initGroupTab(f);case "initGroupTab":return m.initGroupTab(f);case "loadGroupTab":return m.loadGroupTab(f);case "loadGroupTabByClientGroupId":return m.loadGroupTabByClientGroupId(f);case "setOffline":return m.setOffline(),"success";case "setOnline":return m.setOnline(),
"success";case "logout":return m.logout(),"success";case "createFriendContactList":return m.createFriendContactList(f);case "getFriendContactList":return m.getFriendContactList(f);case "removeUserFromFriendContactList":return m.removeUserFromFriendContactList(f);case "deleteFriendContactList":return m.deleteFriendContactList(f);case "reset":m.reset(f);break;case "getUserDetail":return m.getUserStatus(f),"success";case "getGroupList":return m.getGroupList(f),"success";case "leaveGroup":return m.leaveGroup(f);
case "addGroupMember":return m.addGroupMember(f);case "removeGroupMember":return m.removeGroupMember(f);case "updateGroupInfo":return m.updateGroupInfo(f);case "getMessages":m.getMessages(f);break;case "messageList":return m.getMessageList(f);case "getMessageListByTopicId":return m.getMessageListByTopicId(f);case "getTotalUnreadCount":return m.getTotalUnreadCount();case "subscribeToEvents":return m.subscribeToEvents(f);case "getConversation":return m.getConversation(f)}else"object"===b.type(c)&&m.reInit(c);
else"object"===b.type(c)&&(c.userId&&c.appId&&""!==b.trim(c.userId)&&""!==b.trim(c.appId)?"undefined"!==typeof r.data("applozic_instance")?(m=r.data("applozic_instance"),m.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=b,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===typeof b.fn.modal?(m=b.fn.modal.noConflict(),$.fn.modal=m,jQuery.fn.modal=m):"function"===typeof $.fn.modal&&(m=$.fn.modal.noConflict(),$.fn.modal=m,jQuery.fn.modal=m),"function"===typeof c.omckm?
b.fn.mckModal=c.omckm:"function"===typeof b.fn.mckModal?b.fn.mckModal=b.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(b.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(b.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof b.fn.linkify&&($.fn.linkify=b.fn.linkify,jQuery.fn.linkify=b.fn.linkify),"function"===typeof $.fn.emojiarea?b.fn.emojiarea=$.fn.emojiarea:"function"===typeof b.fn.emojiarea&&($.fn.emojiarea=b.fn.emojiarea,jQuery.fn.emojiarea=
b.fn.emojiarea),"function"===typeof $.fn.locationpicker?b.fn.locationpicker=$.fn.locationpicker:"function"===typeof b.fn.locationpicker&&($.fn.locationpicker=b.fn.locationpicker,jQuery.fn.locationpicker=b.fn.locationpicker),m=new ub(c),r.data("applozic_instance",m),m.init()):alert("Oops! looks like incorrect application id or user Id."))};b.fn.applozic.defaults=Tb})($applozic,window,document);
 function RingToneService() {
            var _this = this;
            _this.loadRingTone = function (url,notificationtoneoption) {
                return new Howl({
                    src: [url],
                    loop: notificationtoneoption.loop
                });
            };
        }
